use hex;
use serial_test::serial;

use f1_telemetry::packet::car_setup::{CarSetupData, PacketCarSetupData};
use f1_telemetry::packet::car_status::{
    CarStatusData, ERSDeployMode, FuelMix, PacketCarStatusData, TractionControl, DRS,
};
use f1_telemetry::packet::car_telemetry::{
    CarTelemetryData, MFDPanel, PacketCarTelemetryData, SurfaceType,
};
use f1_telemetry::packet::event::{Event, PacketEventData, SpeedTrap};
use f1_telemetry::packet::final_classification::{
    FinalClassification, PacketFinalClassificationData,
};
use f1_telemetry::packet::generic::{
    Flag, Nationality, ResultStatus, Team, TyreCompound, TyreCompoundVisual, WheelData,
};
use f1_telemetry::packet::lap::{DriverStatus, LapData, PacketLapData, PitStatus};
use f1_telemetry::packet::lobby_info::{PacketLobbyInfoData, Player, ReadyStatus};
use f1_telemetry::packet::motion::{CarMotionData, PacketMotionData};
use f1_telemetry::packet::participants::{
    Driver, PacketParticipantsData, ParticipantData, Telemetry,
};
use f1_telemetry::packet::session::{
    Formula, MarshalZone, PacketSessionData, SafetyCar, SessionType, Track, Weather,
    WeatherForecastSample,
};
use f1_telemetry::packet::Packet;

mod utils;

#[test]
#[serial]
fn test_parse_2020_motion_packet() {
    let stream = utils::get_stream();

    utils::send_raw_data(&stream, "e407010e0100599832db55618ae11d62cc429e0b000013ff1f398842b74dcf40452f6bc4c75aaa42ce33193e875b88c0d67f8f00a9f957069800d67f387182bd3e395d3d72bc203b9667cf3f004097bbd09198bbba3ecbc3eeb7b5c0616482447c5cefc1aaf2d8be317f2e42cab5e5fe4768c09794fdc8b5b64544c0ff9f65bf3cec973c4e5f1ebf8090a7bc92329b3c3cee10c4c74c3fc0455a0044000000000000000000000000c980fffeeef1120e1c00c880000000000000000000000000002ad7bf80c201bc91c763ba505b55c31ae9543f3182fec21adbc8c17392d1be34833542ebc4dbfe8971758ea000ecc4f6374540cfb6dcbe185078bd45a9f5be00e06339a87fa0bb3ec310c453523fc0775cfd43000000000000000000000000b080fffeddf2240de4ffaf80000000000000000000000000353ad6bf00abfdbb94c7633a366710c46b593fc09c60f643000000000000000000000000b080fffeddf2240de4ffaf80000000000000000000000000353ad6bf00abfdbb94c7633ae4616fc39121173e5e3bfec058c3e5c133e335be2929554282c1b3ffb36f4d90a1ff82c1297d45c0b49d953ee482803b4b9402bf000a72bb67593e3b8510aac379be26c0adc0e943957608c136f3fdbe7afea94252f386ff5d7fa3803e0052f3438042bed1613d3f174335bd3d45cbbd006cc73a7a0bf9baae9e814388dec140a0377bc491822942ebc21b3d6aeb34c11d7c61ffbae0451f45ff1d7cd16f9cbfe7e04c3f6bd751beb8a7e83f003fc83bf4f1bb3b3a450fc467523fc07272e143000000000000000000000000b080fffeddf2240de4ffaf80000000000000000000000000353ad6bf00abfdbb94c7633a184510c4ea4caec0c1c28144b93d33c25c7dd93edae24ec23badb300609e8e61affb42adf95665c0aa20333fc01894bafb071cc040c7ef3c8c2f0a3d4e540ec467523fc09dd7cf43000000000000000000000000c980fffeeef1120e1c00c880000000000000000000000000002ad7bf80c201bc91c763ba24860ec467523fc0e77bd343000000000000000000000000b080fffeddf2240de4ffaf80000000000000000000000000353ad6bf00abfdbb94c7633a36db1dc45c558cc0de9f4f444558843e8afdda3efae2a3c2f000de000380fd7f4fffef00f611c4be8146293ebd4fac3d5f974840005cb03b5fffb13b565e11c4c3ed44c03463bb43cb5a0b400865b33e5bc1b0c1470df1ffb2804e7f3d00470d5ad7a1bc45c726bb1b28123d216942400038eeba1ad8f5ba5c9110c4c9e943c06ab8f943000000000000000000000000bb80000065f29b0d0000bb80000000000000000000000000ffb1d6bf0000003400000000b23cb1c35c2a66c0f83921443bc709c13454f0beb73bb0425ef3a0ff5e7fa28001005ef36d4f7dbd52e595bd6ccc1bbd4f7ccabd00807bb9823953b852e23b43e723cf4072646dc4de5ffb4111834e3eb92844c1647760ffdfd1212eb9ff647772bb124091369ebf7ee7aabcd141f83f00c1af3b41260f3b64130fc467523fc028cedd43000000000000000000000000c980fffeeef1120e1c00c880000000000000000000000000002ad7bf80c201bc91c763ba85e60ec4a68345c030c6d6438fbe82c07265d935f8d3f1bedb80eeff44f1bc0efcffdb80fd97e8b7af30b8bd7aef03b8add4d7bf00500dba65891b390000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003da1d141c43ad3418b4f9c4115c29d410faf19c4c6991ac4b84549c432134bc41d0c0343998f01438cfb8544a7f586444ae55a40d7515b40dcee2840d4b4294084542abebdf628beb3aba8be6163a7be02c89c3af7f5163b769d834024634ab9e9afcdb449b1de3a4a2b55bb4b1f0e38f5cb913c00000080");

    let p = utils::get_packet(&stream).unwrap().unwrap();

    let actual = match p {
        Packet::Motion(m) => m,
        _ => panic!("Invalid packet. Expected Motion, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2020);

    let expected = PacketMotionData {
        header: actual.header.clone(),
        motion_data: vec![
            CarMotionData {
                world_position_x: 68.111565,
                world_position_y: 6.4782367,
                world_position_z: -940.7386,
                world_velocity_x: 85.1773,
                world_velocity_y: 0.14961168,
                world_velocity_z: -4.261173,
                world_forward_dir_x: 32726,
                world_forward_dir_y: 143,
                world_forward_dir_z: -1623,
                world_right_dir_x: 1623,
                world_right_dir_y: 152,
                world_right_dir_z: 32726,
                g_force_lateral: -0.06369251,
                g_force_longitudinal: 0.05400967,
                g_force_vertical: 0.0024526385,
                yaw: 1.6203487,
                pitch: -0.0046157837,
                roll: -0.004656054,
            },
            CarMotionData {
                world_position_x: -406.49005,
                world_position_y: -5.6787024,
                world_position_z: 1043.1368,
                world_velocity_x: -29.920158,
                world_velocity_y: -0.42372638,
                world_velocity_z: 43.62421,
                world_forward_dir_x: -18998,
                world_forward_dir_y: -283,
                world_forward_dir_z: 26695,
                world_right_dir_x: -26688,
                world_right_dir_y: -620,
                world_right_dir_z: -19000,
                g_force_lateral: -3.0667548,
                g_force_longitudinal: -0.8969726,
                g_force_vertical: 0.018545263,
                yaw: -0.61864173,
                pitch: -0.020454645,
                roll: 0.018945012,
            },
            CarMotionData {
                world_position_x: -579.7224,
                world_position_y: -2.989061,
                world_position_z: 513.41046,
                world_velocity_x: 0.0,
                world_velocity_y: 0.0,
                world_velocity_z: 0.0,
                world_forward_dir_x: -32567,
                world_forward_dir_y: -257,
                world_forward_dir_z: -3602,
                world_right_dir_x: 3602,
                world_right_dir_y: 28,
                world_right_dir_z: -32568,
                g_force_lateral: 0.0,
                g_force_longitudinal: 0.0,
                g_force_vertical: 0.0,
                yaw: -1.6809692,
                pitch: -0.007919908,
                roll: -0.00086891005,
            },
            CarMotionData {
                world_position_x: -213.35669,
                world_position_y: 0.83168185,
                world_position_z: -127.25428,
                world_velocity_x: -25.106983,
                world_velocity_y: -0.40932044,
                world_velocity_z: 45.378128,
                world_forward_dir_x: -15125,
                world_forward_dir_y: -293,
                world_forward_dir_z: 29065,
                world_right_dir_x: -29067,
                world_right_dir_y: 160,
                world_right_dir_z: -15124,
                g_force_lateral: 3.0815406,
                g_force_longitudinal: -0.43108222,
                g_force_vertical: -0.06062326,
                yaw: -0.47980705,
                pitch: 0.00021731853,
                roll: -0.0048980303,
            },
            CarMotionData {
                world_position_x: -579.05066,
                world_position_y: -2.9893997,
                world_position_z: 506.72238,
                world_velocity_x: 0.0,
                world_velocity_y: 0.0,
                world_velocity_z: 0.0,
                world_forward_dir_x: -32592,
                world_forward_dir_y: -257,
                world_forward_dir_z: -3363,
                world_right_dir_x: 3364,
                world_right_dir_y: -28,
                world_right_dir_z: -32593,
                g_force_lateral: 0.0,
                g_force_longitudinal: 0.0,
                g_force_vertical: 0.0,
                yaw: -1.6736513,
                pitch: -0.007741332,
                roll: 0.0008689102,
            },
            CarMotionData {
                world_position_x: -577.6127,
                world_position_y: -2.9898326,
                world_position_z: 492.75476,
                world_velocity_x: 0.0,
                world_velocity_y: 0.0,
                world_velocity_z: 0.0,
                world_forward_dir_x: -32592,
                world_forward_dir_y: -257,
                world_forward_dir_z: -3363,
                world_right_dir_x: 3364,
                world_right_dir_y: -28,
                world_right_dir_z: -32593,
                g_force_lateral: 0.0,
                g_force_longitudinal: 0.0,
                g_force_vertical: 0.0,
                yaw: -1.6736513,
                pitch: -0.007741332,
                roll: 0.0008689102,
            },
            CarMotionData {
                world_position_x: -239.38239,
                world_position_y: 0.14758898,
                world_position_z: -7.944747,
                world_velocity_x: -28.720383,
                world_velocity_y: -0.17762451,
                world_velocity_z: 53.290195,
                world_forward_dir_x: -15998,
                world_forward_dir_y: -77,
                world_forward_dir_z: 28595,
                world_right_dir_x: -28595,
                world_right_dir_y: -95,
                world_right_dir_z: -15998,
                g_force_lateral: -3.0857642,
                g_force_longitudinal: 0.2922188,
                g_force_vertical: 0.0039218534,
                yaw: -0.5100753,
                pitch: -0.003693223,
                roll: 0.0029044987,
            },
            CarMotionData {
                world_position_x: -340.12906,
                world_position_y: -2.6053755,
                world_position_z: 467.50528,
                world_velocity_x: -8.528951,
                world_velocity_y: -0.49599618,
                world_velocity_z: 84.997025,
                world_forward_dir_x: -3246,
                world_forward_dir_y: -122,
                world_forward_dir_z: 32605,
                world_right_dir_x: -32605,
                world_right_dir_y: 62,
                world_right_dir_z: -3246,
                g_force_lateral: -0.1899424,
                g_force_longitudinal: 0.7397738,
                g_force_vertical: -0.044253435,
                yaw: -0.099253155,
                pitch: 0.0015214682,
                roll: -0.0019000613,
            },
            CarMotionData {
                world_position_x: 259.2397,
                world_position_y: 6.0584145,
                world_position_z: -1004.86914,
                world_velocity_x: 42.377506,
                world_velocity_y: 0.038027685,
                world_velocity_z: -11.307474,
                world_forward_dir_x: 31773,
                world_forward_dir_y: -159,
                world_forward_dir_z: -8006,
                world_right_dir_x: 8005,
                world_right_dir_y: -187,
                world_right_dir_z: 31773,
                g_force_lateral: -1.2221624,
                g_force_longitudinal: 0.80030674,
                g_force_vertical: -0.20492332,
                yaw: 1.8176184,
                pitch: 0.006111026,
                roll: 0.00573563,
            },
            CarMotionData {
                world_position_x: -573.08167,
                world_position_y: -2.9894044,
                world_position_z: 450.8941,
                world_velocity_x: 0.0,
                world_velocity_y: 0.0,
                world_velocity_z: 0.0,
                world_forward_dir_x: -32592,
                world_forward_dir_y: -257,
                world_forward_dir_z: -3363,
                world_right_dir_x: 3364,
                world_right_dir_y: -28,
                world_right_dir_z: -32593,
                g_force_lateral: 0.0,
                g_force_longitudinal: 0.0,
                g_force_vertical: 0.0,
                yaw: -1.6736513,
                pitch: -0.007741332,
                roll: 0.0008689102,
            },
            CarMotionData {
                world_position_x: -577.0796,
                world_position_y: -5.446889,
                world_position_z: 1038.086,
                world_velocity_x: -44.810276,
                world_velocity_y: 0.42478454,
                world_velocity_z: -51.721535,
                world_forward_dir_x: -21189,
                world_forward_dir_y: 179,
                world_forward_dir_z: -24992,
                world_right_dir_x: 24974,
                world_right_dir_y: -1105,
                world_right_dir_z: -21182,
                g_force_lateral: -3.5834334,
                g_force_longitudinal: 0.69971716,
                g_force_vertical: -0.001129888,
                yaw: -2.437987,
                pitch: 0.029269814,
                roll: 0.03373675,
            },
            CarMotionData {
                world_position_x: -569.31726,
                world_position_y: -2.9894044,
                world_position_z: 415.68448,
                world_velocity_x: 0.0,
                world_velocity_y: 0.0,
                world_velocity_z: 0.0,
                world_forward_dir_x: -32567,
                world_forward_dir_y: -257,
                world_forward_dir_z: -3602,
                world_right_dir_x: 3602,
                world_right_dir_y: 28,
                world_right_dir_z: -32568,
                g_force_lateral: 0.0,
                g_force_longitudinal: 0.0,
                g_force_vertical: 0.0,
                yaw: -1.6809692,
                pitch: -0.007919908,
                roll: -0.00086891005,
            },
            CarMotionData {
                world_position_x: -570.09595,
                world_position_y: -2.9894044,
                world_position_z: 422.968,
                world_velocity_x: 0.0,
                world_velocity_y: 0.0,
                world_velocity_z: 0.0,
                world_forward_dir_x: -32592,
                world_forward_dir_y: -257,
                world_forward_dir_z: -3363,
                world_right_dir_x: 3364,
                world_right_dir_y: -28,
                world_right_dir_z: -32593,
                g_force_lateral: 0.0,
                g_force_longitudinal: 0.0,
                g_force_vertical: 0.0,
                yaw: -1.6736513,
                pitch: -0.007741332,
                roll: 0.0008689102,
            },
            CarMotionData {
                world_position_x: -631.4252,
                world_position_y: -4.38542,
                world_position_z: 830.4979,
                world_velocity_x: 0.25848594,
                world_velocity_y: 0.4277156,
                world_velocity_z: -81.94331,
                world_forward_dir_x: 240,
                world_forward_dir_y: 222,
                world_forward_dir_z: -32765,
                world_right_dir_x: 32765,
                world_right_dir_y: -177,
                world_right_dir_z: 239,
                g_force_lateral: -0.38294953,
                g_force_longitudinal: 0.16530801,
                g_force_vertical: 0.08413646,
                yaw: 3.134239,
                pitch: 0.005382061,
                roll: 0.005432054,
            },
            CarMotionData {
                world_position_x: -581.474,
                world_position_y: -3.0770118,
                world_position_z: 374.77502,
                world_velocity_x: 2.1774166,
                world_velocity_y: 0.35038018,
                world_velocity_z: -22.094412,
                world_forward_dir_x: 3399,
                world_forward_dir_y: -15,
                world_forward_dir_z: -32590,
                world_right_dir_x: 32590,
                world_right_dir_y: 61,
                world_right_dir_z: 3399,
                g_force_lateral: -0.019756008,
                g_force_longitudinal: -0.0025448364,
                g_force_vertical: 0.03568278,
                yaw: 3.0376666,
                pitch: -0.0018174648,
                roll: -0.001875642,
            },
            CarMotionData {
                world_position_x: -578.27124,
                world_position_y: -3.061144,
                world_position_z: 499.44073,
                world_velocity_x: 0.0,
                world_velocity_y: 0.0,
                world_velocity_z: 0.0,
                world_forward_dir_x: -32581,
                world_forward_dir_y: 0,
                world_forward_dir_z: -3483,
                world_right_dir_x: 3483,
                world_right_dir_y: 0,
                world_right_dir_z: -32581,
                g_force_lateral: 0.0,
                g_force_longitudinal: 0.0,
                g_force_vertical: 0.0,
                yaw: -1.677307,
                pitch: 1.1920929e-7,
                roll: 0.0,
            },
            CarMotionData {
                world_position_x: -354.47418,
                world_position_y: -3.5963354,
                world_position_z: 644.90576,
                world_velocity_x: -8.61114,
                world_velocity_y: -0.46939242,
                world_velocity_z: 88.11663,
                world_forward_dir_x: -3234,
                world_forward_dir_y: -96,
                world_forward_dir_z: 32606,
                world_right_dir_x: -32606,
                world_right_dir_y: 1,
                world_right_dir_z: -3234,
                g_force_lateral: -0.061843324,
                g_force_longitudinal: -0.0731913,
                g_force_vertical: -0.03803675,
                yaw: -0.09886991,
                pitch: -0.00023984909,
                roll: -5.035988e-5,
            },
            CarMotionData {
                world_position_x: 187.88406,
                world_position_y: 6.4731326,
                world_position_z: -949.56946,
                world_velocity_x: 31.42181,
                world_velocity_y: 0.20167185,
                world_velocity_z: -12.259942,
                world_forward_dir_x: 30564,
                world_forward_dir_y: -160,
                world_forward_dir_z: -11809,
                world_right_dir_x: 11809,
                world_right_dir_y: -71,
                world_right_dir_z: 30564,
                g_force_lateral: 2.2926908,
                g_force_longitudinal: -1.2360402,
                g_force_vertical: -0.020862337,
                yaw: 1.9395086,
                pitch: 0.0053635836,
                roll: 0.002184287,
            },
            CarMotionData {
                world_position_x: -572.303,
                world_position_y: -2.9894044,
                world_position_z: 443.6106,
                world_velocity_x: 0.0,
                world_velocity_y: 0.0,
                world_velocity_z: 0.0,
                world_forward_dir_x: -32567,
                world_forward_dir_y: -257,
                world_forward_dir_z: -3602,
                world_right_dir_x: 3602,
                world_right_dir_y: 28,
                world_right_dir_z: -32568,
                g_force_lateral: 0.0,
                g_force_longitudinal: 0.0,
                g_force_vertical: 0.0,
                yaw: -1.6809692,
                pitch: -0.007919908,
                roll: -0.00086891005,
            },
            CarMotionData {
                world_position_x: -571.60187,
                world_position_y: -3.0861602,
                world_position_z: 429.54834,
                world_velocity_x: -4.0857615,
                world_velocity_y: 1.6197284e-6,
                world_velocity_z: -0.47232032,
                world_forward_dir_x: -32549,
                world_forward_dir_y: -18,
                world_forward_dir_z: -3772,
                world_right_dir_x: 3772,
                world_right_dir_y: -4,
                world_right_dir_z: -32549,
                g_force_lateral: -2.772733e-5,
                g_force_longitudinal: -0.08993661,
                g_force_vertical: -3.1455864e-5,
                yaw: -1.6861778,
                pitch: -0.0005390644,
                roll: 0.00014833135,
            },
            CarMotionData {
                world_position_x: 0.0,
                world_position_y: 0.0,
                world_position_z: 0.0,
                world_velocity_x: 0.0,
                world_velocity_y: 0.0,
                world_velocity_z: 0.0,
                world_forward_dir_x: 0,
                world_forward_dir_y: 0,
                world_forward_dir_z: 0,
                world_right_dir_x: 0,
                world_right_dir_y: 0,
                world_right_dir_z: 0,
                g_force_lateral: 0.0,
                g_force_longitudinal: 0.0,
                g_force_vertical: 0.0,
                yaw: 0.0,
                pitch: 0.0,
                roll: 0.0,
            },
            CarMotionData {
                world_position_x: 0.0,
                world_position_y: 0.0,
                world_position_z: 0.0,
                world_velocity_x: 0.0,
                world_velocity_y: 0.0,
                world_velocity_z: 0.0,
                world_forward_dir_x: 0,
                world_forward_dir_y: 0,
                world_forward_dir_z: 0,
                world_right_dir_x: 0,
                world_right_dir_y: 0,
                world_right_dir_z: 0,
                g_force_lateral: 0.0,
                g_force_longitudinal: 0.0,
                g_force_vertical: 0.0,
                yaw: 0.0,
                pitch: 0.0,
                roll: 0.0,
            },
        ],
        suspension_position: WheelData::new(26.20373, 26.403694, 19.53884, 19.719767),
        suspension_velocity: WheelData::new(-614.7353, -618.4027, -805.08936, -812.2999),
        suspension_acceleration: WheelData::new(131.04732, 129.56093, 1071.8608, 1079.6766),
        wheel_speed: WheelData::new(3.4202447, 3.42687, 2.6395788, 2.6516619),
        wheel_slip: WheelData::new(-0.16633803, -0.16500373, -0.32943496, -0.32693008),
        local_velocity_x: 0.0011961462,
        local_velocity_y: 0.002303479,
        local_velocity_z: 4.1129713,
        angular_velocity_x: -0.00019301154,
        angular_velocity_y: -3.8312217e-7,
        angular_velocity_z: 0.0016990091,
        angular_acceleration_x: -0.0032527023,
        angular_acceleration_y: 3.3884582e-5,
        angular_acceleration_z: 0.01779745,
        front_wheels_angle: -0.0,
    };

    assert_eq!(actual, expected);
}

#[test]
#[serial]
fn test_parse_2020_session_packet() {
    let stream = utils::get_stream();

    utils::send_raw_data(&stream, "e407010e0101599832db55618ae1b510cd42a80b000013ff00221b63a616080b00d1033804500000ff0011235fd03c00426aa53d00f1e8053e00b07e3b3e00cb346e3e0067418c3e00802cae3e00c1c8ce3e00389ef63e00f8c7073f00815f163f00d6601e3f004bea273f000d5d433f00b83d5c3f004e7b6a3f000a09723f00000000000000000000000000000000000000000000010a080000231b080500231b080a00231b080f00231b081400231b081e00231b082d00231b0a00001f180a14001e170a2d001d170000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000");

    let p = utils::get_packet(&stream).unwrap().unwrap();

    let actual = match p {
        Packet::Session(s) => s,
        _ => panic!("Invalid packet. Expected Session, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2020);

    let expected = PacketSessionData {
        header: actual.header.clone(),
        weather: Weather::Clear,
        track_temperature: 34,
        air_temperature: 27,
        total_laps: 99,
        track_length: 5798,
        session_type: SessionType::QualifyingShort,
        track: Track::Monza,
        formula: Formula::F1Modern,
        session_time_left: 977,
        session_duration: 1080,
        pit_speed_limit: 80,
        game_paused: false,
        is_spectating: false,
        spectator_car_index: 255,
        sli_pro_native_support: false,
        num_marshal_zones: 17,
        marshal_zones: vec![
            MarshalZone {
                zone_start: 0.02543599,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.08076908,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.13077141,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.18310046,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.23262326,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.27393648,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.34018326,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.40387538,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.48167586,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.53039503,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.5873948,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.6186651,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.6559188,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.7631386,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.86031675,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.915944,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.9454504,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.0,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.0,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.0,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.0,
                zone_flag: Flag::None,
            },
        ],
        safety_car_status: SafetyCar::None,
        network_game: true,
        num_weather_forecast_samples: 10,
        weather_forecast_samples: vec![
            WeatherForecastSample {
                session_type: SessionType::QualifyingShort,
                time_offset: 0,
                weather: Weather::Clear,
                track_temperature: 35,
                air_temperature: 27,
            },
            WeatherForecastSample {
                session_type: SessionType::QualifyingShort,
                time_offset: 5,
                weather: Weather::Clear,
                track_temperature: 35,
                air_temperature: 27,
            },
            WeatherForecastSample {
                session_type: SessionType::QualifyingShort,
                time_offset: 10,
                weather: Weather::Clear,
                track_temperature: 35,
                air_temperature: 27,
            },
            WeatherForecastSample {
                session_type: SessionType::QualifyingShort,
                time_offset: 15,
                weather: Weather::Clear,
                track_temperature: 35,
                air_temperature: 27,
            },
            WeatherForecastSample {
                session_type: SessionType::QualifyingShort,
                time_offset: 20,
                weather: Weather::Clear,
                track_temperature: 35,
                air_temperature: 27,
            },
            WeatherForecastSample {
                session_type: SessionType::QualifyingShort,
                time_offset: 30,
                weather: Weather::Clear,
                track_temperature: 35,
                air_temperature: 27,
            },
            WeatherForecastSample {
                session_type: SessionType::QualifyingShort,
                time_offset: 45,
                weather: Weather::Clear,
                track_temperature: 35,
                air_temperature: 27,
            },
            WeatherForecastSample {
                session_type: SessionType::Race,
                time_offset: 0,
                weather: Weather::Clear,
                track_temperature: 31,
                air_temperature: 24,
            },
            WeatherForecastSample {
                session_type: SessionType::Race,
                time_offset: 20,
                weather: Weather::Clear,
                track_temperature: 30,
                air_temperature: 23,
            },
            WeatherForecastSample {
                session_type: SessionType::Race,
                time_offset: 45,
                weather: Weather::Clear,
                track_temperature: 29,
                air_temperature: 23,
            },
            WeatherForecastSample {
                session_type: SessionType::Unknown,
                time_offset: 0,
                weather: Weather::Clear,
                track_temperature: 0,
                air_temperature: 0,
            },
            WeatherForecastSample {
                session_type: SessionType::Unknown,
                time_offset: 0,
                weather: Weather::Clear,
                track_temperature: 0,
                air_temperature: 0,
            },
            WeatherForecastSample {
                session_type: SessionType::Unknown,
                time_offset: 0,
                weather: Weather::Clear,
                track_temperature: 0,
                air_temperature: 0,
            },
            WeatherForecastSample {
                session_type: SessionType::Unknown,
                time_offset: 0,
                weather: Weather::Clear,
                track_temperature: 0,
                air_temperature: 0,
            },
            WeatherForecastSample {
                session_type: SessionType::Unknown,
                time_offset: 0,
                weather: Weather::Clear,
                track_temperature: 0,
                air_temperature: 0,
            },
            WeatherForecastSample {
                session_type: SessionType::Unknown,
                time_offset: 0,
                weather: Weather::Clear,
                track_temperature: 0,
                air_temperature: 0,
            },
            WeatherForecastSample {
                session_type: SessionType::Unknown,
                time_offset: 0,
                weather: Weather::Clear,
                track_temperature: 0,
                air_temperature: 0,
            },
            WeatherForecastSample {
                session_type: SessionType::Unknown,
                time_offset: 0,
                weather: Weather::Clear,
                track_temperature: 0,
                air_temperature: 0,
            },
            WeatherForecastSample {
                session_type: SessionType::Unknown,
                time_offset: 0,
                weather: Weather::Clear,
                track_temperature: 0,
                air_temperature: 0,
            },
            WeatherForecastSample {
                session_type: SessionType::Unknown,
                time_offset: 0,
                weather: Weather::Clear,
                track_temperature: 0,
                air_temperature: 0,
            },
        ],
    };

    assert_eq!(actual, expected);
}

#[test]
#[serial]
fn test_parse_2020_lap_packet() {
    let stream = utils::get_stream();

    utils::send_raw_data(&stream, "e407010e0102599832db55618ae11d62cc429e0b000013ff000000003b59cc4200000000000000000000000000000000000000000000000084de6cc584de6cc5000000801001000100000b0302000000003b59cc42000000000000000000000000000000000000000000000000909f21c4909f21c400000080130100020000090302000000003b59cc42000000000000000000000000000000000000000000000000f24db2c5f24db2c500000080030101000000050002000000003b59cc420000000000000000000000000000000000000000000000004af6e7c44af6e7c400000080090100020000100302000000003b59cc420000000000000000000000000000000000000000000000002818b2c52818b2c5000000800f0101000000030002000000003b59cc42000000000000000000000000000000000000000000000000c9a7b1c5c9a7b1c500000080110101000000070002000000003b59cc42000000000000000000000000000000000000000000000000bed7d7c4bed7d7c4000000800101000200000a0302000000003b59cc42000000000000000000000000000000000000000000000000d87c99c4d87c99c4000000800e01000200000d0302000000003b59cc42000000000000000000000000000000000000000000000000c6265fc5c6265fc5000000800c0100010000140302000000003b59cc42000000000000000000000000000000000000000000000000d856b0c5d856b0c500000080070100000000080002000000003b59cc4200000000000000000000000000000000000000000000000090c0dec390c0dec3000000801401000200000f0302000000003b59cc42000000000000000000000000000000000000000000000000e13bafc5e13bafc500000080060100000000130002000000003b59cc420000000000000000000000000000000000000000000000006a76afc56a76afc5000000800b01000000000c0002000000003b59cc42000000000000000000000000000000000000000000000000007664c3007664c300000080120100020000040302000000003b59cc42000000000000000000000000000000000000000000000000c6feadc5c6feadc5000000800d0101000000120302000000003b59cc420000000000000000000000000000000000000000000000008dddb1c58dddb1c5000000800801010000000e0002000000003b59cc420000000000000000000000000000000000000000000000005c4083c45c4083c400000080040100020000110302000000003b59cc420000000000000000000000000000000000000000000000008f5d65c58f5d65c500000080020100010000010302000000003b59cc420000000000000000000000000000000000000000000000004f1cb0c54f1cb0c5000000800a0100000000060002000000003b59cc42000000000000000000000000000000000000000000000000eaabafc5eaabafc50000008005010100000002000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000");

    let p = utils::get_packet(&stream).unwrap().unwrap();

    let actual = match p {
        Packet::Lap(s) => s,
        _ => panic!("Invalid packet. Expected Lap, got {:?}", &p),
    };

    assert_eq!(actual.header().packet_format, 2020);

    let expected = PacketLapData::new(
        actual.header().clone(),
        vec![
            LapData::new(
                0,
                102174,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -3789.9072,
                -3789.9072,
                -0.0,
                16,
                1,
                PitStatus::None,
                1,
                false,
                0,
                11,
                DriverStatus::OutLap,
                ResultStatus::Active,
            ),
            LapData::new(
                0,
                102174,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -646.49316,
                -646.49316,
                -0.0,
                19,
                1,
                PitStatus::None,
                2,
                false,
                0,
                9,
                DriverStatus::OutLap,
                ResultStatus::Active,
            ),
            LapData::new(
                0,
                102174,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -5705.743,
                -5705.743,
                -0.0,
                3,
                1,
                PitStatus::Pitting,
                0,
                false,
                0,
                5,
                DriverStatus::Garage,
                ResultStatus::Active,
            ),
            LapData::new(
                0,
                102174,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -1855.6965,
                -1855.6965,
                -0.0,
                9,
                1,
                PitStatus::None,
                2,
                false,
                0,
                16,
                DriverStatus::OutLap,
                ResultStatus::Active,
            ),
            LapData::new(
                0,
                102174,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -5699.0195,
                -5699.0195,
                -0.0,
                15,
                1,
                PitStatus::Pitting,
                0,
                false,
                0,
                3,
                DriverStatus::Garage,
                ResultStatus::Active,
            ),
            LapData::new(
                0,
                102174,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -5684.973,
                -5684.973,
                -0.0,
                17,
                1,
                PitStatus::Pitting,
                0,
                false,
                0,
                7,
                DriverStatus::Garage,
                ResultStatus::Active,
            ),
            LapData::new(
                0,
                102174,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -1726.742,
                -1726.742,
                -0.0,
                1,
                1,
                PitStatus::None,
                2,
                false,
                0,
                10,
                DriverStatus::OutLap,
                ResultStatus::Active,
            ),
            LapData::new(
                0,
                102174,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -1227.9014,
                -1227.9014,
                -0.0,
                14,
                1,
                PitStatus::None,
                2,
                false,
                0,
                13,
                DriverStatus::OutLap,
                ResultStatus::Active,
            ),
            LapData::new(
                0,
                102174,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -3570.4233,
                -3570.4233,
                -0.0,
                12,
                1,
                PitStatus::None,
                1,
                false,
                0,
                20,
                DriverStatus::OutLap,
                ResultStatus::Active,
            ),
            LapData::new(
                0,
                102174,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -5642.8555,
                -5642.8555,
                -0.0,
                7,
                1,
                PitStatus::None,
                0,
                false,
                0,
                8,
                DriverStatus::Garage,
                ResultStatus::Active,
            ),
            LapData::new(
                0,
                102174,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -445.5044,
                -445.5044,
                -0.0,
                20,
                1,
                PitStatus::None,
                2,
                false,
                0,
                15,
                DriverStatus::OutLap,
                ResultStatus::Active,
            ),
            LapData::new(
                0,
                102174,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -5607.485,
                -5607.485,
                -0.0,
                6,
                1,
                PitStatus::None,
                0,
                false,
                0,
                19,
                DriverStatus::Garage,
                ResultStatus::Active,
            ),
            LapData::new(
                0,
                102174,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -5614.802,
                -5614.802,
                -0.0,
                11,
                1,
                PitStatus::None,
                0,
                false,
                0,
                12,
                DriverStatus::Garage,
                ResultStatus::Active,
            ),
            LapData::new(
                0,
                102174,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -228.46094,
                -228.46094,
                -0.0,
                18,
                1,
                PitStatus::None,
                2,
                false,
                0,
                4,
                DriverStatus::OutLap,
                ResultStatus::Active,
            ),
            LapData::new(
                0,
                102174,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -5567.8467,
                -5567.8467,
                -0.0,
                13,
                1,
                PitStatus::Pitting,
                0,
                false,
                0,
                18,
                DriverStatus::OutLap,
                ResultStatus::Active,
            ),
            LapData::new(
                0,
                102174,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -5691.694,
                -5691.694,
                -0.0,
                8,
                1,
                PitStatus::Pitting,
                0,
                false,
                0,
                14,
                DriverStatus::Garage,
                ResultStatus::Active,
            ),
            LapData::new(
                0,
                102174,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -1050.0112,
                -1050.0112,
                -0.0,
                4,
                1,
                PitStatus::None,
                2,
                false,
                0,
                17,
                DriverStatus::OutLap,
                ResultStatus::Active,
            ),
            LapData::new(
                0,
                102174,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -3669.8474,
                -3669.8474,
                -0.0,
                2,
                1,
                PitStatus::None,
                1,
                false,
                0,
                1,
                DriverStatus::OutLap,
                ResultStatus::Active,
            ),
            LapData::new(
                0,
                102174,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -5635.5386,
                -5635.5386,
                -0.0,
                10,
                1,
                PitStatus::None,
                0,
                false,
                0,
                6,
                DriverStatus::Garage,
                ResultStatus::Active,
            ),
            LapData::new(
                0,
                102174,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -5621.4893,
                -5621.4893,
                -0.0,
                5,
                1,
                PitStatus::Pitting,
                0,
                false,
                0,
                2,
                DriverStatus::Garage,
                ResultStatus::Active,
            ),
            LapData::new(
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0.0,
                0.0,
                0.0,
                0,
                0,
                PitStatus::None,
                0,
                false,
                0,
                0,
                DriverStatus::Garage,
                ResultStatus::Invalid,
            ),
            LapData::new(
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0.0,
                0.0,
                0.0,
                0,
                0,
                PitStatus::None,
                0,
                false,
                0,
                0,
                DriverStatus::Garage,
                ResultStatus::Invalid,
            ),
        ],
    );

    assert_eq!(actual, expected);
}

#[test]
#[serial]
fn test_parse_2020_event_packet() {
    let stream = utils::get_stream();
    let socket = utils::get_connected_socket(&stream);

    let data =
        hex::decode("e407010e0103599832db55618ae1e143e142da0c000013ff535054500de1b6aa430000")
            .unwrap();
    let res = socket.send(&data);

    assert!(res.is_ok());
    assert_eq!(res.unwrap(), data.len());

    let p = utils::get_packet(&stream).unwrap().unwrap();

    let actual = match p {
        Packet::Event(s) => s,
        _ => panic!("Invalid packet. Expected Event, got {:?}", &p),
    };

    assert_eq!(actual.header().packet_format, 2020);

    let expected = PacketEventData::new(
        actual.header().clone(),
        Event::SpeedTrap(SpeedTrap::new(13, 341.42874)),
    );

    assert_eq!(actual, expected);
}

#[test]
#[serial]
fn test_parse_2020_participants_packet() {
    let stream = utils::get_stream();

    utils::send_raw_data(&stream, "e407010e0104599832db55618ae1ca27d242f50b000013ff140107002c0a48414d494c544f4e0000000000000000000000000000000000000000000000000000000000000000000000000000000001010f004d1b424f5454415300000000000000000000000000000000000000000000000000000000000000000000000000000000000001010d01051d56455454454c00000000000000000000000000000000000000000000000000000000000000000000000000000000000001013a0110354c45434c45524300000000000000000000000000000000000000000000000000000000000000000000000000000000000101090221165645525354415050454e000000000000000000000000000000000000000000000000000000000000000000000000000001010008374e5341494e5a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010205030352494343494152444f000000000000000000000000000000000000000000000000000000000000000000000000000000010111051f1c4f434f4e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101061a444b565941540000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010e040b34504552455a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000001014a09632947494f56494e415a5a49000000000000000000000000000000000000000000000000000000000000000000000000000001010c07081c47524f534a45414e0000000000000000000000000000000000000000000000000000000000000000000000000000000001010b0714154d41474e555353454e000000000000000000000000000000000000000000000000000000000000000000000000000000010132033f0a52555353454c4c0000000000000000000000000000000000000000000000000000000000000000000000000000000000010064061b0a506c61796572000000000000000000000000000000000000000000000000000000000000000000000000000000000000000065020d0d506c6179657200000000000000000000000000000000000000000000000000000000000000000000000000000000000000013f03060d4c415449464900000000000000000000000000000000000000000000000000000000000000000000000000000000000001013608040a4e4f5252495300000000000000000000000000000000000000000000000000000000000000000000000000000000000001011304120d5354524f4c4c00000000000000000000000000000000000000000000000000000000000000000000000000000000000001006609070d506c6179657200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000");

    let p = utils::get_packet(&stream).unwrap().unwrap();

    let actual = match p {
        Packet::Participants(s) => s,
        _ => panic!("Invalid packet. Expected Participants, got {:?}", &p),
    };

    assert_eq!(actual.header().packet_format, 2020);

    let expected = PacketParticipantsData::new(
        actual.header().clone(),
        20,
        vec![
            ParticipantData::new(
                true,
                Driver::LewisHamilton,
                Team::Mercedes,
                44,
                Nationality::British,
                "HAMILTON".to_string(),
                Telemetry::Public,
            ),
            ParticipantData::new(
                true,
                Driver::ValtteriBottas,
                Team::Mercedes,
                77,
                Nationality::Finnish,
                "BOTTAS".to_string(),
                Telemetry::Public,
            ),
            ParticipantData::new(
                true,
                Driver::SebastianVettel,
                Team::Ferrari,
                5,
                Nationality::German,
                "VETTEL".to_string(),
                Telemetry::Public,
            ),
            ParticipantData::new(
                true,
                Driver::CharlesLeclerc,
                Team::Ferrari,
                16,
                Nationality::Monegasque,
                "LECLERC".to_string(),
                Telemetry::Public,
            ),
            ParticipantData::new(
                true,
                Driver::MaxVerstappen,
                Team::RedBullRacing,
                33,
                Nationality::Dutch,
                "VERSTAPPEN".to_string(),
                Telemetry::Public,
            ),
            ParticipantData::new(
                true,
                Driver::CarlosSainz,
                Team::McLaren,
                55,
                Nationality::Spanish,
                "SAINZ".to_string(),
                Telemetry::Public,
            ),
            ParticipantData::new(
                true,
                Driver::DanielRicciardo,
                Team::Renault,
                3,
                Nationality::Australian,
                "RICCIARDO".to_string(),
                Telemetry::Public,
            ),
            ParticipantData::new(
                true,
                Driver::EstebanOcon,
                Team::Renault,
                31,
                Nationality::French,
                "OCON".to_string(),
                Telemetry::Public,
            ),
            ParticipantData::new(
                true,
                Driver::DaniilKvyat,
                Team::AlphaTauri,
                26,
                Nationality::Russian,
                "KVYAT".to_string(),
                Telemetry::Public,
            ),
            ParticipantData::new(
                true,
                Driver::SergioPerez,
                Team::RacingPoint,
                11,
                Nationality::Mexican,
                "PEREZ".to_string(),
                Telemetry::Public,
            ),
            ParticipantData::new(
                true,
                Driver::AntonioGiovinazzi,
                Team::AlfaRomeo,
                99,
                Nationality::Italian,
                "GIOVINAZZI".to_string(),
                Telemetry::Public,
            ),
            ParticipantData::new(
                true,
                Driver::RomainGrosjean,
                Team::Haas,
                8,
                Nationality::French,
                "GROSJEAN".to_string(),
                Telemetry::Public,
            ),
            ParticipantData::new(
                true,
                Driver::KevinMagnussen,
                Team::Haas,
                20,
                Nationality::Danish,
                "MAGNUSSEN".to_string(),
                Telemetry::Public,
            ),
            ParticipantData::new(
                true,
                Driver::GeorgeRussell,
                Team::Williams,
                63,
                Nationality::British,
                "RUSSELL".to_string(),
                Telemetry::Public,
            ),
            ParticipantData::new(
                false,
                Driver::Player,
                Team::AlphaTauri,
                27,
                Nationality::British,
                "Player".to_string(),
                Telemetry::Restricted,
            ),
            ParticipantData::new(
                false,
                Driver::Player,
                Team::RedBullRacing,
                13,
                Nationality::Canadian,
                "Player".to_string(),
                Telemetry::Restricted,
            ),
            ParticipantData::new(
                true,
                Driver::NicholasLatifi,
                Team::Williams,
                6,
                Nationality::Canadian,
                "LATIFI".to_string(),
                Telemetry::Public,
            ),
            ParticipantData::new(
                true,
                Driver::LandoNorris,
                Team::McLaren,
                4,
                Nationality::British,
                "NORRIS".to_string(),
                Telemetry::Public,
            ),
            ParticipantData::new(
                true,
                Driver::LanceStroll,
                Team::RacingPoint,
                18,
                Nationality::Canadian,
                "STROLL".to_string(),
                Telemetry::Public,
            ),
            ParticipantData::new(
                false,
                Driver::Player,
                Team::AlfaRomeo,
                7,
                Nationality::Canadian,
                "Player".to_string(),
                Telemetry::Restricted,
            ),
            ParticipantData::new(
                false,
                Driver::CarlosSainz,
                Team::Mercedes,
                0,
                Nationality::Invalid,
                "".to_string(),
                Telemetry::Restricted,
            ),
            ParticipantData::new(
                false,
                Driver::CarlosSainz,
                Team::Mercedes,
                0,
                Nationality::Invalid,
                "".to_string(),
                Telemetry::Restricted,
            ),
        ],
    );

    assert_eq!(actual, expected);
}

#[test]
#[serial]
fn test_parse_2020_car_setups_packet() {
    let stream = utils::get_stream();

    utils::send_raw_data(&stream, "E407010E0105599832DB55618AE1B510CD42A80B000013FF05064641000040C00000C0BFCECCCC3D3433B33E050306050507643A0000AC410000AC410000B8410000B841060000E04005064641000040C00000C0BFCECCCC3D3433B33E050306050507643A0000AC410000AC410000B8410000B841060000E04005064641000040C00000C0BFCECCCC3D3433B33E050306050507643A0000AC410000AC410000B8410000B841060000E04005064641000040C00000C0BFCECCCC3D3433B33E050306050507643A0000AC410000AC410000B8410000B841060000E04005064641000040C00000C0BFCECCCC3D3433B33E050306050507643A0000AC410000AC410000B8410000B841060000E04005064641000040C00000C0BFCECCCC3D3433B33E050306050507643A0000AC410000AC410000B8410000B841060000E04005064641000040C00000C0BFCECCCC3D3433B33E050306050507643A0000AC410000AC410000B8410000B841060000E04005064641000040C00000C0BFCECCCC3D3433B33E050306050507643A0000AC410000AC410000B8410000B841060000E04005064641000040C00000C0BFCECCCC3D3433B33E050306050507643A0000AC410000AC410000B8410000B841060000E04005064641000040C00000C0BFCECCCC3D3433B33E050306050507643A0000AC410000AC410000B8410000B841060000E04005064641000040C00000C0BFCECCCC3D3433B33E050306050507643A0000AC410000AC410000B8410000B841060000E04005064641000040C00000C0BFCECCCC3D3433B33E050306050507643A0000AC410000AC410000B8410000B841060000E04005064641000040C00000C0BFCECCCC3D3433B33E050306050507643A0000AC410000AC410000B8410000B841060000E04005064641000040C00000C0BFCECCCC3D3433B33E050306050507643A0000AC410000AC410000B8410000B841060000E040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005064641000040C00000C0BFCECCCC3D3433B33E050306050507643A0000AC410000AC410000B8410000B841060000E04005064641000040C00000C0BFCECCCC3D3433B33E050306050507643A0000AC410000AC410000B8410000B841060000E04005064641000040C00000C0BFCECCCC3D3433B33E050306050507643A0000AC410000AC410000B8410000B841060000E0400106323C000040C00000C0BFCDCC4C3DCDCC4C3E020403050203643C6666A2416666A2410000B8410000B84106000000410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000");

    let p = utils::get_packet(&stream).unwrap().unwrap();

    let actual = match p {
        Packet::CarSetups(s) => s,
        _ => panic!("Invalid packet. Expected CarSetups, got {:?}", &p),
    };

    assert_eq!(actual.header().packet_format, 2020);

    let expected = PacketCarSetupData::new(
        actual.header().clone(),
        vec![
            CarSetupData::new(
                5,
                6,
                70,
                65,
                -3.0,
                -1.5,
                0.10000001,
                0.35000002,
                5,
                3,
                6,
                5,
                5,
                7,
                100,
                58,
                WheelData::new(21.5, 21.5, 23.0, 23.0),
                6,
                7.0,
            ),
            CarSetupData::new(
                5,
                6,
                70,
                65,
                -3.0,
                -1.5,
                0.10000001,
                0.35000002,
                5,
                3,
                6,
                5,
                5,
                7,
                100,
                58,
                WheelData::new(21.5, 21.5, 23.0, 23.0),
                6,
                7.0,
            ),
            CarSetupData::new(
                5,
                6,
                70,
                65,
                -3.0,
                -1.5,
                0.10000001,
                0.35000002,
                5,
                3,
                6,
                5,
                5,
                7,
                100,
                58,
                WheelData::new(21.5, 21.5, 23.0, 23.0),
                6,
                7.0,
            ),
            CarSetupData::new(
                5,
                6,
                70,
                65,
                -3.0,
                -1.5,
                0.10000001,
                0.35000002,
                5,
                3,
                6,
                5,
                5,
                7,
                100,
                58,
                WheelData::new(21.5, 21.5, 23.0, 23.0),
                6,
                7.0,
            ),
            CarSetupData::new(
                5,
                6,
                70,
                65,
                -3.0,
                -1.5,
                0.10000001,
                0.35000002,
                5,
                3,
                6,
                5,
                5,
                7,
                100,
                58,
                WheelData::new(21.5, 21.5, 23.0, 23.0),
                6,
                7.0,
            ),
            CarSetupData::new(
                5,
                6,
                70,
                65,
                -3.0,
                -1.5,
                0.10000001,
                0.35000002,
                5,
                3,
                6,
                5,
                5,
                7,
                100,
                58,
                WheelData::new(21.5, 21.5, 23.0, 23.0),
                6,
                7.0,
            ),
            CarSetupData::new(
                5,
                6,
                70,
                65,
                -3.0,
                -1.5,
                0.10000001,
                0.35000002,
                5,
                3,
                6,
                5,
                5,
                7,
                100,
                58,
                WheelData::new(21.5, 21.5, 23.0, 23.0),
                6,
                7.0,
            ),
            CarSetupData::new(
                5,
                6,
                70,
                65,
                -3.0,
                -1.5,
                0.10000001,
                0.35000002,
                5,
                3,
                6,
                5,
                5,
                7,
                100,
                58,
                WheelData::new(21.5, 21.5, 23.0, 23.0),
                6,
                7.0,
            ),
            CarSetupData::new(
                5,
                6,
                70,
                65,
                -3.0,
                -1.5,
                0.10000001,
                0.35000002,
                5,
                3,
                6,
                5,
                5,
                7,
                100,
                58,
                WheelData::new(21.5, 21.5, 23.0, 23.0),
                6,
                7.0,
            ),
            CarSetupData::new(
                5,
                6,
                70,
                65,
                -3.0,
                -1.5,
                0.10000001,
                0.35000002,
                5,
                3,
                6,
                5,
                5,
                7,
                100,
                58,
                WheelData::new(21.5, 21.5, 23.0, 23.0),
                6,
                7.0,
            ),
            CarSetupData::new(
                5,
                6,
                70,
                65,
                -3.0,
                -1.5,
                0.10000001,
                0.35000002,
                5,
                3,
                6,
                5,
                5,
                7,
                100,
                58,
                WheelData::new(21.5, 21.5, 23.0, 23.0),
                6,
                7.0,
            ),
            CarSetupData::new(
                5,
                6,
                70,
                65,
                -3.0,
                -1.5,
                0.10000001,
                0.35000002,
                5,
                3,
                6,
                5,
                5,
                7,
                100,
                58,
                WheelData::new(21.5, 21.5, 23.0, 23.0),
                6,
                7.0,
            ),
            CarSetupData::new(
                5,
                6,
                70,
                65,
                -3.0,
                -1.5,
                0.10000001,
                0.35000002,
                5,
                3,
                6,
                5,
                5,
                7,
                100,
                58,
                WheelData::new(21.5, 21.5, 23.0, 23.0),
                6,
                7.0,
            ),
            CarSetupData::new(
                5,
                6,
                70,
                65,
                -3.0,
                -1.5,
                0.10000001,
                0.35000002,
                5,
                3,
                6,
                5,
                5,
                7,
                100,
                58,
                WheelData::new(21.5, 21.5, 23.0, 23.0),
                6,
                7.0,
            ),
            CarSetupData::new(
                0,
                0,
                0,
                0,
                0.0,
                0.0,
                0.0,
                0.0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                WheelData::new(0.0, 0.0, 0.0, 0.0),
                0,
                0.0,
            ),
            CarSetupData::new(
                0,
                0,
                0,
                0,
                0.0,
                0.0,
                0.0,
                0.0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                WheelData::new(0.0, 0.0, 0.0, 0.0),
                0,
                0.0,
            ),
            CarSetupData::new(
                5,
                6,
                70,
                65,
                -3.0,
                -1.5,
                0.10000001,
                0.35000002,
                5,
                3,
                6,
                5,
                5,
                7,
                100,
                58,
                WheelData::new(21.5, 21.5, 23.0, 23.0),
                6,
                7.0,
            ),
            CarSetupData::new(
                5,
                6,
                70,
                65,
                -3.0,
                -1.5,
                0.10000001,
                0.35000002,
                5,
                3,
                6,
                5,
                5,
                7,
                100,
                58,
                WheelData::new(21.5, 21.5, 23.0, 23.0),
                6,
                7.0,
            ),
            CarSetupData::new(
                5,
                6,
                70,
                65,
                -3.0,
                -1.5,
                0.10000001,
                0.35000002,
                5,
                3,
                6,
                5,
                5,
                7,
                100,
                58,
                WheelData::new(21.5, 21.5, 23.0, 23.0),
                6,
                7.0,
            ),
            CarSetupData::new(
                1,
                6,
                50,
                60,
                -3.0,
                -1.5,
                0.05,
                0.2,
                2,
                4,
                3,
                5,
                2,
                3,
                100,
                60,
                WheelData::new(20.3, 20.3, 23.0, 23.0),
                6,
                8.0,
            ),
            CarSetupData::new(
                0,
                0,
                0,
                0,
                0.0,
                0.0,
                0.0,
                0.0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                WheelData::new(0.0, 0.0, 0.0, 0.0),
                0,
                0.0,
            ),
            CarSetupData::new(
                0,
                0,
                0,
                0,
                0.0,
                0.0,
                0.0,
                0.0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                WheelData::new(0.0, 0.0, 0.0, 0.0),
                0,
                0.0,
            ),
        ],
    );

    assert_eq!(actual, expected);
}

#[test]
#[serial]
fn test_parse_2020_car_telemetry_packet() {
    let stream = utils::get_stream();

    utils::send_raw_data(&stream, "E407010E0106599832DB55618AE11D62CC429E0B000013FF33010000803F00000000000000000008D1290000CB00C9008800860057545653525054535A00CDCCA841CDCCA8410000B8410000B84100000000BE000000000039D56A3E1255DF3D0005EA260000A803A603CE03C8035C55665B575559565A00CDCCA841CDCCA8410000B8410000B8410000000000000000000000000080000000000000DF100000220022002200220055555A5A55555A5A5A00CDCCA841CDCCA8410000B8410000B84100000000BA00000000003FD651BE0000000000052E2600000C030E032C0334035257575C565359545A00CDCCA841CDCCA8410000B8410000B8410000000000000000000000000080000000000000DF100000220022002200220055555A5A55555A5A5A00CDCCA841CDCCA8410000B8410000B8410000000000000000000000000080000000000000DF100000220022002200220055555A5A55555A5A5A00CDCCA841CDCCA8410000B8410000B84100000000D9000000803F0000003E0000000000050A2D003C07030803FB02FE02595B5D5D585A5C5D5900CDCCA841CDCCA8410000B8410000B8410001000133010000803F00000080000000000008E3290000800181012101240156585657565856585900CDCCA841CDCCA8410000B8410000B841000000009D000000603F0000003E0000000000034C2E00619C039D038F03900358565D5757555C575900CDCCA841CDCCA8410000B8410000B8410000010000000000000000000080000000000000DF100000220022002200220054545959545459595900CDCCA841CDCCA8410000B8410000B84100000000F6000000803F0000003E0000000000063B2C002602030103D202CF0267597058665870585900CDCCA841CDCCA8410000B8410000B8410000000000000000000000000080000000000000DF100000220022002200220054545959545459595900CDCCA841CDCCA8410000B8410000B8410000000000000000000000000080000000000000DF100000220022002200220054545959545459595900CDCCA841CDCCA8410000B8410000B8410000000027010000803F00000080000000000007482E00606E026D020002FE0163576555645766555900CDCCA841CDCCA8410000B8410000B841000000004F000000803F00000080000000000001FC260000D601C6012D02100253525B5B53525B5B5400CDCCA841CDCCA8410000B8410000B8410000000000000000000000000080000000000001DF100000220022002200220054545959545459595300CDCCA841CDCCA8410000B8410000B841000000003E010000803F00000080000000000008722B000F8D018E010F01100156565556555754565900CDCCA841CDCCA8410000B8410000B841000000007900000000000000B0BE0000A03E0003FB220000AD03AE03E303E40352525758525156555900CDCCA841CDCCA8410000B8410000B8410000000000000000000000000080000000000000DF100000220022002200220054545959545459595900CDCCA841CDCCA8410000B8410000B841000000000E000000000000000080000000000001DF100000300030002E002E0054545A5A545459595400CDCCA841CDCCA8410000B8410000B84100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFF00");

    let p = utils::get_packet(&stream).unwrap().unwrap();

    let actual = match p {
        Packet::CarTelemetry(s) => s,
        _ => panic!("Invalid packet. Expected CarTelemetry, got {:?}", &p),
    };

    assert_eq!(actual.header().packet_format, 2020);

    let expected = PacketCarTelemetryData::new(
        actual.header().clone(),
        vec![
            CarTelemetryData::new(
                307,
                1.0,
                0.0,
                0.0,
                0,
                8,
                10705,
                false,
                0,
                WheelData::new(203, 201, 136, 134),
                WheelData::new(87, 84, 86, 83),
                WheelData::new(82, 80, 84, 83),
                90,
                WheelData::new(21.1, 21.1, 23.0, 23.0),
                WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
            ),
            CarTelemetryData::new(
                190,
                0.0,
                0.229329,
                0.10904898,
                0,
                5,
                9962,
                false,
                0,
                WheelData::new(936, 934, 974, 968),
                WheelData::new(92, 85, 102, 91),
                WheelData::new(87, 85, 89, 86),
                90,
                WheelData::new(21.1, 21.1, 23.0, 23.0),
                WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
            ),
            CarTelemetryData::new(
                0,
                0.0,
                -0.0,
                0.0,
                0,
                0,
                4319,
                false,
                0,
                WheelData::new(34, 34, 34, 34),
                WheelData::new(85, 85, 90, 90),
                WheelData::new(85, 85, 90, 90),
                90,
                WheelData::new(21.1, 21.1, 23.0, 23.0),
                WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
            ),
            CarTelemetryData::new(
                186,
                0.0,
                -0.20491885,
                0.0,
                0,
                5,
                9774,
                false,
                0,
                WheelData::new(780, 782, 812, 820),
                WheelData::new(82, 87, 87, 92),
                WheelData::new(86, 83, 89, 84),
                90,
                WheelData::new(21.1, 21.1, 23.0, 23.0),
                WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
            ),
            CarTelemetryData::new(
                0,
                0.0,
                -0.0,
                0.0,
                0,
                0,
                4319,
                false,
                0,
                WheelData::new(34, 34, 34, 34),
                WheelData::new(85, 85, 90, 90),
                WheelData::new(85, 85, 90, 90),
                90,
                WheelData::new(21.1, 21.1, 23.0, 23.0),
                WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
            ),
            CarTelemetryData::new(
                0,
                0.0,
                -0.0,
                0.0,
                0,
                0,
                4319,
                false,
                0,
                WheelData::new(34, 34, 34, 34),
                WheelData::new(85, 85, 90, 90),
                WheelData::new(85, 85, 90, 90),
                90,
                WheelData::new(21.1, 21.1, 23.0, 23.0),
                WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
            ),
            CarTelemetryData::new(
                217,
                1.0,
                0.125,
                0.0,
                0,
                5,
                11530,
                false,
                60,
                WheelData::new(775, 776, 763, 766),
                WheelData::new(89, 91, 93, 93),
                WheelData::new(88, 90, 92, 93),
                89,
                WheelData::new(21.1, 21.1, 23.0, 23.0),
                WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::RumbleStrip,
                    SurfaceType::Tarmac,
                    SurfaceType::RumbleStrip,
                ),
            ),
            CarTelemetryData::new(
                307,
                1.0,
                -0.0,
                0.0,
                0,
                8,
                10723,
                false,
                0,
                WheelData::new(384, 385, 289, 292),
                WheelData::new(86, 88, 86, 87),
                WheelData::new(86, 88, 86, 88),
                89,
                WheelData::new(21.1, 21.1, 23.0, 23.0),
                WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
            ),
            CarTelemetryData::new(
                157,
                0.875,
                0.125,
                0.0,
                0,
                3,
                11852,
                false,
                97,
                WheelData::new(924, 925, 911, 912),
                WheelData::new(88, 86, 93, 87),
                WheelData::new(87, 85, 92, 87),
                89,
                WheelData::new(21.1, 21.1, 23.0, 23.0),
                WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::RumbleStrip,
                    SurfaceType::Tarmac,
                ),
            ),
            CarTelemetryData::new(
                0,
                0.0,
                -0.0,
                0.0,
                0,
                0,
                4319,
                false,
                0,
                WheelData::new(34, 34, 34, 34),
                WheelData::new(84, 84, 89, 89),
                WheelData::new(84, 84, 89, 89),
                89,
                WheelData::new(21.1, 21.1, 23.0, 23.0),
                WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
            ),
            CarTelemetryData::new(
                246,
                1.0,
                0.125,
                0.0,
                0,
                6,
                11323,
                false,
                38,
                WheelData::new(770, 769, 722, 719),
                WheelData::new(103, 89, 112, 88),
                WheelData::new(102, 88, 112, 88),
                89,
                WheelData::new(21.1, 21.1, 23.0, 23.0),
                WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
            ),
            CarTelemetryData::new(
                0,
                0.0,
                -0.0,
                0.0,
                0,
                0,
                4319,
                false,
                0,
                WheelData::new(34, 34, 34, 34),
                WheelData::new(84, 84, 89, 89),
                WheelData::new(84, 84, 89, 89),
                89,
                WheelData::new(21.1, 21.1, 23.0, 23.0),
                WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
            ),
            CarTelemetryData::new(
                0,
                0.0,
                -0.0,
                0.0,
                0,
                0,
                4319,
                false,
                0,
                WheelData::new(34, 34, 34, 34),
                WheelData::new(84, 84, 89, 89),
                WheelData::new(84, 84, 89, 89),
                89,
                WheelData::new(21.1, 21.1, 23.0, 23.0),
                WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
            ),
            CarTelemetryData::new(
                295,
                1.0,
                -0.0,
                0.0,
                0,
                7,
                11848,
                false,
                96,
                WheelData::new(622, 621, 512, 510),
                WheelData::new(99, 87, 101, 85),
                WheelData::new(100, 87, 102, 85),
                89,
                WheelData::new(21.1, 21.1, 23.0, 23.0),
                WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
            ),
            CarTelemetryData::new(
                79,
                1.0,
                -0.0,
                0.0,
                0,
                1,
                9980,
                false,
                0,
                WheelData::new(470, 454, 557, 528),
                WheelData::new(83, 82, 91, 91),
                WheelData::new(83, 82, 91, 91),
                84,
                WheelData::new(21.1, 21.1, 23.0, 23.0),
                WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
            ),
            CarTelemetryData::new(
                0,
                0.0,
                -0.0,
                0.0,
                0,
                1,
                4319,
                false,
                0,
                WheelData::new(34, 34, 34, 34),
                WheelData::new(84, 84, 89, 89),
                WheelData::new(84, 84, 89, 89),
                83,
                WheelData::new(21.1, 21.1, 23.0, 23.0),
                WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
            ),
            CarTelemetryData::new(
                318,
                1.0,
                -0.0,
                0.0,
                0,
                8,
                11122,
                false,
                15,
                WheelData::new(397, 398, 271, 272),
                WheelData::new(86, 86, 85, 86),
                WheelData::new(85, 87, 84, 86),
                89,
                WheelData::new(21.1, 21.1, 23.0, 23.0),
                WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
            ),
            CarTelemetryData::new(
                121,
                0.0,
                -0.34375,
                0.3125,
                0,
                3,
                8955,
                false,
                0,
                WheelData::new(941, 942, 995, 996),
                WheelData::new(82, 82, 87, 88),
                WheelData::new(82, 81, 86, 85),
                89,
                WheelData::new(21.1, 21.1, 23.0, 23.0),
                WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
            ),
            CarTelemetryData::new(
                0,
                0.0,
                -0.0,
                0.0,
                0,
                0,
                4319,
                false,
                0,
                WheelData::new(34, 34, 34, 34),
                WheelData::new(84, 84, 89, 89),
                WheelData::new(84, 84, 89, 89),
                89,
                WheelData::new(21.1, 21.1, 23.0, 23.0),
                WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
            ),
            CarTelemetryData::new(
                14,
                0.0,
                -0.0,
                0.0,
                0,
                1,
                4319,
                false,
                0,
                WheelData::new(48, 48, 46, 46),
                WheelData::new(84, 84, 90, 90),
                WheelData::new(84, 84, 89, 89),
                84,
                WheelData::new(21.1, 21.1, 23.0, 23.0),
                WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
            ),
            CarTelemetryData::new(
                0,
                0.0,
                0.0,
                0.0,
                0,
                0,
                0,
                false,
                0,
                WheelData::new(0, 0, 0, 0),
                WheelData::new(0, 0, 0, 0),
                WheelData::new(0, 0, 0, 0),
                0,
                WheelData::new(0.0, 0.0, 0.0, 0.0),
                WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
            ),
            CarTelemetryData::new(
                0,
                0.0,
                0.0,
                0.0,
                0,
                0,
                0,
                false,
                0,
                WheelData::new(0, 0, 0, 0),
                WheelData::new(0, 0, 0, 0),
                WheelData::new(0, 0, 0, 0),
                0,
                WheelData::new(0.0, 0.0, 0.0, 0.0),
                WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
            ),
        ],
        0,
        MFDPanel::Closed,
        MFDPanel::Closed,
        Some(0),
    );

    assert_eq!(actual, expected)
}

#[test]
#[serial]
fn test_parse_2020_car_status_packet() {
    let stream = utils::get_stream();

    utils::send_raw_data(&stream, "e407010e0107599832db55618ae11d62cc429e0b000013ff0001003c0070c8a9400000dc423d473040c832cc10090000000000000011100000000000000000000000000024744a000000000000000000000000000001033c00450a8f400000dc429dfa1340c832cc10090000000101010111100001010101000000000000007a3f6e4a03f2ea5f488823a3475de3c7480201003c000000e0400000dc429ba66940c832cc10090000000000000011100000000000000000000000000024744a000000000000000000000000000001003c002a129d400000dc4290d32240c832cc10090000000100010011100001000100000000000000000024744a000000000000000000000000000201003c000000e0400000dc429ba66940c832cc10090000000000000011100000000000000000000000000024744a000000000000000000000000000201003c000000e0400000dc429ba66940c832cc10090000000000000011100000000000000000000000000024744a000000000000000000000000000201003c00a9579c400000dc42340e2240c832cc10090000000100000011100001000000000000000000000024744a000000000000000000000000000201033c00692a98400000dc42b9a21d40c832cc100900000001010100111000010101000000000000000049256a4a03000000000000000017cd0a480201003c0086eea8400000dc42a4602f40c832cc10090000000000000011100000000000000000000000000024744a000000000000000000000000000201003c00a37ee1400000dc42833b6b40c832cc10090000000000000011100000000000000000000000000024744a000000000000000000000000000201033c0008ae8f400000dc42e8a71440c832cc1009000000010101001110000101010000000000000000e3f2634a031b61664857402348053319490201003c00a37ee1400000dc42833b6b40c832cc10090000000000000011100000000000000000000000000024744a000000000000000000000000000201003c00a37ee1400000dc42833b6b40c832cc10090000000000000011100000000000000000000000000024744a000000000000000000000000000201033c0012f18b400000dc4240b31040c832cc100900000001010101111000010101010000000000000045f6574a03833570489adc2048ddc74c490201000001000000000000000000000000c832cc100900000000000000121100000000000000000000000000000000000000000000000000000000000201000000000000000000000000000000c832cc100900000000000000111000000000000000000000000000000000000000000000000000000000000201033c000ceb95400000dc42df411b40c832cc10090000000101000011100001010000000000000000005d06654a030000000000000000efa460480201003c004ed4aa400000dc42b2623140c832cc10090000000000000011100000000000000000000000000024744a000000000000000000000000000201003c00a37ee1400000dc42833b6b40c832cc10090000000000000011100000000000000000000000000024744a000000000000000000000000000201003c01000000410000dc42b2c18540c832cc10090000000000000011100000000000000000000000000024744a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000");

    let p = utils::get_packet(&stream).unwrap().unwrap();

    let actual = match p {
        Packet::CarStatus(s) => s,
        _ => panic!("Invalid packet. Expected CarStatus, got {:?}", &p),
    };

    assert_eq!(actual.header().packet_format, 2020);

    let expected = PacketCarStatusData::new(
        actual.header().clone(),
        vec![
            CarStatusData::new(
                TractionControl::Off,
                true,
                FuelMix::Lean,
                60,
                false,
                5.3057175,
                110.0,
                2.754348,
                13000,
                4300,
                9,
                DRS::NotAllowed,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                TyreCompound::C4,
                TyreCompoundVisual::Soft,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                0,
                0,
                0,
                false,
                0,
                0,
                Flag::None,
                4000000.0,
                ERSDeployMode::None,
                0.0,
                0.0,
                0.0,
            ),
            CarStatusData::new(
                TractionControl::Off,
                true,
                FuelMix::Max,
                60,
                false,
                4.4700036,
                110.0,
                2.3121712,
                13000,
                4300,
                9,
                DRS::NotAllowed,
                Some(0),
                WheelData::new(1, 1, 1, 1),
                TyreCompound::C4,
                TyreCompoundVisual::Soft,
                Some(0),
                WheelData::new(1, 1, 1, 1),
                0,
                0,
                0,
                false,
                0,
                0,
                Flag::None,
                3903454.5,
                ERSDeployMode::Hotlap,
                229291.78,
                83527.06,
                409370.9,
            ),
            CarStatusData::new(
                TractionControl::High,
                true,
                FuelMix::Lean,
                60,
                false,
                7.0,
                110.0,
                3.6507938,
                13000,
                4300,
                9,
                DRS::NotAllowed,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                TyreCompound::C4,
                TyreCompoundVisual::Soft,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                0,
                0,
                0,
                false,
                0,
                0,
                Flag::None,
                4000000.0,
                ERSDeployMode::None,
                0.0,
                0.0,
                0.0,
            ),
            CarStatusData::new(
                TractionControl::Off,
                true,
                FuelMix::Lean,
                60,
                false,
                4.9084673,
                110.0,
                2.5441628,
                13000,
                4300,
                9,
                DRS::NotAllowed,
                Some(0),
                WheelData::new(1, 0, 1, 0),
                TyreCompound::C4,
                TyreCompoundVisual::Soft,
                Some(0),
                WheelData::new(1, 0, 1, 0),
                0,
                0,
                0,
                false,
                0,
                0,
                Flag::None,
                4000000.0,
                ERSDeployMode::None,
                0.0,
                0.0,
                0.0,
            ),
            CarStatusData::new(
                TractionControl::High,
                true,
                FuelMix::Lean,
                60,
                false,
                7.0,
                110.0,
                3.6507938,
                13000,
                4300,
                9,
                DRS::NotAllowed,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                TyreCompound::C4,
                TyreCompoundVisual::Soft,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                0,
                0,
                0,
                false,
                0,
                0,
                Flag::None,
                4000000.0,
                ERSDeployMode::None,
                0.0,
                0.0,
                0.0,
            ),
            CarStatusData::new(
                TractionControl::High,
                true,
                FuelMix::Lean,
                60,
                false,
                7.0,
                110.0,
                3.6507938,
                13000,
                4300,
                9,
                DRS::NotAllowed,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                TyreCompound::C4,
                TyreCompoundVisual::Soft,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                0,
                0,
                0,
                false,
                0,
                0,
                Flag::None,
                4000000.0,
                ERSDeployMode::None,
                0.0,
                0.0,
                0.0,
            ),
            CarStatusData::new(
                TractionControl::High,
                true,
                FuelMix::Lean,
                60,
                false,
                4.8857007,
                110.0,
                2.532117,
                13000,
                4300,
                9,
                DRS::NotAllowed,
                Some(0),
                WheelData::new(1, 0, 0, 0),
                TyreCompound::C4,
                TyreCompoundVisual::Soft,
                Some(0),
                WheelData::new(1, 0, 0, 0),
                0,
                0,
                0,
                false,
                0,
                0,
                Flag::None,
                4000000.0,
                ERSDeployMode::None,
                0.0,
                0.0,
                0.0,
            ),
            CarStatusData::new(
                TractionControl::High,
                true,
                FuelMix::Max,
                60,
                false,
                4.755177,
                110.0,
                2.4630568,
                13000,
                4300,
                9,
                DRS::NotAllowed,
                Some(0),
                WheelData::new(1, 1, 1, 0),
                TyreCompound::C4,
                TyreCompoundVisual::Soft,
                Some(0),
                WheelData::new(1, 1, 1, 0),
                0,
                0,
                0,
                false,
                0,
                0,
                Flag::None,
                3836242.3,
                ERSDeployMode::Hotlap,
                0.0,
                0.0,
                142132.36,
            ),
            CarStatusData::new(
                TractionControl::High,
                true,
                FuelMix::Lean,
                60,
                false,
                5.2791166,
                110.0,
                2.7402735,
                13000,
                4300,
                9,
                DRS::NotAllowed,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                TyreCompound::C4,
                TyreCompoundVisual::Soft,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                0,
                0,
                0,
                false,
                0,
                0,
                Flag::None,
                4000000.0,
                ERSDeployMode::None,
                0.0,
                0.0,
                0.0,
            ),
            CarStatusData::new(
                TractionControl::High,
                true,
                FuelMix::Lean,
                60,
                false,
                7.0467086,
                110.0,
                3.6755073,
                13000,
                4300,
                9,
                DRS::NotAllowed,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                TyreCompound::C4,
                TyreCompoundVisual::Soft,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                0,
                0,
                0,
                false,
                0,
                0,
                Flag::None,
                4000000.0,
                ERSDeployMode::None,
                0.0,
                0.0,
                0.0,
            ),
            CarStatusData::new(
                TractionControl::High,
                true,
                FuelMix::Max,
                60,
                false,
                4.489994,
                110.0,
                2.3227482,
                13000,
                4300,
                9,
                DRS::NotAllowed,
                Some(0),
                WheelData::new(1, 1, 1, 0),
                TyreCompound::C4,
                TyreCompoundVisual::Soft,
                Some(0),
                WheelData::new(1, 1, 1, 0),
                0,
                0,
                0,
                false,
                0,
                0,
                Flag::None,
                3734712.8,
                ERSDeployMode::Hotlap,
                235908.42,
                167169.36,
                627504.3,
            ),
            CarStatusData::new(
                TractionControl::High,
                true,
                FuelMix::Lean,
                60,
                false,
                7.0467086,
                110.0,
                3.6755073,
                13000,
                4300,
                9,
                DRS::NotAllowed,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                TyreCompound::C4,
                TyreCompoundVisual::Soft,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                0,
                0,
                0,
                false,
                0,
                0,
                Flag::None,
                4000000.0,
                ERSDeployMode::None,
                0.0,
                0.0,
                0.0,
            ),
            CarStatusData::new(
                TractionControl::High,
                true,
                FuelMix::Lean,
                60,
                false,
                7.0467086,
                110.0,
                3.6755073,
                13000,
                4300,
                9,
                DRS::NotAllowed,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                TyreCompound::C4,
                TyreCompoundVisual::Soft,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                0,
                0,
                0,
                false,
                0,
                0,
                Flag::None,
                4000000.0,
                ERSDeployMode::None,
                0.0,
                0.0,
                0.0,
            ),
            CarStatusData::new(
                TractionControl::High,
                true,
                FuelMix::Max,
                60,
                false,
                4.3731775,
                110.0,
                2.2609406,
                13000,
                4300,
                9,
                DRS::NotAllowed,
                Some(0),
                WheelData::new(1, 1, 1, 1),
                TyreCompound::C4,
                TyreCompoundVisual::Soft,
                Some(0),
                WheelData::new(1, 1, 1, 1),
                0,
                0,
                0,
                false,
                0,
                0,
                Flag::None,
                3538321.3,
                ERSDeployMode::Hotlap,
                245974.05,
                164722.4,
                838781.8,
            ),
            CarStatusData::new(
                TractionControl::High,
                true,
                FuelMix::Lean,
                0,
                true,
                0.0,
                0.0,
                0.0,
                13000,
                4300,
                9,
                DRS::NotAllowed,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                TyreCompound::C3,
                TyreCompoundVisual::Medium,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                0,
                0,
                0,
                false,
                0,
                0,
                Flag::None,
                0.0,
                ERSDeployMode::None,
                0.0,
                0.0,
                0.0,
            ),
            CarStatusData::new(
                TractionControl::High,
                true,
                FuelMix::Lean,
                0,
                false,
                0.0,
                0.0,
                0.0,
                13000,
                4300,
                9,
                DRS::NotAllowed,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                TyreCompound::C4,
                TyreCompoundVisual::Soft,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                0,
                0,
                0,
                false,
                0,
                0,
                Flag::None,
                0.0,
                ERSDeployMode::None,
                0.0,
                0.0,
                0.0,
            ),
            CarStatusData::new(
                TractionControl::High,
                true,
                FuelMix::Max,
                60,
                false,
                4.6849422,
                110.0,
                2.4258955,
                13000,
                4300,
                9,
                DRS::NotAllowed,
                Some(0),
                WheelData::new(1, 1, 0, 0),
                TyreCompound::C4,
                TyreCompoundVisual::Soft,
                Some(0),
                WheelData::new(1, 1, 0, 0),
                0,
                0,
                0,
                false,
                0,
                0,
                Flag::None,
                3752343.3,
                ERSDeployMode::Hotlap,
                0.0,
                0.0,
                230035.73,
            ),
            CarStatusData::new(
                TractionControl::High,
                true,
                FuelMix::Lean,
                60,
                false,
                5.338416,
                110.0,
                2.771649,
                13000,
                4300,
                9,
                DRS::NotAllowed,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                TyreCompound::C4,
                TyreCompoundVisual::Soft,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                0,
                0,
                0,
                false,
                0,
                0,
                Flag::None,
                4000000.0,
                ERSDeployMode::None,
                0.0,
                0.0,
                0.0,
            ),
            CarStatusData::new(
                TractionControl::High,
                true,
                FuelMix::Lean,
                60,
                false,
                7.0467086,
                110.0,
                3.6755073,
                13000,
                4300,
                9,
                DRS::NotAllowed,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                TyreCompound::C4,
                TyreCompoundVisual::Soft,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                0,
                0,
                0,
                false,
                0,
                0,
                Flag::None,
                4000000.0,
                ERSDeployMode::None,
                0.0,
                0.0,
                0.0,
            ),
            CarStatusData::new(
                TractionControl::High,
                true,
                FuelMix::Lean,
                60,
                true,
                8.0,
                110.0,
                4.1798944,
                13000,
                4300,
                9,
                DRS::NotAllowed,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                TyreCompound::C4,
                TyreCompoundVisual::Soft,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                0,
                0,
                0,
                false,
                0,
                0,
                Flag::None,
                4000000.0,
                ERSDeployMode::None,
                0.0,
                0.0,
                0.0,
            ),
            CarStatusData::new(
                TractionControl::Off,
                false,
                FuelMix::Lean,
                0,
                false,
                0.0,
                0.0,
                0.0,
                0,
                0,
                0,
                DRS::NotAllowed,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                TyreCompound::Invalid,
                TyreCompoundVisual::Invalid,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                0,
                0,
                0,
                false,
                0,
                0,
                Flag::None,
                0.0,
                ERSDeployMode::None,
                0.0,
                0.0,
                0.0,
            ),
            CarStatusData::new(
                TractionControl::Off,
                false,
                FuelMix::Lean,
                0,
                false,
                0.0,
                0.0,
                0.0,
                0,
                0,
                0,
                DRS::NotAllowed,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                TyreCompound::Invalid,
                TyreCompoundVisual::Invalid,
                Some(0),
                WheelData::new(0, 0, 0, 0),
                0,
                0,
                0,
                false,
                0,
                0,
                Flag::None,
                0.0,
                ERSDeployMode::None,
                0.0,
                0.0,
                0.0,
            ),
        ],
    );

    assert_eq!(actual, expected);
}

#[test]
#[serial]
fn test_parse_2020_final_classification_packet() {
    let stream = utils::get_stream();

    utils::send_raw_data(&stream, "e407010e01080000000000000000000000000000000000001401010b0000037a70a142000000400f2e5440000002111100000000000010100000000000000501090000036a13a242000000406d425440000002111100000000000010100000000000000701050000030126a24200000020c044544000000211110000000000001010000000000000020110000003f17ca142000000209e2f5440000002111100000000000010100000000000000a01030000031d4ea242000000a0c349544000000211110000000000001010000000000000060107000003a615a242000000c0b44254400000021111000000000000101000000000000010010a0000032fe6a242000000e0c55c54400000021111000000000000101000000000000004010d000003f2d9a142000000403e3b5440000002111100000000000010100000000000000f011400000314c8a242000000800259544000000211110000000000001010000000000000090108000003f237a24200000040fe465440000002111100000000000010100000000000000e020f00000336a3a242000000c066545440000003111111000000000010101000000000000c01130000030d62a242000000a0414c5440000002111100000000000010100000000000000d010c00000324a1a2420000008024545440000002111100000000000010100000000000000301040000032ec2a142000000c045385440000002111100000000000010100000000000001303120000077453a44200000020eb577240000002121100000000000011100000000000000b040e000003f052a242000000000000000000000111000000000000001000000000000000110111000003b060a34200000000166c5440000002111100000000000010100000000000000801010000039d35a242000000a0b3465440000002111100000000000010100000000000001201060000033f7ea342000000e0c76f5440000002111100000000000010100000000000001402020000074039a54200000020daee6640000001110000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000");

    let p = utils::get_packet(&stream).unwrap().unwrap();

    let actual = match p {
        Packet::FinalClassification(s) => s,
        _ => panic!("Invalid packet. Expected LobbyInfo, got {:?}", &p),
    };

    assert_eq!(actual.header().packet_format, 2020);

    let expected = PacketFinalClassificationData::new(
        actual.header().clone(),
        20,
        vec![
            FinalClassification::new(
                1,
                1,
                11,
                0,
                0,
                ResultStatus::Finished,
                80719,
                80719,
                0,
                0,
                2,
                vec![
                    TyreCompound::C4,
                    TyreCompound::C4,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
            ),
            FinalClassification::new(
                5,
                1,
                9,
                0,
                0,
                ResultStatus::Finished,
                81037,
                81037,
                0,
                0,
                2,
                vec![
                    TyreCompound::C4,
                    TyreCompound::C4,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
            ),
            FinalClassification::new(
                7,
                1,
                5,
                0,
                0,
                ResultStatus::Finished,
                81074,
                81074,
                0,
                0,
                2,
                vec![
                    TyreCompound::C4,
                    TyreCompound::C4,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
            ),
            FinalClassification::new(
                2,
                1,
                16,
                0,
                0,
                ResultStatus::Finished,
                80744,
                80744,
                0,
                0,
                2,
                vec![
                    TyreCompound::C4,
                    TyreCompound::C4,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
            ),
            FinalClassification::new(
                10,
                1,
                3,
                0,
                0,
                ResultStatus::Finished,
                81152,
                81152,
                0,
                0,
                2,
                vec![
                    TyreCompound::C4,
                    TyreCompound::C4,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
            ),
            FinalClassification::new(
                6,
                1,
                7,
                0,
                0,
                ResultStatus::Finished,
                81042,
                81042,
                0,
                0,
                2,
                vec![
                    TyreCompound::C4,
                    TyreCompound::C4,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
            ),
            FinalClassification::new(
                16,
                1,
                10,
                0,
                0,
                ResultStatus::Finished,
                81449,
                81449,
                0,
                0,
                2,
                vec![
                    TyreCompound::C4,
                    TyreCompound::C4,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
            ),
            FinalClassification::new(
                4,
                1,
                13,
                0,
                0,
                ResultStatus::Finished,
                80925,
                80925,
                0,
                0,
                2,
                vec![
                    TyreCompound::C4,
                    TyreCompound::C4,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
            ),
            FinalClassification::new(
                15,
                1,
                20,
                0,
                0,
                ResultStatus::Finished,
                81390,
                81390,
                0,
                0,
                2,
                vec![
                    TyreCompound::C4,
                    TyreCompound::C4,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
            ),
            FinalClassification::new(
                9,
                1,
                8,
                0,
                0,
                ResultStatus::Finished,
                81109,
                81109,
                0,
                0,
                2,
                vec![
                    TyreCompound::C4,
                    TyreCompound::C4,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
            ),
            FinalClassification::new(
                14,
                2,
                15,
                0,
                0,
                ResultStatus::Finished,
                81318,
                81318,
                0,
                0,
                3,
                vec![
                    TyreCompound::C4,
                    TyreCompound::C4,
                    TyreCompound::C4,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
            ),
            FinalClassification::new(
                12,
                1,
                19,
                0,
                0,
                ResultStatus::Finished,
                81191,
                81191,
                0,
                0,
                2,
                vec![
                    TyreCompound::C4,
                    TyreCompound::C4,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
            ),
            FinalClassification::new(
                13,
                1,
                12,
                0,
                0,
                ResultStatus::Finished,
                81314,
                81314,
                0,
                0,
                2,
                vec![
                    TyreCompound::C4,
                    TyreCompound::C4,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
            ),
            FinalClassification::new(
                3,
                1,
                4,
                0,
                0,
                ResultStatus::Finished,
                80879,
                80879,
                0,
                0,
                2,
                vec![
                    TyreCompound::C4,
                    TyreCompound::C4,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
            ),
            FinalClassification::new(
                19,
                3,
                18,
                0,
                0,
                ResultStatus::Retired,
                82162,
                293494,
                0,
                0,
                2,
                vec![
                    TyreCompound::C3,
                    TyreCompound::C4,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                vec![
                    TyreCompoundVisual::Medium,
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
            ),
            FinalClassification::new(
                11,
                4,
                14,
                0,
                0,
                ResultStatus::Finished,
                81161,
                0,
                0,
                0,
                1,
                vec![
                    TyreCompound::C4,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
            ),
            FinalClassification::new(
                17,
                1,
                17,
                0,
                0,
                ResultStatus::Finished,
                81688,
                81688,
                0,
                0,
                2,
                vec![
                    TyreCompound::C4,
                    TyreCompound::C4,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
            ),
            FinalClassification::new(
                8,
                1,
                1,
                0,
                0,
                ResultStatus::Finished,
                81104,
                81104,
                0,
                0,
                2,
                vec![
                    TyreCompound::C4,
                    TyreCompound::C4,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
            ),
            FinalClassification::new(
                18,
                1,
                6,
                0,
                0,
                ResultStatus::Finished,
                81746,
                81746,
                0,
                0,
                2,
                vec![
                    TyreCompound::C4,
                    TyreCompound::C4,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
            ),
            FinalClassification::new(
                20,
                2,
                2,
                0,
                0,
                ResultStatus::Retired,
                82611,
                183464,
                0,
                0,
                1,
                vec![
                    TyreCompound::C4,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
            ),
            FinalClassification::new(
                0,
                0,
                0,
                0,
                0,
                ResultStatus::Invalid,
                0,
                0,
                0,
                0,
                0,
                vec![
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                vec![
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
            ),
            FinalClassification::new(
                0,
                0,
                0,
                0,
                0,
                ResultStatus::Invalid,
                0,
                0,
                0,
                0,
                0,
                vec![
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                vec![
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
            ),
        ],
    );

    assert_eq!(actual, expected);
}

#[test]
#[serial]
fn test_parse_2020_lobby_info_packet() {
    let stream = utils::get_stream();

    utils::send_raw_data(&stream, "e407010e010900000000000000001c269544ad8b000013ff1401084e4361726c6f73205341494e5a0000000000000000000000000000000000000000000000000000000000000000000000000001064444616e69696c204b565941540000000000000000000000000000000000000000000000000000000000000000000000000001050344616e69656c2052494343494152444f00000000000000000000000000000000000000000000000000000000000000000001000a4c657769732048414d494c544f4e00000000000000000000000000000000000000000000000000000000000000000000000102164d6178205645525354415050454e00000000000000000000000000000000000000000000000000000000000000000000000107154b6576696e204d41474e555353454e0000000000000000000000000000000000000000000000000000000000000000000001071c526f6d61696e2047524f534a45414e0000000000000000000000000000000000000000000000000000000000000000000001011d53656261737469616e2056455454454c00000000000000000000000000000000000000000000000000000000000000000001043453657267696f20504552455a0000000000000000000000000000000000000000000000000000000000000000000000000001001b56616c747465726920424f545441530000000000000000000000000000000000000000000000000000000000000000000001051c4573746562616e204f434f4e0000000000000000000000000000000000000000000000000000000000000000000000000001040d4c616e6365205354524f4c4c0000000000000000000000000000000000000000000000000000000000000000000000000101030a47656f7267652052555353454c4c000000000000000000000000000000000000000000000000000000000000000000000101080a4c616e646f204e4f5252495300000000000000000000000000000000000000000000000000000000000000000000000001010135436861726c6573204c45434c4552430000000000000000000000000000000000000000000000000000000000000000000001030d4e6963686f6c6173204c415449464900000000000000000000000000000000000000000000000000000000000000000001010929416e746f6e696f2047494f56494e415a5a490000000000000000000000000000000000000000000000000000000000000000020d506c617965720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000090d506c617965720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060a506c617965720000000000000000000000000000000000000000000000000000000000000000000000000000000000000100ff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000");

    let p = utils::get_packet(&stream).unwrap().unwrap();

    let actual = match p {
        Packet::LobbyInfo(s) => s,
        _ => panic!("Invalid packet. Expected LobbyInfo, got {:?}", &p),
    };

    assert_eq!(actual.header().packet_format, 2020);

    let expected = PacketLobbyInfoData::new(
        actual.header().clone(),
        20,
        vec![
            Player::new(
                true,
                Team::McLaren,
                Nationality::Spanish,
                "Carlos SAINZ".to_string(),
                ReadyStatus::NotReady,
            ),
            Player::new(
                true,
                Team::AlphaTauri,
                Nationality::Russian,
                "Daniil KVYAT".to_string(),
                ReadyStatus::NotReady,
            ),
            Player::new(
                true,
                Team::Renault,
                Nationality::Australian,
                "Daniel RICCIARDO".to_string(),
                ReadyStatus::NotReady,
            ),
            Player::new(
                true,
                Team::Mercedes,
                Nationality::British,
                "Lewis HAMILTON".to_string(),
                ReadyStatus::NotReady,
            ),
            Player::new(
                true,
                Team::RedBullRacing,
                Nationality::Dutch,
                "Max VERSTAPPEN".to_string(),
                ReadyStatus::NotReady,
            ),
            Player::new(
                true,
                Team::Haas,
                Nationality::Danish,
                "Kevin MAGNUSSEN".to_string(),
                ReadyStatus::NotReady,
            ),
            Player::new(
                true,
                Team::Haas,
                Nationality::French,
                "Romain GROSJEAN".to_string(),
                ReadyStatus::NotReady,
            ),
            Player::new(
                true,
                Team::Ferrari,
                Nationality::German,
                "Sebastian VETTEL".to_string(),
                ReadyStatus::NotReady,
            ),
            Player::new(
                true,
                Team::RacingPoint,
                Nationality::Mexican,
                "Sergio PEREZ".to_string(),
                ReadyStatus::NotReady,
            ),
            Player::new(
                true,
                Team::Mercedes,
                Nationality::Finnish,
                "Valtteri BOTTAS".to_string(),
                ReadyStatus::NotReady,
            ),
            Player::new(
                true,
                Team::Renault,
                Nationality::French,
                "Esteban OCON".to_string(),
                ReadyStatus::NotReady,
            ),
            Player::new(
                true,
                Team::RacingPoint,
                Nationality::Canadian,
                "Lance STROLL".to_string(),
                ReadyStatus::Ready,
            ),
            Player::new(
                true,
                Team::Williams,
                Nationality::British,
                "George RUSSELL".to_string(),
                ReadyStatus::Ready,
            ),
            Player::new(
                true,
                Team::McLaren,
                Nationality::British,
                "Lando NORRIS".to_string(),
                ReadyStatus::Ready,
            ),
            Player::new(
                true,
                Team::Ferrari,
                Nationality::Monegasque,
                "Charles LECLERC".to_string(),
                ReadyStatus::NotReady,
            ),
            Player::new(
                true,
                Team::Williams,
                Nationality::Canadian,
                "Nicholas LATIFI".to_string(),
                ReadyStatus::Ready,
            ),
            Player::new(
                true,
                Team::AlfaRomeo,
                Nationality::Italian,
                "Antonio GIOVINAZZI".to_string(),
                ReadyStatus::NotReady,
            ),
            Player::new(
                false,
                Team::RedBullRacing,
                Nationality::Canadian,
                "Player".to_string(),
                ReadyStatus::NotReady,
            ),
            Player::new(
                false,
                Team::AlfaRomeo,
                Nationality::Canadian,
                "Player".to_string(),
                ReadyStatus::NotReady,
            ),
            Player::new(
                false,
                Team::AlphaTauri,
                Nationality::British,
                "Player".to_string(),
                ReadyStatus::Ready,
            ),
            Player::new(
                false,
                Team::MyTeam,
                Nationality::Invalid,
                "".to_string(),
                ReadyStatus::NotReady,
            ),
            Player::new(
                false,
                Team::MyTeam,
                Nationality::Invalid,
                "".to_string(),
                ReadyStatus::NotReady,
            ),
        ],
    );

    assert_eq!(actual, expected);
}
