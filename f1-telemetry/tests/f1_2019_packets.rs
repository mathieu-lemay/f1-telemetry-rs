use f1_telemetry::packet::car_setup::{CarSetupData, PacketCarSetupData};
use f1_telemetry::packet::car_status::{
    CarStatusData, ERSDeployMode, FuelMix, PacketCarStatusData, TractionControl, DRS,
};
use f1_telemetry::packet::car_telemetry::{
    CarTelemetryData, MFDPanel, PacketCarTelemetryData, SurfaceType,
};
use f1_telemetry::packet::event::{Event, FastestLap, PacketEventData};
use f1_telemetry::packet::generic::{
    Flag, Nationality, ResultStatus, SessionType, Team, TyreCompound, TyreCompoundVisual, WheelData,
};
use f1_telemetry::packet::lap::{DriverStatus, LapData, PacketLapData, PitStatus, Sector};
use f1_telemetry::packet::motion::{CarMotionData, PacketMotionData, PlayerCarData};
use f1_telemetry::packet::participants::{
    Driver, PacketParticipantsData, ParticipantData, Telemetry,
};
use f1_telemetry::packet::session::{
    Formula, MarshalZone, PacketSessionData, SafetyCar, Track, Weather,
};
use f1_telemetry::packet::Packet;

mod utils;

#[tokio::test]
async fn test_parse_2019_motion_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e30701160100fcc796d4ce430d49000a304269030000138616a1c364d190c245b9d9435bbb124224c4d5bfda2a11c0957f39fa86f7ba088305947ffcc4f73f2ac07b3fb872a13d24ced13f60bd2c3d8d8930bd2d4d96c31ffe81c27abb8d43b02e2bc251edcabf0aca4f4293ae35fdb6624f9dcafd87ae6c82ab3c2618093f0219a8bdaa9930bfc007dfbcd68c8d3c404380c3a3a57ec273c70f43e73185419a90e03e66ad32428c2b41015a78b48758fc912bd20011c0ba0d9d3f535ff73db5d6b13e809ef7bc4842ea3c15c3afc3aea685c28d26b043f8e7edc12157d2bf95973842dfbaecfba46b4a94fe00ddbab0c8243fe34c63c0de0c583ebc1212bf00092fbc8c84febb471a7ec30d667ec2b5974c43a58358c1750297be923a54421dde5cff6d7b978416fe1bde56e128c053f3753f331a533d933689be401581bc2d13753c53d27cc35d2a7ec27d6e1843dbba4b4144d88b3ec65f3b427c1eb1004f7cbb83d6fc7e1e55c820c033b9313f430e04be795c763ec070cfbc5cb9ca3ce2b07ac3f7157ec2ae1f434305091cc163626cbe4e805b4289e67bff6f7d95820dfe87e6929d2cc0fa50733fe29621beef244dbec0ed80bc4a96793c602881c30fd17ec2430c5643508593c12adedabe8a574a42f7d013ff0977fb8820fef5d0dc412cc05c88853f752facbb77b2c0be809385bce740703c293d79c3d3f57dc230fd37439cee81c080c057bda5cc5742ddf2ecff517fb1806afeddf21bf433c0e48c7d3f1d378c3d59a3d2bd00234bbc37274b3ca15480c3b6947ec22fcf5843540097c17794c4be17ca494241d013ffc07644891dfe3fd07bc72ec0deac25be6fe73c3c08c3c3bec05286bc89cb713c8edf81c3c9fb7ec2f9f207437c6da741f30c073f89102842cc3782012e73df8c8afcd137094a14c0fa3d8a3fc2e4113d8410e73e80a1f1bc43a6dd3c157a7bc3da217ec28ab92e438a67533f87152f3c7a564c427efe0500fc7f078053fe7efee9482ec0aff0143f776513bd671641bc00c056bcd9ca563c253391c3c24281c26d1b87437a4f27c22f51c5bf6268504275af37fd6f63949c2afe6aafe65267bf6b8d2c3f52339e3da54d2ebf40c1cbbc74706b3c070bb5c3fee086c27af0b843f32aa0c1d33bb9bf5971234271c886fb3873b48c91006dc89ac5fa3fe9d73bc0a82b69bda6ebe5be804d37bccdb091bb2e5c82c322f27ec2704b60436b17a7c1cbf1d5be79ff4942b2cd11ffb175548ae9fdb0cdca7328c0f8fb5a3f34020c3c25d7cebec08392bc64c8853c98c97ac328157ec2f94a23437f4aeb4052270c3ee06148424b0f5700147ff180d1fd4c0ff86a2bc007886b3f47b7003de658f53dc0978dbc2efd8b3cb40b79c3fff37dc2120d2c43eb2d034034bce83c997a51429c010b00fc7f07802afe9c01f17c25c0f107693f6b8971bd82564e3c80336bbc48256b3cdcf17bc38e397ec243d539431c14a1c0d8955abdc8b4524269f0eaff0a7ff8805afe69f04e2d2ec0f9a5733fe909a63b1524fabd802f53bcfc67533cae6d7dc3ce637ec21de5434329bd1ec1033098be0f4c5242a0e55eff3f7dc582fffd9ee55f3727c0ac31803f10fa91bde59554be801286bcd979803c992e88c3311780c2789a6e4372ef00c2882c5abfec684e428bba45fe7f6b899473fd85badcd4dbbfff0e34bf2df787bc4ce412bf0087c5bc3783a33c07f58741b3b40d414968204146d645404aede6c1726f24c25152534226372042e46cf6c443905cc502674345ca3fc0449ba273427a7372427e0474420cd0724289599eba302ac5ba454e493994dd253922566e3f10ba41bdba5d734290a51a3d0dc037be6277343dc2e5c03f0f9d7c40918c404000000080").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::Motion(m) => m,
        _ => panic!("Invalid packet. Expected Motion, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2019);

    let expected = PacketMotionData {
        header: actual.header.clone(),
        motion_data: vec![
            CarMotionData {
                world_position_x: -322.17596,
                world_position_y: -72.408966,
                world_position_z: 435.44742,
                world_velocity_x: 36.682964,
                world_velocity_y: -1.6700482,
                world_velocity_z: -2.2682405,
                world_forward_dir_x: 32661,
                world_forward_dir_y: -1479,
                world_forward_dir_z: -2170,
                world_right_dir_x: 2234,
                world_right_dir_y: 1411,
                world_right_dir_z: 32660,
                g_force_lateral: 1.935699,
                g_force_longitudinal: 0.98340094,
                g_force_vertical: 0.07883209,
                yaw: 1.6391034,
                pitch: 0.04217279,
                roll: -0.04309993,
            },
            CarMotionData {
                world_position_x: -300.60294,
                world_position_y: -64.99633,
                world_position_z: 283.46466,
                world_velocity_x: -42.795593,
                world_velocity_y: -1.5853673,
                world_velocity_z: 51.947304,
                world_forward_dir_x: -20845,
                world_forward_dir_y: -715,
                world_forward_dir_z: 25270,
                world_right_dir_x: -25265,
                world_right_dir_y: -566,
                world_right_dir_z: -20857,
                g_force_lateral: 0.020936213,
                g_force_longitudinal: 0.5355247,
                g_force_vertical: -0.08207895,
                yaw: -0.6898447,
                pitch: -0.027225375,
                roll: 0.01727907,
            },
            CarMotionData {
                world_position_x: -256.5254,
                world_position_y: -63.661755,
                world_position_z: 143.7791,
                world_velocity_x: 16.649366,
                world_velocity_y: 0.43860322,
                world_velocity_z: 44.669334,
                world_forward_dir_x: 11148,
                world_forward_dir_y: 321,
                world_forward_dir_z: 30810,
                world_right_dir_x: -30796,
                world_right_dir_y: -936,
                world_right_dir_z: 11153,
                g_force_lateral: -2.265675,
                g_force_longitudinal: 1.2269814,
                g_force_vertical: 0.120787285,
                yaw: 0.3473412,
                pitch: -0.030226946,
                roll: 0.028596058,
            },
            CarMotionData {
                world_position_x: -351.52408,
                world_position_y: -66.82555,
                world_position_z: 352.30118,
                world_velocity_x: -29.738266,
                world_velocity_y: -1.643284,
                world_velocity_z: 46.14803,
                world_forward_dir_x: -17697,
                world_forward_dir_y: -1044,
                world_forward_dir_z: 27556,
                world_right_dir_x: -27574,
                world_right_dir_y: 254,
                world_right_dir_z: -17699,
                g_force_lateral: 0.64368725,
                g_force_longitudinal: -3.5515678,
                g_force_vertical: 0.21098658,
                yaw: -0.57059836,
                pitch: -0.010683298,
                roll: -0.0077672657,
            },
            CarMotionData {
                world_position_x: -254.10265,
                world_position_y: -63.59966,
                world_position_z: 204.5926,
                world_velocity_x: -13.53214,
                world_velocity_y: -0.29494062,
                world_velocity_z: 53.057198,
                world_forward_dir_x: -8675,
                world_forward_dir_y: -164,
                world_forward_dir_z: 31597,
                world_right_dir_x: -31593,
                world_right_dir_y: -490,
                world_right_dir_z: -8677,
                g_force_lateral: -2.6387534,
                g_force_longitudinal: 0.9607441,
                g_force_vertical: 0.051538657,
                yaw: -0.2679945,
                pitch: -0.015757203,
                roll: 0.014958185,
            },
            CarMotionData {
                world_position_x: -252.82158,
                world_position_y: -63.54137,
                world_position_z: 152.4316,
                world_velocity_x: 12.733119,
                world_velocity_y: 0.27313435,
                world_velocity_z: 46.84353,
                world_forward_dir_x: 7804,
                world_forward_dir_y: 177,
                world_forward_dir_z: 31823,
                world_right_dir_x: -31813,
                world_right_dir_y: -810,
                world_right_dir_z: 7806,
                g_force_lateral: -2.5122273,
                g_force_longitudinal: 0.69423217,
                g_force_vertical: -0.12896065,
                yaw: 0.24058713,
                pitch: -0.025322318,
                roll: 0.02474659,
            },
            CarMotionData {
                world_position_x: -250.69095,
                world_position_y: -63.52145,
                world_position_z: 195.12375,
                world_velocity_x: -9.752202,
                world_velocity_y: -0.23084407,
                world_velocity_z: 54.875298,
                world_forward_dir_x: -6519,
                world_forward_dir_y: -133,
                world_forward_dir_z: 32111,
                world_right_dir_x: -32107,
                world_right_dir_y: -499,
                world_right_dir_z: -6521,
                g_force_lateral: -2.6971173,
                g_force_longitudinal: 0.95045435,
                g_force_vertical: -0.15780213,
                yaw: -0.2003362,
                pitch: -0.015738368,
                roll: 0.015233586,
            },
            CarMotionData {
                world_position_x: -258.31543,
                world_position_y: -63.70416,
                world_position_z: 214.0479,
                world_velocity_x: -18.440094,
                world_velocity_y: -0.42747623,
                world_velocity_z: 50.585487,
                world_forward_dir_x: -12041,
                world_forward_dir_y: -237,
                world_forward_dir_z: 30473,
                world_right_dir_x: -30469,
                world_right_dir_y: -480,
                world_right_dir_z: -12043,
                g_force_lateral: -2.6915197,
                g_force_longitudinal: 1.0432239,
                g_force_vertical: -0.0052546808,
                yaw: -0.37636158,
                pitch: -0.016305685,
                roll: 0.014663911,
            },
            CarMotionData {
                world_position_x: -249.2389,
                world_position_y: -63.490063,
                world_position_z: 183.98901,
                world_velocity_x: -4.060377,
                world_velocity_y: -0.052673817,
                world_velocity_z: 53.94985,
                world_forward_dir_x: -3363,
                world_forward_dir_y: -20,
                world_forward_dir_z: 32593,
                world_right_dir_x: -32591,
                world_right_dir_y: -406,
                world_right_dir_z: -3363,
                g_force_lateral: -2.811774,
                g_force_longitudinal: 0.9904311,
                g_force_vertical: 0.068464495,
                yaw: -0.10285062,
                pitch: -0.012398481,
                roll: 0.012399486,
            },
            CarMotionData {
                world_position_x: -256.66116,
                world_position_y: -63.645226,
                world_position_z: 216.80931,
                world_velocity_x: -18.87516,
                world_velocity_y: -0.3839452,
                world_velocity_z: 50.447353,
                world_forward_dir_x: -12223,
                world_forward_dir_y: -237,
                world_forward_dir_z: 30400,
                world_right_dir_x: -30396,
                world_right_dir_y: -483,
                world_right_dir_z: -12225,
                g_force_lateral: -2.7309253,
                g_force_longitudinal: -0.16179225,
                g_force_vertical: 0.011529787,
                yaw: -0.38234735,
                pitch: -0.01639688,
                roll: 0.014757999,
            },
            CarMotionData {
                world_position_x: -259.74652,
                world_position_y: -63.745884,
                world_position_z: 135.94911,
                world_velocity_x: 20.92846,
                world_velocity_y: 0.52754134,
                world_velocity_z: 42.016148,
                world_forward_dir_x: 14284,
                world_forward_dir_y: 386,
                world_forward_dir_z: 29486,
                world_right_dir_x: -29473,
                world_right_dir_y: -886,
                world_right_dir_z: 14289,
                g_force_lateral: -2.3170187,
                g_force_longitudinal: 1.0800164,
                g_force_vertical: 0.03561855,
                yaw: 0.45129788,
                pitch: -0.029495955,
                roll: 0.027056819,
            },
            CarMotionData {
                world_position_x: -251.47688,
                world_position_y: -63.53306,
                world_position_z: 174.72476,
                world_velocity_x: 0.82579863,
                world_velocity_y: 0.010686285,
                world_velocity_z: 51.08445,
                world_forward_dir_x: -386,
                world_forward_dir_y: 5,
                world_forward_dir_z: 32764,
                world_right_dir_x: -32761,
                world_right_dir_y: -429,
                world_right_dir_z: -386,
                g_force_lateral: -2.7232,
                g_force_longitudinal: 0.58179754,
                g_force_vertical: -0.035985436,
                yaw: -0.011785126,
                pitch: -0.0131073,
                roll: 0.013109886,
            },
            CarMotionData {
                world_position_x: -290.39957,
                world_position_y: -64.63039,
                world_position_z: 270.21426,
                world_velocity_x: -41.827614,
                world_velocity_y: -1.54154,
                world_velocity_z: 52.101936,
                world_forward_dir_x: -20619,
                world_forward_dir_y: -713,
                world_forward_dir_z: 25455,
                world_right_dir_x: -25452,
                world_right_dir_y: -470,
                world_right_dir_z: -20630,
                g_force_lateral: -0.9036087,
                g_force_longitudinal: 0.67403287,
                g_force_vertical: 0.07724632,
                yaw: -0.68087226,
                pitch: -0.024872422,
                roll: 0.014370073,
            },
            CarMotionData {
                world_position_x: -362.08615,
                world_position_y: -67.43944,
                world_position_z: 369.87872,
                world_velocity_x: -20.020971,
                world_velocity_y: -1.4471382,
                world_velocity_z: 40.86069,
                world_forward_dir_x: -14223,
                world_forward_dir_y: -1146,
                world_forward_dir_z: 29496,
                world_right_dir_x: -29516,
                world_right_dir_y: 145,
                world_right_dir_z: -14227,
                g_force_lateral: 1.9591553,
                g_force_longitudinal: -2.935053,
                g_force_vertical: -0.0569264,
                yaw: -0.44906348,
                pitch: -0.011187911,
                roll: -0.004446125,
            },
            CarMotionData {
                world_position_x: -260.72015,
                world_position_y: -63.736458,
                world_position_z: 224.29468,
                world_velocity_x: -20.886435,
                world_velocity_y: -0.41786036,
                world_velocity_z: 50.499485,
                world_forward_dir_x: -12878,
                world_forward_dir_y: -239,
                world_forward_dir_z: 30129,
                world_right_dir_x: -30124,
                world_right_dir_y: -535,
                world_right_dir_z: -12880,
                g_force_lateral: -2.6320672,
                g_force_longitudinal: 0.85540724,
                g_force_vertical: 0.008545447,
                yaw: -0.40398517,
                pitch: -0.017885089,
                roll: 0.016330905,
            },
            CarMotionData {
                world_position_x: -250.78748,
                world_position_y: -63.52066,
                world_position_z: 163.29286,
                world_velocity_x: 7.3528438,
                world_velocity_y: 0.13686875,
                world_velocity_z: 50.09558,
                world_forward_dir_x: 3915,
                world_forward_dir_y: 87,
                world_forward_dir_z: 32532,
                world_right_dir_x: -32527,
                world_right_dir_y: -559,
                world_right_dir_z: 3916,
                g_force_lateral: -2.6784039,
                g_force_longitudinal: 0.92004436,
                g_force_vertical: 0.031424787,
                yaw: 0.11979847,
                pitch: -0.017284274,
                roll: 0.017088499,
            },
            CarMotionData {
                world_position_x: -249.04572,
                world_position_y: -63.488277,
                world_position_z: 172.05106,
                world_velocity_x: 2.0496776,
                world_velocity_y: 0.028410055,
                world_velocity_z: 52.369724,
                world_forward_dir_x: 412,
                world_forward_dir_y: 11,
                world_forward_dir_z: 32764,
                world_right_dir_x: -32761,
                world_right_dir_y: -470,
                world_right_dir_z: 412,
                g_force_lateral: -2.5857508,
                g_force_longitudinal: 0.9102774,
                g_force_vertical: -0.058968943,
                yaw: 0.012593867,
                pitch: -0.01435554,
                roll: 0.01435215,
            },
            CarMotionData {
                world_position_x: -251.94476,
                world_position_y: -63.556206,
                world_position_z: 185.83305,
                world_velocity_x: -5.0337048,
                world_velocity_y: -0.05336556,
                world_velocity_z: 52.676544,
                world_forward_dir_x: -3991,
                world_forward_dir_y: -22,
                world_forward_dir_z: 32522,
                world_right_dir_x: -32520,
                world_right_dir_y: -422,
                world_right_dir_z: -3991,
                g_force_lateral: -2.7215152,
                g_force_longitudinal: 0.9517513,
                g_force_vertical: 0.0050670994,
                yaw: -0.12213913,
                pitch: -0.012889743,
                roll: 0.01290321,
            },
            CarMotionData {
                world_position_x: -253.42844,
                world_position_y: -63.597466,
                world_position_z: 195.89497,
                world_velocity_x: -9.921182,
                world_velocity_y: -0.2972413,
                world_velocity_z: 52.574276,
                world_forward_dir_x: -6752,
                world_forward_dir_y: -162,
                world_forward_dir_z: 32063,
                world_right_dir_x: -32059,
                world_right_dir_y: -513,
                world_right_dir_z: -6754,
                g_force_lateral: -2.6127546,
                g_force_longitudinal: 1.0015159,
                g_force_vertical: -0.07127774,
                yaw: -0.20760305,
                pitch: -0.016366243,
                roll: 0.015683101,
            },
            CarMotionData {
                world_position_x: -272.36404,
                world_position_y: -64.045296,
                world_position_z: 238.6034,
                world_velocity_x: -32.233833,
                world_velocity_y: -0.852242,
                world_velocity_z: 51.602463,
                world_forward_dir_x: -17781,
                world_forward_dir_y: -443,
                world_forward_dir_z: 27519,
                world_right_dir_x: -27511,
                world_right_dir_y: -653,
                world_right_dir_z: -17787,
                g_force_lateral: -1.7174335,
                g_force_longitudinal: -0.7033538,
                g_force_vertical: -0.016597355,
                yaw: -0.57379603,
                pitch: -0.024112225,
                roll: 0.019960029,
            },
        ],
        player_car_data: Some(PlayerCarData {
            suspension_position: WheelData::new(16.994642, 8.856616, 10.02546, 3.0912032),
            suspension_velocity: WheelData::new(-28.865864, -41.108833, 52.830387, 40.053856),
            suspension_acceleration: WheelData::new(-1971.4028, -3529.0164, 3126.438, 1537.9934),
            wheel_speed: WheelData::new(60.908794, 60.61277, 61.004387, 60.70317),
            wheel_slip: WheelData::new(-0.0012081127, -0.001504248, 0.00019198011, 0.0001581817),
            local_velocity_x: 0.9310018,
            local_velocity_y: -0.047296584,
            local_velocity_z: 60.84153,
            angular_velocity_x: 0.03775555,
            angular_velocity_y: -0.17944355,
            angular_velocity_z: 0.044059165,
            angular_acceleration_x: 1.5070117,
            angular_acceleration_y: 3.947086,
            angular_acceleration_z: 3.0085795,
            front_wheels_angle: -0.0,
        }),
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2019_session_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e30701160101fcc796d4ce430d49000a3042690300001301211a052a120a0400fb1b201c500000ff00126a46783f0076db943d019c7f1b3e02d0f75d3e039aa3763e04fb8aa83e00dc2ec13e0050dcd83e00bddf043f00074e0f3f00591b1b3f008fb6243f0010a6383f00e3f0473f000bea4d3f00ef595a3f001301623f00f39e683f000000000000000000000000000000000000").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::Session(s) => s,
        _ => panic!("Invalid packet. Expected Session, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2019);

    let expected = PacketSessionData {
        header: actual.header.clone(),
        weather: Weather::LightCloud,
        track_temperature: 33,
        air_temperature: 26,
        total_laps: 5,
        track_length: 4650,
        session_type: SessionType::Race,
        track: Track::Catalunya,
        formula: Formula::F1Modern,
        session_time_left: 7163,
        session_duration: 7200,
        pit_speed_limit: 80,
        game_paused: false,
        is_spectating: false,
        spectator_car_index: 255,
        sli_pro_native_support: false,
        num_marshal_zones: 18,
        marshal_zones: vec![
            MarshalZone {
                zone_start: 0.96982443,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.07268421,
                zone_flag: Flag::Green,
            },
            MarshalZone {
                zone_start: 0.15185398,
                zone_flag: Flag::Blue,
            },
            MarshalZone {
                zone_start: 0.21676564,
                zone_flag: Flag::Yellow,
            },
            MarshalZone {
                zone_start: 0.24085847,
                zone_flag: Flag::Red,
            },
            MarshalZone {
                zone_start: 0.32918534,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.37731063,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.42355585,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.519039,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.55978435,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.60588604,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.6434106,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.7212839,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.7810194,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.80435246,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.8529348,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.8828289,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.9086754,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.0,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.0,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.0,
                zone_flag: Flag::None,
            },
        ],
        safety_car_status: SafetyCar::None,
        network_game: false,
        weather_forecast: None,
        ai_difficulty: None,
        season_identifier: None,
        weekend_identifier: None,
        session_identifier: None,
        pit_stop_window_ideal_lap: None,
        pit_stop_window_latest_lap: None,
        pit_stop_rejoin_position: None,
        driving_assists: None,
        game_mode: None,
        rule_set: None,
        time_of_day: None,
        session_length: None,
        speed_units_lead_player: None,
        temperature_units_lead_player: None,
        speed_units_secondary_player: None,
        temperature_units_secondary_player: None,
        num_safety_car_periods: None,
        num_virtual_safety_car_periods: None,
        num_red_flag_periods: None,
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2019_lap_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e30701160102fcc796d4ce430d49000a30426903000013000000007e5e11420000000034a6c84100000000db460845db4608450000008001010001000000040200000000625f1142000000006605ee41000000003f41f6443f41f6440000008004010001000003040200000000f15e114200000000764cfc4100000000724ee344724ee3440000008013010001000012040200000000ff671142000000001018e241000000008a7800458a7800450000008003010001000006040200000000dc5f1142000000007e07f4410000000084dcea4484dcea44000000800a010001000008040200000000f36511420000000082e1fa41000000003c72e4443c72e4440000008012010001000011040200000000c968114200000000283bf54100000000a4a7e944a4a7e944000000800c01000100000a040200000000195a11420000000085eaf04100000000831fec44831fec4400000080090100010000010402000000002e571142000000002aacf64100000000484de844484de844000000800e01000100000c04020000000099601142000000009d2af04100000000385dec44385dec440000008008010001000007040200000000e062114200000000e2effd41000000008f3fe2448f3fe24400000080140100010000130402000000004060114200000000e01af841000000000530e7440530e744000000800f01000100000e040200000000bf68114200000000cd08ef4100000000df2bf444df2bf44400000080050100010000050402000000008a601142000000008cf6e0410000000012c0014512c0014500000080020100010000040402000000000d67114200000000014af141000000000e63ed440e63ed44000000800701000100000b0402000000003568114200000000586af941000000008bcbe5448bcbe544000000801101000100000f040200000000ab60114200000000ef13f9410000000050dde64450dde6440000008010010001000010040200000000955f1142000000001076f64100000000178fe844178fe844000000800d01000100000d0402000000001666114200000000c135f5410000000044cfe94444cfe944000000800b0100010000090402000000006469114200000000bd80f241000000007da1ef447da1ef4400000080060100010000020402").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::LapData(s) => s,
        _ => panic!("Invalid packet. Expected Lap, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2019);

    let expected = PacketLapData {
        header: actual.header.clone(),
        lap_data: vec![
            LapData {
                last_lap_time: 0,
                current_lap_time: 36342,
                sector_1_time: 25081,
                sector_2_time: 0,
                best_lap_time: 0,
                lap_distance: 2180.4285,
                total_distance: 2180.4285,
                safety_car_delta: -0.0,
                car_position: 1,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                sector: Sector::Sector2,
                current_lap_invalid: false,
                penalties: 0,
                grid_position: 0,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 36343,
                sector_1_time: 29752,
                sector_2_time: 0,
                best_lap_time: 0,
                lap_distance: 1970.039,
                total_distance: 1970.039,
                safety_car_delta: -0.0,
                car_position: 4,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                sector: Sector::Sector2,
                current_lap_invalid: false,
                penalties: 0,
                grid_position: 3,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 36342,
                sector_1_time: 31537,
                sector_2_time: 0,
                best_lap_time: 0,
                lap_distance: 1818.4514,
                total_distance: 1818.4514,
                safety_car_delta: -0.0,
                car_position: 19,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                sector: Sector::Sector2,
                current_lap_invalid: false,
                penalties: 0,
                grid_position: 18,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 36351,
                sector_1_time: 28261,
                sector_2_time: 0,
                best_lap_time: 0,
                lap_distance: 2055.5337,
                total_distance: 2055.5337,
                safety_car_delta: -0.0,
                car_position: 3,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                sector: Sector::Sector2,
                current_lap_invalid: false,
                penalties: 0,
                grid_position: 6,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 36343,
                sector_1_time: 30503,
                sector_2_time: 0,
                best_lap_time: 0,
                lap_distance: 1878.8911,
                total_distance: 1878.8911,
                safety_car_delta: -0.0,
                car_position: 10,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                sector: Sector::Sector2,
                current_lap_invalid: false,
                penalties: 0,
                grid_position: 8,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 36349,
                sector_1_time: 31360,
                sector_2_time: 0,
                best_lap_time: 0,
                lap_distance: 1827.5698,
                total_distance: 1827.5698,
                safety_car_delta: -0.0,
                car_position: 18,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                sector: Sector::Sector2,
                current_lap_invalid: false,
                penalties: 0,
                grid_position: 17,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 36352,
                sector_1_time: 30653,
                sector_2_time: 0,
                best_lap_time: 0,
                lap_distance: 1869.2388,
                total_distance: 1869.2388,
                safety_car_delta: -0.0,
                car_position: 12,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                sector: Sector::Sector2,
                current_lap_invalid: false,
                penalties: 0,
                grid_position: 10,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 36337,
                sector_1_time: 30114,
                sector_2_time: 0,
                best_lap_time: 0,
                lap_distance: 1888.9847,
                total_distance: 1888.9847,
                safety_car_delta: -0.0,
                car_position: 9,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                sector: Sector::Sector2,
                current_lap_invalid: false,
                penalties: 0,
                grid_position: 1,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 36335,
                sector_1_time: 30834,
                sector_2_time: 0,
                best_lap_time: 0,
                lap_distance: 1858.415,
                total_distance: 1858.415,
                safety_car_delta: -0.0,
                car_position: 14,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                sector: Sector::Sector2,
                current_lap_invalid: false,
                penalties: 0,
                grid_position: 12,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 36344,
                sector_1_time: 30020,
                sector_2_time: 0,
                best_lap_time: 0,
                lap_distance: 1890.9131,
                total_distance: 1890.9131,
                safety_car_delta: -0.0,
                car_position: 8,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                sector: Sector::Sector2,
                current_lap_invalid: false,
                penalties: 0,
                grid_position: 7,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 36346,
                sector_1_time: 31742,
                sector_2_time: 0,
                best_lap_time: 0,
                lap_distance: 1809.9862,
                total_distance: 1809.9862,
                safety_car_delta: -0.0,
                car_position: 20,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                sector: Sector::Sector2,
                current_lap_invalid: false,
                penalties: 0,
                grid_position: 19,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 36343,
                sector_1_time: 31013,
                sector_2_time: 0,
                best_lap_time: 0,
                lap_distance: 1849.5006,
                total_distance: 1849.5006,
                safety_car_delta: -0.0,
                car_position: 15,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                sector: Sector::Sector2,
                current_lap_invalid: false,
                penalties: 0,
                grid_position: 14,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 36352,
                sector_1_time: 29879,
                sector_2_time: 0,
                best_lap_time: 0,
                lap_distance: 1953.371,
                total_distance: 1953.371,
                safety_car_delta: -0.0,
                car_position: 5,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                sector: Sector::Sector2,
                current_lap_invalid: false,
                penalties: 0,
                grid_position: 5,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 36344,
                sector_1_time: 28120,
                sector_2_time: 0,
                best_lap_time: 0,
                lap_distance: 2076.0044,
                total_distance: 2076.0044,
                safety_car_delta: -0.0,
                car_position: 2,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                sector: Sector::Sector2,
                current_lap_invalid: false,
                penalties: 0,
                grid_position: 4,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 36350,
                sector_1_time: 30161,
                sector_2_time: 0,
                best_lap_time: 0,
                lap_distance: 1899.0955,
                total_distance: 1899.0955,
                safety_car_delta: -0.0,
                car_position: 7,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                sector: Sector::Sector2,
                current_lap_invalid: false,
                penalties: 0,
                grid_position: 11,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 36351,
                sector_1_time: 31176,
                sector_2_time: 0,
                best_lap_time: 0,
                lap_distance: 1838.3607,
                total_distance: 1838.3607,
                safety_car_delta: -0.0,
                car_position: 17,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                sector: Sector::Sector2,
                current_lap_invalid: false,
                penalties: 0,
                grid_position: 15,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 36344,
                sector_1_time: 31134,
                sector_2_time: 0,
                best_lap_time: 0,
                lap_distance: 1846.916,
                total_distance: 1846.916,
                safety_car_delta: -0.0,
                car_position: 16,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                sector: Sector::Sector2,
                current_lap_invalid: false,
                penalties: 0,
                grid_position: 16,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 36343,
                sector_1_time: 30807,
                sector_2_time: 0,
                best_lap_time: 0,
                lap_distance: 1860.4716,
                total_distance: 1860.4716,
                safety_car_delta: -0.0,
                car_position: 13,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                sector: Sector::Sector2,
                current_lap_invalid: false,
                penalties: 0,
                grid_position: 13,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 36349,
                sector_1_time: 30651,
                sector_2_time: 0,
                best_lap_time: 0,
                lap_distance: 1870.477,
                total_distance: 1870.477,
                safety_car_delta: -0.0,
                car_position: 11,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                sector: Sector::Sector2,
                current_lap_invalid: false,
                penalties: 0,
                grid_position: 9,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 36352,
                sector_1_time: 30312,
                sector_2_time: 0,
                best_lap_time: 0,
                lap_distance: 1917.0465,
                total_distance: 1917.0465,
                safety_car_delta: -0.0,
                car_position: 6,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                sector: Sector::Sector2,
                current_lap_invalid: false,
                penalties: 0,
                grid_position: 2,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                ..Default::default()
            },
        ],
        time_trial_personal_best_car_idx: None,
        time_trial_rival_car_idx: None,
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2019_event_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(
        &stream,
        "e30701160103fcc796d4ce430d49801cb542f20600001346544c50007bd4a542",
    )
    .await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::Event(s) => s,
        _ => panic!("Invalid packet. Expected Event, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2019);

    let expected = PacketEventData {
        header: actual.header.clone(),
        event: Event::FastestLap(FastestLap {
            vehicle_idx: 0,
            lap_time: 82915,
        }),
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2019_participants_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e30701160104fcc796d4ce430d49000a3042690300001314010f004d1b562e20424f545441530000000000000000000000000000000000000000000000000000000000000000000000000000000101090221164d2e205645525354415050454e000000000000000000000000000000000000000000000000000000000000000000000001010609071b4b2e2052c384494b4bc3964e454e0000000000000000000000000000000000000000000000000000000000000000000001010a051b1d4e2e2048c39c4c4b454e4245524700000000000000000000000000000000000000000000000000000000000000000000010102050303442e2052494343494152444f00000000000000000000000000000000000000000000000000000000000000000000000001014b035840522e204b554249434100000000000000000000000000000000000000000000000000000000000000000000000000000001010008374e432e205341494e5a0000000000000000000000000000000000000000000000000000000000000000000000000000000001013a011035432e204c45434c455243000000000000000000000000000000000000000000000000000000000000000000000000000001010b0714154b2e204d41474e555353454e00000000000000000000000000000000000000000000000000000000000000000000000001010e040b34532e20504552455a00000000000000000000000000000000000000000000000000000000000000000000000000000000010101061a44442e204b5659415400000000000000000000000000000000000000000000000000000000000000000000000000000000010132033f0a472e2052555353454c4c000000000000000000000000000000000000000000000000000000000000000000000000000001013e021751412e20414c424f4e0000000000000000000000000000000000000000000000000000000000000000000000000000000001010d01051d532e2056455454454c00000000000000000000000000000000000000000000000000000000000000000000000000000001011304120d4c2e205354524f4c4c00000000000000000000000000000000000000000000000000000000000000000000000000000001014a096329412e2047494f56494e415a5a49000000000000000000000000000000000000000000000000000000000000000000000001013b060a1c502e204741534c590000000000000000000000000000000000000000000000000000000000000000000000000000000001010c07081c522e2047524f534a45414e0000000000000000000000000000000000000000000000000000000000000000000000000001013608040a4c2e204e4f52524953000000000000000000000000000000000000000000000000000000000000000000000000000000010007002c0a4c2e2048414d494c544f4e0000000000000000000000000000000000000000000000000000000000000000000000000000").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::Participants(s) => s,
        _ => panic!("Invalid packet. Expected Participants, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2019);

    let expected = PacketParticipantsData {
        header: actual.header.clone(),
        num_active_cars: 20,
        participants: vec![
            ParticipantData {
                ai_controlled: true,
                driver: Driver::ValtteriBottas,
                team: Team::Mercedes,
                race_number: 77,
                nationality: Nationality::Finnish,
                name: "V. BOTTAS".to_string(),
                telemetry_access: Telemetry::Public,
                ..Default::default()
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::MaxVerstappen,
                team: Team::RedBullRacing,
                race_number: 33,
                nationality: Nationality::Dutch,
                name: "M. VERSTAPPEN".to_string(),
                telemetry_access: Telemetry::Public,
                ..Default::default()
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::KimiRaikkonen,
                team: Team::AlfaRomeo,
                race_number: 7,
                nationality: Nationality::Finnish,
                name: "K. RÄIKKÖNEN".to_string(),
                telemetry_access: Telemetry::Public,
                ..Default::default()
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::NicoHulkenburg,
                team: Team::Renault,
                race_number: 27,
                nationality: Nationality::German,
                name: "N. HÜLKENBERG".to_string(),
                telemetry_access: Telemetry::Public,
                ..Default::default()
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::DanielRicciardo,
                team: Team::Renault,
                race_number: 3,
                nationality: Nationality::Australian,
                name: "D. RICCIARDO".to_string(),
                telemetry_access: Telemetry::Public,
                ..Default::default()
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::RobertKubica,
                team: Team::Williams,
                race_number: 88,
                nationality: Nationality::Polish,
                name: "R. KUBICA".to_string(),
                telemetry_access: Telemetry::Public,
                ..Default::default()
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::CarlosSainz,
                team: Team::McLaren,
                race_number: 55,
                nationality: Nationality::Spanish,
                name: "C. SAINZ".to_string(),
                telemetry_access: Telemetry::Public,
                ..Default::default()
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::CharlesLeclerc,
                team: Team::Ferrari,
                race_number: 16,
                nationality: Nationality::Monegasque,
                name: "C. LECLERC".to_string(),
                telemetry_access: Telemetry::Public,
                ..Default::default()
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::KevinMagnussen,
                team: Team::Haas,
                race_number: 20,
                nationality: Nationality::Danish,
                name: "K. MAGNUSSEN".to_string(),
                telemetry_access: Telemetry::Public,
                ..Default::default()
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::SergioPerez,
                team: Team::RacingPoint,
                race_number: 11,
                nationality: Nationality::Mexican,
                name: "S. PEREZ".to_string(),
                telemetry_access: Telemetry::Public,
                ..Default::default()
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::DaniilKvyat,
                team: Team::ToroRosso,
                race_number: 26,
                nationality: Nationality::Russian,
                name: "D. KVYAT".to_string(),
                telemetry_access: Telemetry::Public,
                ..Default::default()
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::GeorgeRussell,
                team: Team::Williams,
                race_number: 63,
                nationality: Nationality::British,
                name: "G. RUSSELL".to_string(),
                telemetry_access: Telemetry::Public,
                ..Default::default()
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::AlexanderAlbon,
                team: Team::RedBullRacing,
                race_number: 23,
                nationality: Nationality::Thai,
                name: "A. ALBON".to_string(),
                telemetry_access: Telemetry::Public,
                ..Default::default()
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::SebastianVettel,
                team: Team::Ferrari,
                race_number: 5,
                nationality: Nationality::German,
                name: "S. VETTEL".to_string(),
                telemetry_access: Telemetry::Public,
                ..Default::default()
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::LanceStroll,
                team: Team::RacingPoint,
                race_number: 18,
                nationality: Nationality::Canadian,
                name: "L. STROLL".to_string(),
                telemetry_access: Telemetry::Public,
                ..Default::default()
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::AntonioGiovinazzi,
                team: Team::AlfaRomeo,
                race_number: 99,
                nationality: Nationality::Italian,
                name: "A. GIOVINAZZI".to_string(),
                telemetry_access: Telemetry::Public,
                ..Default::default()
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::PierreGasly,
                team: Team::ToroRosso,
                race_number: 10,
                nationality: Nationality::French,
                name: "P. GASLY".to_string(),
                telemetry_access: Telemetry::Public,
                ..Default::default()
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::RomainGrosjean,
                team: Team::Haas,
                race_number: 8,
                nationality: Nationality::French,
                name: "R. GROSJEAN".to_string(),
                telemetry_access: Telemetry::Public,
                ..Default::default()
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::LandoNorris,
                team: Team::McLaren,
                race_number: 4,
                nationality: Nationality::British,
                name: "L. NORRIS".to_string(),
                telemetry_access: Telemetry::Public,
                ..Default::default()
            },
            ParticipantData {
                ai_controlled: false,
                driver: Driver::LewisHamilton,
                team: Team::Mercedes,
                race_number: 44,
                nationality: Nationality::British,
                name: "L. HAMILTON".to_string(),
                telemetry_access: Telemetry::Restricted,
                ..Default::default()
            },
        ],
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2019_car_setups_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e30701160105fcc796d4ce430d49000a3042690300001306064b4b000040c00000c0bfcecccc3d3433b33e0606060606064b3c0000b8410000ac41060000204106064b4b000040c00000c0bfcecccc3d3433b33e0606060606064b3c0000b8410000ac41060000204106064b4b000040c00000c0bfcecccc3d3433b33e0606060606064b3c0000b8410000ac41060000204106064b4b000040c00000c0bfcecccc3d3433b33e0606060606064b3c0000b8410000ac41060000204106064b4b000040c00000c0bfcecccc3d3433b33e0606060606064b3c0000b8410000ac41060000204106064b4b000040c00000c0bfcecccc3d3433b33e0606060606064b3c0000b8410000ac41060000204106064b4b000040c00000c0bfcecccc3d3433b33e0606060606064b3c0000b8410000ac41060000204106064b4b000040c00000c0bfcecccc3d3433b33e0606060606064b3c0000b8410000ac41060000204106064b4b000040c00000c0bfcecccc3d3433b33e0606060606064b3c0000b8410000ac41060000204106064b4b000040c00000c0bfcecccc3d3433b33e0606060606064b3c0000b8410000ac41060000204106064b4b000040c00000c0bfcecccc3d3433b33e0606060606064b3c0000b8410000ac41060000204106064b4b000040c00000c0bfcecccc3d3433b33e0606060606064b3c0000b8410000ac41060000204106064b4b000040c00000c0bfcecccc3d3433b33e0606060606064b3c0000b8410000ac41060000204106064b4b000040c00000c0bfcecccc3d3433b33e0606060606064b3c0000b8410000ac41060000204106064b4b000040c00000c0bfcecccc3d3433b33e0606060606064b3c0000b8410000ac41060000204106064b4b000040c00000c0bfcecccc3d3433b33e0606060606064b3c0000b8410000ac41060000204106064b4b000040c00000c0bfcecccc3d3433b33e0606060606064b3c0000b8410000ac41060000204106064b4b000040c00000c0bfcecccc3d3433b33e0606060606064b3c0000b8410000ac41060000204106064b4b000040c00000c0bfcecccc3d3433b33e0606060606064b3c0000b8410000ac41060000204106064b4b000040c00000c0bfcecccc3d3433b33e0606060606064b3c0000b8410000ac410600002041").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::CarSetups(s) => s,
        _ => panic!("Invalid packet. Expected CarSetups, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2019);

    let expected = PacketCarSetupData {
        header: actual.header.clone(),
        car_setups: vec![
            CarSetupData {
                front_wing: 6,
                rear_wing: 6,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.35000002,
                front_suspension: 6,
                rear_suspension: 6,
                front_anti_roll_bar: 6,
                rear_anti_roll_bar: 6,
                front_suspension_height: 6,
                rear_suspension_height: 6,
                brake_pressure: 75,
                brake_bias: 60,
                tyres_pressure: WheelData::new(21.5, 21.5, 23.0, 23.0),
                ballast: 6,
                fuel_load: 10.0,
            },
            CarSetupData {
                front_wing: 6,
                rear_wing: 6,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.35000002,
                front_suspension: 6,
                rear_suspension: 6,
                front_anti_roll_bar: 6,
                rear_anti_roll_bar: 6,
                front_suspension_height: 6,
                rear_suspension_height: 6,
                brake_pressure: 75,
                brake_bias: 60,
                tyres_pressure: WheelData::new(21.5, 21.5, 23.0, 23.0),
                ballast: 6,
                fuel_load: 10.0,
            },
            CarSetupData {
                front_wing: 6,
                rear_wing: 6,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.35000002,
                front_suspension: 6,
                rear_suspension: 6,
                front_anti_roll_bar: 6,
                rear_anti_roll_bar: 6,
                front_suspension_height: 6,
                rear_suspension_height: 6,
                brake_pressure: 75,
                brake_bias: 60,
                tyres_pressure: WheelData::new(21.5, 21.5, 23.0, 23.0),
                ballast: 6,
                fuel_load: 10.0,
            },
            CarSetupData {
                front_wing: 6,
                rear_wing: 6,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.35000002,
                front_suspension: 6,
                rear_suspension: 6,
                front_anti_roll_bar: 6,
                rear_anti_roll_bar: 6,
                front_suspension_height: 6,
                rear_suspension_height: 6,
                brake_pressure: 75,
                brake_bias: 60,
                tyres_pressure: WheelData::new(21.5, 21.5, 23.0, 23.0),
                ballast: 6,
                fuel_load: 10.0,
            },
            CarSetupData {
                front_wing: 6,
                rear_wing: 6,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.35000002,
                front_suspension: 6,
                rear_suspension: 6,
                front_anti_roll_bar: 6,
                rear_anti_roll_bar: 6,
                front_suspension_height: 6,
                rear_suspension_height: 6,
                brake_pressure: 75,
                brake_bias: 60,
                tyres_pressure: WheelData::new(21.5, 21.5, 23.0, 23.0),
                ballast: 6,
                fuel_load: 10.0,
            },
            CarSetupData {
                front_wing: 6,
                rear_wing: 6,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.35000002,
                front_suspension: 6,
                rear_suspension: 6,
                front_anti_roll_bar: 6,
                rear_anti_roll_bar: 6,
                front_suspension_height: 6,
                rear_suspension_height: 6,
                brake_pressure: 75,
                brake_bias: 60,
                tyres_pressure: WheelData::new(21.5, 21.5, 23.0, 23.0),
                ballast: 6,
                fuel_load: 10.0,
            },
            CarSetupData {
                front_wing: 6,
                rear_wing: 6,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.35000002,
                front_suspension: 6,
                rear_suspension: 6,
                front_anti_roll_bar: 6,
                rear_anti_roll_bar: 6,
                front_suspension_height: 6,
                rear_suspension_height: 6,
                brake_pressure: 75,
                brake_bias: 60,
                tyres_pressure: WheelData::new(21.5, 21.5, 23.0, 23.0),
                ballast: 6,
                fuel_load: 10.0,
            },
            CarSetupData {
                front_wing: 6,
                rear_wing: 6,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.35000002,
                front_suspension: 6,
                rear_suspension: 6,
                front_anti_roll_bar: 6,
                rear_anti_roll_bar: 6,
                front_suspension_height: 6,
                rear_suspension_height: 6,
                brake_pressure: 75,
                brake_bias: 60,
                tyres_pressure: WheelData::new(21.5, 21.5, 23.0, 23.0),
                ballast: 6,
                fuel_load: 10.0,
            },
            CarSetupData {
                front_wing: 6,
                rear_wing: 6,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.35000002,
                front_suspension: 6,
                rear_suspension: 6,
                front_anti_roll_bar: 6,
                rear_anti_roll_bar: 6,
                front_suspension_height: 6,
                rear_suspension_height: 6,
                brake_pressure: 75,
                brake_bias: 60,
                tyres_pressure: WheelData::new(21.5, 21.5, 23.0, 23.0),
                ballast: 6,
                fuel_load: 10.0,
            },
            CarSetupData {
                front_wing: 6,
                rear_wing: 6,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.35000002,
                front_suspension: 6,
                rear_suspension: 6,
                front_anti_roll_bar: 6,
                rear_anti_roll_bar: 6,
                front_suspension_height: 6,
                rear_suspension_height: 6,
                brake_pressure: 75,
                brake_bias: 60,
                tyres_pressure: WheelData::new(21.5, 21.5, 23.0, 23.0),
                ballast: 6,
                fuel_load: 10.0,
            },
            CarSetupData {
                front_wing: 6,
                rear_wing: 6,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.35000002,
                front_suspension: 6,
                rear_suspension: 6,
                front_anti_roll_bar: 6,
                rear_anti_roll_bar: 6,
                front_suspension_height: 6,
                rear_suspension_height: 6,
                brake_pressure: 75,
                brake_bias: 60,
                tyres_pressure: WheelData::new(21.5, 21.5, 23.0, 23.0),
                ballast: 6,
                fuel_load: 10.0,
            },
            CarSetupData {
                front_wing: 6,
                rear_wing: 6,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.35000002,
                front_suspension: 6,
                rear_suspension: 6,
                front_anti_roll_bar: 6,
                rear_anti_roll_bar: 6,
                front_suspension_height: 6,
                rear_suspension_height: 6,
                brake_pressure: 75,
                brake_bias: 60,
                tyres_pressure: WheelData::new(21.5, 21.5, 23.0, 23.0),
                ballast: 6,
                fuel_load: 10.0,
            },
            CarSetupData {
                front_wing: 6,
                rear_wing: 6,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.35000002,
                front_suspension: 6,
                rear_suspension: 6,
                front_anti_roll_bar: 6,
                rear_anti_roll_bar: 6,
                front_suspension_height: 6,
                rear_suspension_height: 6,
                brake_pressure: 75,
                brake_bias: 60,
                tyres_pressure: WheelData::new(21.5, 21.5, 23.0, 23.0),
                ballast: 6,
                fuel_load: 10.0,
            },
            CarSetupData {
                front_wing: 6,
                rear_wing: 6,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.35000002,
                front_suspension: 6,
                rear_suspension: 6,
                front_anti_roll_bar: 6,
                rear_anti_roll_bar: 6,
                front_suspension_height: 6,
                rear_suspension_height: 6,
                brake_pressure: 75,
                brake_bias: 60,
                tyres_pressure: WheelData::new(21.5, 21.5, 23.0, 23.0),
                ballast: 6,
                fuel_load: 10.0,
            },
            CarSetupData {
                front_wing: 6,
                rear_wing: 6,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.35000002,
                front_suspension: 6,
                rear_suspension: 6,
                front_anti_roll_bar: 6,
                rear_anti_roll_bar: 6,
                front_suspension_height: 6,
                rear_suspension_height: 6,
                brake_pressure: 75,
                brake_bias: 60,
                tyres_pressure: WheelData::new(21.5, 21.5, 23.0, 23.0),
                ballast: 6,
                fuel_load: 10.0,
            },
            CarSetupData {
                front_wing: 6,
                rear_wing: 6,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.35000002,
                front_suspension: 6,
                rear_suspension: 6,
                front_anti_roll_bar: 6,
                rear_anti_roll_bar: 6,
                front_suspension_height: 6,
                rear_suspension_height: 6,
                brake_pressure: 75,
                brake_bias: 60,
                tyres_pressure: WheelData::new(21.5, 21.5, 23.0, 23.0),
                ballast: 6,
                fuel_load: 10.0,
            },
            CarSetupData {
                front_wing: 6,
                rear_wing: 6,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.35000002,
                front_suspension: 6,
                rear_suspension: 6,
                front_anti_roll_bar: 6,
                rear_anti_roll_bar: 6,
                front_suspension_height: 6,
                rear_suspension_height: 6,
                brake_pressure: 75,
                brake_bias: 60,
                tyres_pressure: WheelData::new(21.5, 21.5, 23.0, 23.0),
                ballast: 6,
                fuel_load: 10.0,
            },
            CarSetupData {
                front_wing: 6,
                rear_wing: 6,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.35000002,
                front_suspension: 6,
                rear_suspension: 6,
                front_anti_roll_bar: 6,
                rear_anti_roll_bar: 6,
                front_suspension_height: 6,
                rear_suspension_height: 6,
                brake_pressure: 75,
                brake_bias: 60,
                tyres_pressure: WheelData::new(21.5, 21.5, 23.0, 23.0),
                ballast: 6,
                fuel_load: 10.0,
            },
            CarSetupData {
                front_wing: 6,
                rear_wing: 6,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.35000002,
                front_suspension: 6,
                rear_suspension: 6,
                front_anti_roll_bar: 6,
                rear_anti_roll_bar: 6,
                front_suspension_height: 6,
                rear_suspension_height: 6,
                brake_pressure: 75,
                brake_bias: 60,
                tyres_pressure: WheelData::new(21.5, 21.5, 23.0, 23.0),
                ballast: 6,
                fuel_load: 10.0,
            },
            CarSetupData {
                front_wing: 6,
                rear_wing: 6,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.35000002,
                front_suspension: 6,
                rear_suspension: 6,
                front_anti_roll_bar: 6,
                rear_anti_roll_bar: 6,
                front_suspension_height: 6,
                rear_suspension_height: 6,
                brake_pressure: 75,
                brake_bias: 60,
                tyres_pressure: WheelData::new(21.5, 21.5, 23.0, 23.0),
                ballast: 6,
                fuel_load: 10.0,
            },
        ],
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2019_car_telemetry_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e30701160106fcc796d4ce430d49000a304269030000138400c2b0163f354129be000000000003b6280000470349038e0391035f005f0061006a0062005d0060005b005a000000ac410000ac410000b8410000b84100000000f2000000803fac9802bc000000000006f82a000850024d026d02690269005c006b0056005f005b005d0058005a000000ac410000ac410000b8410000b84100000000ab000000803f9398413e000000000004862a0000b702b602ed02ec02610056006c0053005b005900590055005a000000ac410000ac410000b8410000b84100000000c50000000000db9bfebc0000803f0005b1280000160316037103720362005900660055005f005b005e0057005a000000ac410000ac410000b8410000b84100000000c5000000803fd4041c3e000000000005a7290000d702d3020b03080364005900670052005d0059005b0057005a000000ac410000ac410000b8410000b84100000000ae00a7cc493fd9d66a3e0000000000044a2b000bb302b102e802e70261005600670050005b0058005a0055005a000000ac410000ac410000b8410000b84100000000c8000000803f25bf2a3e000000000005182b000bd102ce020303010367005a006a0053005b0059005b0057005a000000ac410000ac410000b8410000b84100000000c100e5667c3f341dd03d00000000000535290000d202cf020203000365005800720058005d0059005e0058005a000000ac410000ac410000b8410000b84100000000c20076f77d3fbb77183e00000000000567290000b802b502e902e702660059006a0052005c0059005b0057005a000000ac410000ac410000b8410000b84100000000c1000000803ff594ea3d000000000004262e005dbc02b902f302f002640058006d0054005d005a005d0057005a000000ac410000ac410000b8410000b84100000000a80083f6713f0f61583e000000000004d0290000be02bd02f502f50260005500670052005b0059005a0056005a000000ac410000ac410000b8410000b84100000000b7003006433fc75c4a3e0000000000043b2d0042ae02ad02e002de0265005800690051005d0059005b0057005a000000ac410000ac410000b8410000b84100000000f0000000803f6fc49c3c000000000006ac2a0000590256027802750269005c006c0055005e005a005c0057005a000000ac410000ac410000b8410000b84100000000a30000000000ca2f4dbe0000803f0004692600005e036003be03c10362005b0068005a0060005c005e0058005a000000ac410000ac410000b8410000b84100000000c4004a670e3f26cb8f3e0000000000051a280000ba02b702e902e60267005900700055005e005a005c0057005a000000ac410000ac410000b8410000b84100000000b600e30e7f3f2de63a3e000000000004612d002fb002af02e402e30263005700680051005c0059005a0057005a000000ac410000ac410000b8410000b84100000000bc0077c6a23eb2d3363e0000000000052b2800009e029c02d002cf02650057006a0052005c0059005a0056005a000000ac410000ac410000b8410000b84100000000be003e9b6a3f70a1183e00000000000574280000cb02c802ff02fc0265005900690052005c0059005b0057005a000000ac410000ac410000b8410000b84100000000c000a0527f3f0e9b263e00000000000557290000d702d3020d030a0364005900680053005c0059005b0057005a000000ac410000ac410000b8410000b84100000000db000000000000000000000000000005002c001eb802b602d502d302700061007200560061005d005f0059006a000000ac410000ac410000b8410000b8410000000000000000").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::CarTelemetry(s) => s,
        _ => panic!("Invalid packet. Expected CarTelemetry, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2019);

    let expected = PacketCarTelemetryData {
        header: actual.header.clone(),
        car_telemetry_data: vec![
            CarTelemetryData {
                speed: 132,
                throttle: 0.5886346,
                steer: -0.16528781,
                brake: 0.0,
                clutch: 0,
                gear: 3,
                engine_rpm: 10422,
                drs: false,
                rev_lights_percent: 0,
                brakes_temperature: WheelData::new(839, 841, 910, 913),
                tyres_surface_temperature: WheelData::new(95, 95, 97, 106),
                tyres_inner_temperature: WheelData::new(98, 93, 96, 91),
                engine_temperature: 90,
                tyre_pressures: WheelData::new(21.5, 21.5, 23.0, 23.0),
                surface_types: WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
                ..Default::default()
            },
            CarTelemetryData {
                speed: 242,
                throttle: 1.0,
                steer: -0.00797097,
                brake: 0.0,
                clutch: 0,
                gear: 6,
                engine_rpm: 11000,
                drs: false,
                rev_lights_percent: 8,
                brakes_temperature: WheelData::new(592, 589, 621, 617),
                tyres_surface_temperature: WheelData::new(105, 92, 107, 86),
                tyres_inner_temperature: WheelData::new(95, 91, 93, 88),
                engine_temperature: 90,
                tyre_pressures: WheelData::new(21.5, 21.5, 23.0, 23.0),
                surface_types: WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
                ..Default::default()
            },
            CarTelemetryData {
                speed: 171,
                throttle: 1.0,
                steer: 0.18905859,
                brake: 0.0,
                clutch: 0,
                gear: 4,
                engine_rpm: 10886,
                drs: false,
                rev_lights_percent: 0,
                brakes_temperature: WheelData::new(695, 694, 749, 748),
                tyres_surface_temperature: WheelData::new(97, 86, 108, 83),
                tyres_inner_temperature: WheelData::new(91, 89, 89, 85),
                engine_temperature: 90,
                tyre_pressures: WheelData::new(21.5, 21.5, 23.0, 23.0),
                surface_types: WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
                ..Default::default()
            },
            CarTelemetryData {
                speed: 197,
                throttle: 0.0,
                steer: -0.031080177,
                brake: 1.0,
                clutch: 0,
                gear: 5,
                engine_rpm: 10417,
                drs: false,
                rev_lights_percent: 0,
                brakes_temperature: WheelData::new(790, 790, 881, 882),
                tyres_surface_temperature: WheelData::new(98, 89, 102, 85),
                tyres_inner_temperature: WheelData::new(95, 91, 94, 87),
                engine_temperature: 90,
                tyre_pressures: WheelData::new(21.5, 21.5, 23.0, 23.0),
                surface_types: WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
                ..Default::default()
            },
            CarTelemetryData {
                speed: 197,
                throttle: 1.0,
                steer: 0.15236217,
                brake: 0.0,
                clutch: 0,
                gear: 5,
                engine_rpm: 10663,
                drs: false,
                rev_lights_percent: 0,
                brakes_temperature: WheelData::new(727, 723, 779, 776),
                tyres_surface_temperature: WheelData::new(100, 89, 103, 82),
                tyres_inner_temperature: WheelData::new(93, 89, 91, 87),
                engine_temperature: 90,
                tyre_pressures: WheelData::new(21.5, 21.5, 23.0, 23.0),
                surface_types: WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
                ..Default::default()
            },
            CarTelemetryData {
                speed: 174,
                throttle: 0.788279,
                steer: 0.2293352,
                brake: 0.0,
                clutch: 0,
                gear: 4,
                engine_rpm: 11082,
                drs: false,
                rev_lights_percent: 11,
                brakes_temperature: WheelData::new(691, 689, 744, 743),
                tyres_surface_temperature: WheelData::new(97, 86, 103, 80),
                tyres_inner_temperature: WheelData::new(91, 88, 90, 85),
                engine_temperature: 90,
                tyre_pressures: WheelData::new(21.5, 21.5, 23.0, 23.0),
                surface_types: WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
                ..Default::default()
            },
            CarTelemetryData {
                speed: 200,
                throttle: 1.0,
                steer: 0.16674478,
                brake: 0.0,
                clutch: 0,
                gear: 5,
                engine_rpm: 11032,
                drs: false,
                rev_lights_percent: 11,
                brakes_temperature: WheelData::new(721, 718, 771, 769),
                tyres_surface_temperature: WheelData::new(103, 90, 106, 83),
                tyres_inner_temperature: WheelData::new(91, 89, 91, 87),
                engine_temperature: 90,
                tyre_pressures: WheelData::new(21.5, 21.5, 23.0, 23.0),
                surface_types: WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
                ..Default::default()
            },
            CarTelemetryData {
                speed: 193,
                throttle: 0.98594505,
                steer: 0.1016182,
                brake: 0.0,
                clutch: 0,
                gear: 5,
                engine_rpm: 10549,
                drs: false,
                rev_lights_percent: 0,
                brakes_temperature: WheelData::new(722, 719, 770, 768),
                tyres_surface_temperature: WheelData::new(101, 88, 114, 88),
                tyres_inner_temperature: WheelData::new(93, 89, 94, 88),
                engine_temperature: 90,
                tyre_pressures: WheelData::new(21.5, 21.5, 23.0, 23.0),
                surface_types: WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
                ..Default::default()
            },
            CarTelemetryData {
                speed: 194,
                throttle: 0.9920572,
                steer: 0.14889424,
                brake: 0.0,
                clutch: 0,
                gear: 5,
                engine_rpm: 10599,
                drs: false,
                rev_lights_percent: 0,
                brakes_temperature: WheelData::new(696, 693, 745, 743),
                tyres_surface_temperature: WheelData::new(102, 89, 106, 82),
                tyres_inner_temperature: WheelData::new(92, 89, 91, 87),
                engine_temperature: 90,
                tyre_pressures: WheelData::new(21.5, 21.5, 23.0, 23.0),
                surface_types: WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
                ..Default::default()
            },
            CarTelemetryData {
                speed: 193,
                throttle: 1.0,
                steer: 0.114541925,
                brake: 0.0,
                clutch: 0,
                gear: 4,
                engine_rpm: 11814,
                drs: false,
                rev_lights_percent: 93,
                brakes_temperature: WheelData::new(700, 697, 755, 752),
                tyres_surface_temperature: WheelData::new(100, 88, 109, 84),
                tyres_inner_temperature: WheelData::new(93, 90, 93, 87),
                engine_temperature: 90,
                tyre_pressures: WheelData::new(21.5, 21.5, 23.0, 23.0),
                surface_types: WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
                ..Default::default()
            },
            CarTelemetryData {
                speed: 168,
                throttle: 0.9451677,
                steer: 0.21130775,
                brake: 0.0,
                clutch: 0,
                gear: 4,
                engine_rpm: 10704,
                drs: false,
                rev_lights_percent: 0,
                brakes_temperature: WheelData::new(702, 701, 757, 757),
                tyres_surface_temperature: WheelData::new(96, 85, 103, 82),
                tyres_inner_temperature: WheelData::new(91, 89, 90, 86),
                engine_temperature: 90,
                tyre_pressures: WheelData::new(21.5, 21.5, 23.0, 23.0),
                surface_types: WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
                ..Default::default()
            },
            CarTelemetryData {
                speed: 183,
                throttle: 0.76181316,
                steer: 0.19761954,
                brake: 0.0,
                clutch: 0,
                gear: 4,
                engine_rpm: 11579,
                drs: false,
                rev_lights_percent: 66,
                brakes_temperature: WheelData::new(686, 685, 736, 734),
                tyres_surface_temperature: WheelData::new(101, 88, 105, 81),
                tyres_inner_temperature: WheelData::new(93, 89, 91, 87),
                engine_temperature: 90,
                tyre_pressures: WheelData::new(21.5, 21.5, 23.0, 23.0),
                surface_types: WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
                ..Default::default()
            },
            CarTelemetryData {
                speed: 240,
                throttle: 1.0,
                steer: 0.019136636,
                brake: 0.0,
                clutch: 0,
                gear: 6,
                engine_rpm: 10924,
                drs: false,
                rev_lights_percent: 0,
                brakes_temperature: WheelData::new(601, 598, 632, 629),
                tyres_surface_temperature: WheelData::new(105, 92, 108, 85),
                tyres_inner_temperature: WheelData::new(94, 90, 92, 87),
                engine_temperature: 90,
                tyre_pressures: WheelData::new(21.5, 21.5, 23.0, 23.0),
                surface_types: WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
                ..Default::default()
            },
            CarTelemetryData {
                speed: 163,
                throttle: 0.0,
                steer: -0.20037761,
                brake: 1.0,
                clutch: 0,
                gear: 4,
                engine_rpm: 9833,
                drs: false,
                rev_lights_percent: 0,
                brakes_temperature: WheelData::new(862, 864, 958, 961),
                tyres_surface_temperature: WheelData::new(98, 91, 104, 90),
                tyres_inner_temperature: WheelData::new(96, 92, 94, 88),
                engine_temperature: 90,
                tyre_pressures: WheelData::new(21.5, 21.5, 23.0, 23.0),
                surface_types: WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
                ..Default::default()
            },
            CarTelemetryData {
                speed: 196,
                throttle: 0.55626357,
                steer: 0.28084677,
                brake: 0.0,
                clutch: 0,
                gear: 5,
                engine_rpm: 10266,
                drs: false,
                rev_lights_percent: 0,
                brakes_temperature: WheelData::new(698, 695, 745, 742),
                tyres_surface_temperature: WheelData::new(103, 89, 112, 85),
                tyres_inner_temperature: WheelData::new(94, 90, 92, 87),
                engine_temperature: 90,
                tyre_pressures: WheelData::new(21.5, 21.5, 23.0, 23.0),
                surface_types: WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
                ..Default::default()
            },
            CarTelemetryData {
                speed: 182,
                throttle: 0.9963209,
                steer: 0.18251868,
                brake: 0.0,
                clutch: 0,
                gear: 4,
                engine_rpm: 11617,
                drs: false,
                rev_lights_percent: 47,
                brakes_temperature: WheelData::new(688, 687, 740, 739),
                tyres_surface_temperature: WheelData::new(99, 87, 104, 81),
                tyres_inner_temperature: WheelData::new(92, 89, 90, 87),
                engine_temperature: 90,
                tyre_pressures: WheelData::new(21.5, 21.5, 23.0, 23.0),
                surface_types: WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
                ..Default::default()
            },
            CarTelemetryData {
                speed: 188,
                throttle: 0.31792042,
                steer: 0.17854193,
                brake: 0.0,
                clutch: 0,
                gear: 5,
                engine_rpm: 10283,
                drs: false,
                rev_lights_percent: 0,
                brakes_temperature: WheelData::new(670, 668, 720, 719),
                tyres_surface_temperature: WheelData::new(101, 87, 106, 82),
                tyres_inner_temperature: WheelData::new(92, 89, 90, 86),
                engine_temperature: 90,
                tyre_pressures: WheelData::new(21.5, 21.5, 23.0, 23.0),
                surface_types: WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
                ..Default::default()
            },
            CarTelemetryData {
                speed: 190,
                throttle: 0.9164313,
                steer: 0.14905334,
                brake: 0.0,
                clutch: 0,
                gear: 5,
                engine_rpm: 10356,
                drs: false,
                rev_lights_percent: 0,
                brakes_temperature: WheelData::new(715, 712, 767, 764),
                tyres_surface_temperature: WheelData::new(101, 89, 105, 82),
                tyres_inner_temperature: WheelData::new(92, 89, 91, 87),
                engine_temperature: 90,
                tyre_pressures: WheelData::new(21.5, 21.5, 23.0, 23.0),
                surface_types: WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
                ..Default::default()
            },
            CarTelemetryData {
                speed: 192,
                throttle: 0.9973545,
                steer: 0.16270086,
                brake: 0.0,
                clutch: 0,
                gear: 5,
                engine_rpm: 10583,
                drs: false,
                rev_lights_percent: 0,
                brakes_temperature: WheelData::new(727, 723, 781, 778),
                tyres_surface_temperature: WheelData::new(100, 89, 104, 83),
                tyres_inner_temperature: WheelData::new(92, 89, 91, 87),
                engine_temperature: 90,
                tyre_pressures: WheelData::new(21.5, 21.5, 23.0, 23.0),
                surface_types: WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
                ..Default::default()
            },
            CarTelemetryData {
                speed: 219,
                throttle: 0.0,
                steer: 0.0,
                brake: 0.0,
                clutch: 0,
                gear: 5,
                engine_rpm: 11264,
                drs: false,
                rev_lights_percent: 30,
                brakes_temperature: WheelData::new(696, 694, 725, 723),
                tyres_surface_temperature: WheelData::new(112, 97, 114, 86),
                tyres_inner_temperature: WheelData::new(97, 93, 95, 89),
                engine_temperature: 106,
                tyre_pressures: WheelData::new(21.5, 21.5, 23.0, 23.0),
                surface_types: WheelData::new(
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                    SurfaceType::Tarmac,
                ),
                ..Default::default()
            },
        ],
        button_status: Some(0),
        mfd_panel: MFDPanel::NotSet,
        secondary_player_mfd_panel: MFDPanel::NotSet,
        suggested_gear: None,
    };

    assert_eq!(actual, expected)
}

#[tokio::test]
async fn test_parse_2019_car_status_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e30701160107fcc796d4ce430d49000a304269030000130001023c001ecc14410000dc4234729f3f2035cc100900020101011210020101010000000000009df03d4a035bd9a948e4f7c3485cc5c7490001003c00d67813410000dc42c8fb923fbc34d70e0900010101001210010101000000000000003f00424a03b504a748d7c9dc484f23c5490001013c001a6217410000dc420078a23fbc34cc100900010100001210010100000000000000009457544a041668a4487dd117490a83b4490001003c00b4ee15410000dc42b0b3a13fbc34d70e0900010101001210010101000000000000007924364a0428dcaf48a6b3d548ce4add490001003c0054f115410000dc4290e49c3fbc34d70e0900010101001210010101000000000000000b504e4a0476cca8482338084910deb9490001003c0084910e410000dc4260e06c3f2035cc100900010100001210010100000000000000009b74514a0422299a481bab14496a26b6490001013c001e0219410000dc42f406ac3fbc34ab0d0900010101001210010101000000000000007a284d4a041ebea94880170b491fdabd490001013c00bb6717410000dc429084a43fbc34cc100900010101001210010101000000000000007c68564a0434e5ac489db411494b73af490001003c00c1260e410000dc4218616a3fbc34cc10090001010100121001010100000000000000d8234b4a047ce8a248142b0749ca37be490001003c00b9d015410000dc42a4959c3f2035cc10090001010100121001010100000000000000ff6e514a04b7b5a648d2140b49138ab4490001003c0005a013410000dc42485b8f3fbc34ab0d090001010000121001010000000000000000111f4f4a044c6d9f486f3a1149bc67ba490001003c0008e414410000dc4208cd963f2035cc100900010101001210010101000000000000002f914f4a04326ca34868870e49a02ab9490001013c00ae4f18410000dc42c8d5aa3fbc34d70e090001010100121001010100000000000000f25a424a04811b9f484269f4488f59c8490001003c0082db12410000dc4294d2923fbc34cc100900010101001210010101000000000000000ef83f4a039f46b74852ced8483a42cc490001013c004ce117410000dc42782ea73f2035cc10090001010100121001010100000000000000ddba4f4a044c28a848997709499e7eb7490001003c00ff6013410000dc4254e68e3fbc34cc10090001010000121001010000000000000000eb9e4f4a044164974865bb0d4959a9b5490001003c0087df0c410000dc42e0e75c3fbc34ab0d090001010000121001010000000000000000bacb4a4a04d49f9c48150b09497243be490001013c00010018410000dc42acb8a63fbc34cc100900010101001210010101000000000000008788524a04fdf6a6483a991449e027b7490001003c009eb215410000dc42586e9b3fbc34ab0d090001010100121001010100000000000000df0a4d4a045e49a448427d074918e8ba490101013c00225114410000dc42b4c5953f2035cc10090001010100121001010100180000000000d3692e4a057e0bb248c323cb4860c0ea49").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::CarStatus(s) => s,
        _ => panic!("Invalid packet. Expected CarStatus, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2019);

    let expected = PacketCarStatusData {
        header: actual.header.clone(),
        car_status_data: vec![
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Rich,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 9.299833,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.2456727,
                max_rpm: 13600,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: None,
                tyres_wear: Some(WheelData::new(2, 1, 1, 1)),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyres_damage: Some(WheelData::new(2, 1, 1, 1)),
                front_left_wing_damage: Some(0),
                front_right_wing_damage: Some(0),
                rear_wing_damage: Some(0),
                engine_damage: Some(0),
                gear_box_damage: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3111975.3,
                ers_deploy_mode: ERSDeployMode::High,
                ers_harvested_this_lap_mguk: 347850.84,
                ers_harvested_this_lap_mguh: 401343.13,
                ers_deployed_this_lap: 1636523.5,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Lean,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 9.217001,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.1483088,
                max_rpm: 13500,
                idle_rpm: 3799,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: None,
                tyres_wear: Some(WheelData::new(1, 1, 1, 0)),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyres_damage: Some(WheelData::new(1, 1, 1, 0)),
                front_left_wing_damage: Some(0),
                front_right_wing_damage: Some(0),
                rear_wing_damage: Some(0),
                engine_damage: Some(0),
                gear_box_damage: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3178511.8,
                ers_deploy_mode: ERSDeployMode::High,
                ers_harvested_this_lap_mguk: 342053.66,
                ers_harvested_this_lap_mguh: 452174.72,
                ers_deployed_this_lap: 1614953.9,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 9.461451,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.2692871,
                max_rpm: 13500,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: None,
                tyres_wear: Some(WheelData::new(1, 1, 0, 0)),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyres_damage: Some(WheelData::new(1, 1, 0, 0)),
                front_left_wing_damage: Some(0),
                front_right_wing_damage: Some(0),
                rear_wing_damage: Some(0),
                engine_damage: Some(0),
                gear_box_damage: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3479013.0,
                ers_deploy_mode: ERSDeployMode::Overtake,
                ers_harvested_this_lap_mguk: 336704.7,
                ers_harvested_this_lap_mguh: 621847.8,
                ers_deployed_this_lap: 1478753.3,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Lean,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 9.370777,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.2632961,
                max_rpm: 13500,
                idle_rpm: 3799,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: None,
                tyres_wear: Some(WheelData::new(1, 1, 1, 0)),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyres_damage: Some(WheelData::new(1, 1, 1, 0)),
                front_left_wing_damage: Some(0),
                front_right_wing_damage: Some(0),
                rear_wing_damage: Some(0),
                engine_damage: Some(0),
                gear_box_damage: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 2984222.3,
                ers_deploy_mode: ERSDeployMode::Overtake,
                ers_harvested_this_lap_mguk: 360161.25,
                ers_harvested_this_lap_mguh: 437661.2,
                ers_deployed_this_lap: 1812825.8,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Lean,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 9.371418,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.2257252,
                max_rpm: 13500,
                idle_rpm: 3799,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: None,
                tyres_wear: Some(WheelData::new(1, 1, 1, 0)),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyres_damage: Some(WheelData::new(1, 1, 1, 0)),
                front_left_wing_damage: Some(0),
                front_right_wing_damage: Some(0),
                rear_wing_damage: Some(0),
                engine_damage: Some(0),
                gear_box_damage: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3380226.8,
                ers_deploy_mode: ERSDeployMode::Overtake,
                ers_harvested_this_lap_mguk: 345699.7,
                ers_harvested_this_lap_mguh: 557954.2,
                ers_deployed_this_lap: 1522626.0,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Lean,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 8.910526,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 0.9252987,
                max_rpm: 13600,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: None,
                tyres_wear: Some(WheelData::new(1, 1, 0, 0)),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyres_damage: Some(WheelData::new(1, 1, 0, 0)),
                front_left_wing_damage: Some(0),
                front_right_wing_damage: Some(0),
                rear_wing_damage: Some(0),
                engine_damage: Some(0),
                gear_box_damage: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3431718.8,
                ers_deploy_mode: ERSDeployMode::Overtake,
                ers_harvested_this_lap_mguk: 315721.06,
                ers_harvested_this_lap_mguh: 608945.7,
                ers_deployed_this_lap: 1492173.3,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 9.563017,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.3439622,
                max_rpm: 13500,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: None,
                tyres_wear: Some(WheelData::new(1, 1, 1, 0)),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyres_damage: Some(WheelData::new(1, 1, 1, 0)),
                front_left_wing_damage: Some(0),
                front_right_wing_damage: Some(0),
                rear_wing_damage: Some(0),
                engine_damage: Some(0),
                gear_box_damage: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3361310.5,
                ers_deploy_mode: ERSDeployMode::Overtake,
                ers_harvested_this_lap_mguk: 347632.94,
                ers_harvested_this_lap_mguh: 569720.0,
                ers_deployed_this_lap: 1555267.9,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 9.462825,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.2852955,
                max_rpm: 13500,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: None,
                tyres_wear: Some(WheelData::new(1, 1, 1, 0)),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyres_damage: Some(WheelData::new(1, 1, 1, 0)),
                front_left_wing_damage: Some(0),
                front_right_wing_damage: Some(0),
                rear_wing_damage: Some(0),
                engine_damage: Some(0),
                gear_box_damage: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3512863.0,
                ers_deploy_mode: ERSDeployMode::Overtake,
                ers_harvested_this_lap_mguk: 354089.63,
                ers_harvested_this_lap_mguh: 596809.8,
                ers_deployed_this_lap: 1437289.4,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Lean,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 8.884461,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 0.91554403,
                max_rpm: 13500,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: None,
                tyres_wear: Some(WheelData::new(1, 1, 1, 0)),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyres_damage: Some(WheelData::new(1, 1, 1, 0)),
                front_left_wing_damage: Some(0),
                front_right_wing_damage: Some(0),
                rear_wing_damage: Some(0),
                engine_damage: Some(0),
                gear_box_damage: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3328246.0,
                ers_deploy_mode: ERSDeployMode::Overtake,
                ers_harvested_this_lap_mguk: 333635.88,
                ers_harvested_this_lap_mguh: 553649.25,
                ers_deployed_this_lap: 1558265.3,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Lean,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 9.363458,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.2233167,
                max_rpm: 13600,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: None,
                tyres_wear: Some(WheelData::new(1, 1, 1, 0)),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyres_damage: Some(WheelData::new(1, 1, 1, 0)),
                front_left_wing_damage: Some(0),
                front_right_wing_damage: Some(0),
                rear_wing_damage: Some(0),
                engine_damage: Some(0),
                gear_box_damage: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3431359.8,
                ers_deploy_mode: ERSDeployMode::Overtake,
                ers_harvested_this_lap_mguk: 341421.72,
                ers_harvested_this_lap_mguh: 569677.1,
                ers_deployed_this_lap: 1478978.4,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Lean,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 9.226567,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.1199732,
                max_rpm: 13500,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: None,
                tyres_wear: Some(WheelData::new(1, 1, 0, 0)),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyres_damage: Some(WheelData::new(1, 1, 0, 0)),
                front_left_wing_damage: Some(0),
                front_right_wing_damage: Some(0),
                rear_wing_damage: Some(0),
                engine_damage: Some(0),
                gear_box_damage: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3393476.3,
                ers_deploy_mode: ERSDeployMode::Overtake,
                ers_harvested_this_lap_mguk: 326506.38,
                ers_harvested_this_lap_mguh: 594854.94,
                ers_deployed_this_lap: 1527031.5,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Lean,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 9.305672,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.178132,
                max_rpm: 13600,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: None,
                tyres_wear: Some(WheelData::new(1, 1, 1, 0)),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyres_damage: Some(WheelData::new(1, 1, 1, 0)),
                front_left_wing_damage: Some(0),
                front_right_wing_damage: Some(0),
                rear_wing_damage: Some(0),
                engine_damage: Some(0),
                gear_box_damage: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3400779.8,
                ers_deploy_mode: ERSDeployMode::Overtake,
                ers_harvested_this_lap_mguk: 334689.56,
                ers_harvested_this_lap_mguh: 583798.5,
                ers_deployed_this_lap: 1516884.0,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 9.519453,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.3346491,
                max_rpm: 13500,
                idle_rpm: 3799,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: None,
                tyres_wear: Some(WheelData::new(1, 1, 1, 0)),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyres_damage: Some(WheelData::new(1, 1, 1, 0)),
                front_left_wing_damage: Some(0),
                front_right_wing_damage: Some(0),
                rear_wing_damage: Some(0),
                engine_damage: Some(0),
                gear_box_damage: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3184316.5,
                ers_deploy_mode: ERSDeployMode::Overtake,
                ers_harvested_this_lap_mguk: 325852.03,
                ers_harvested_this_lap_mguh: 500554.06,
                ers_deployed_this_lap: 1641265.9,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Lean,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 9.178591,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.1470513,
                max_rpm: 13500,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: None,
                tyres_wear: Some(WheelData::new(1, 1, 1, 0)),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyres_damage: Some(WheelData::new(1, 1, 1, 0)),
                front_left_wing_damage: Some(0),
                front_right_wing_damage: Some(0),
                rear_wing_damage: Some(0),
                engine_damage: Some(0),
                gear_box_damage: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3145219.5,
                ers_deploy_mode: ERSDeployMode::High,
                ers_harvested_this_lap_mguk: 375348.97,
                ers_harvested_this_lap_mguh: 444018.56,
                ers_deployed_this_lap: 1673287.3,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 9.492504,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.3061056,
                max_rpm: 13600,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: None,
                tyres_wear: Some(WheelData::new(1, 1, 1, 0)),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyres_damage: Some(WheelData::new(1, 1, 1, 0)),
                front_left_wing_damage: Some(0),
                front_right_wing_damage: Some(0),
                rear_wing_damage: Some(0),
                engine_damage: Some(0),
                gear_box_damage: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3403447.3,
                ers_deploy_mode: ERSDeployMode::Overtake,
                ers_harvested_this_lap_mguk: 344386.38,
                ers_harvested_this_lap_mguh: 563065.56,
                ers_deployed_this_lap: 1503187.8,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Lean,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 9.211181,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.116404,
                max_rpm: 13500,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: None,
                tyres_wear: Some(WheelData::new(1, 1, 0, 0)),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyres_damage: Some(WheelData::new(1, 1, 0, 0)),
                front_left_wing_damage: Some(0),
                front_right_wing_damage: Some(0),
                rear_wing_damage: Some(0),
                engine_damage: Some(0),
                gear_box_damage: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3401658.8,
                ers_deploy_mode: ERSDeployMode::Overtake,
                ers_harvested_this_lap_mguk: 310050.03,
                ers_harvested_this_lap_mguh: 580534.3,
                ers_deployed_this_lap: 1488171.1,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Lean,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 8.804572,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 0.86291313,
                max_rpm: 13500,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: None,
                tyres_wear: Some(WheelData::new(1, 1, 0, 0)),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyres_damage: Some(WheelData::new(1, 1, 0, 0)),
                front_left_wing_damage: Some(0),
                front_right_wing_damage: Some(0),
                rear_wing_damage: Some(0),
                engine_damage: Some(0),
                gear_box_damage: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3322606.5,
                ers_deploy_mode: ERSDeployMode::Overtake,
                ers_harvested_this_lap_mguk: 320766.63,
                ers_harvested_this_lap_mguh: 561329.3,
                ers_deployed_this_lap: 1558638.3,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 9.500001,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.3025107,
                max_rpm: 13500,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: None,
                tyres_wear: Some(WheelData::new(1, 1, 1, 0)),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyres_damage: Some(WheelData::new(1, 1, 1, 0)),
                front_left_wing_damage: Some(0),
                front_right_wing_damage: Some(0),
                rear_wing_damage: Some(0),
                engine_damage: Some(0),
                gear_box_damage: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3449377.8,
                ers_deploy_mode: ERSDeployMode::Overtake,
                ers_harvested_this_lap_mguk: 341943.9,
                ers_harvested_this_lap_mguh: 608659.6,
                ers_deployed_this_lap: 1500412.0,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Lean,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 9.356108,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.2143049,
                max_rpm: 13500,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: None,
                tyres_wear: Some(WheelData::new(1, 1, 1, 0)),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyres_damage: Some(WheelData::new(1, 1, 1, 0)),
                front_left_wing_damage: Some(0),
                front_right_wing_damage: Some(0),
                rear_wing_damage: Some(0),
                engine_damage: Some(0),
                gear_box_damage: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3359415.8,
                ers_deploy_mode: ERSDeployMode::Overtake,
                ers_harvested_this_lap_mguk: 336458.94,
                ers_harvested_this_lap_mguh: 554964.1,
                ers_deployed_this_lap: 1531139.0,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Low,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 9.269808,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.1700959,
                max_rpm: 13600,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: None,
                tyres_wear: Some(WheelData::new(1, 1, 1, 0)),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyres_damage: Some(WheelData::new(1, 1, 1, 0)),
                front_left_wing_damage: Some(24),
                front_right_wing_damage: Some(0),
                rear_wing_damage: Some(0),
                engine_damage: Some(0),
                gear_box_damage: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 2857588.8,
                ers_deploy_mode: ERSDeployMode::Hotlap,
                ers_harvested_this_lap_mguk: 364635.94,
                ers_harvested_this_lap_mguh: 416030.1,
                ers_deployed_this_lap: 1923084.0,
                ..Default::default()
            },
        ],
    };

    assert_eq!(actual, expected);
}
