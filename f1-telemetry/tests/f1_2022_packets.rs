use f1_telemetry::packet::car_damage::{CarDamageData, PacketCarDamageData};
use f1_telemetry::packet::car_setup::{CarSetupData, PacketCarSetupData};
use f1_telemetry::packet::car_status::{
    CarStatusData, ERSDeployMode, FuelMix, PacketCarStatusData, TractionControl, DRS,
};
use f1_telemetry::packet::car_telemetry::{
    CarTelemetryData, MFDPanel, PacketCarTelemetryData, SurfaceType,
};
use f1_telemetry::packet::event::{Event, PacketEventData, SpeedTrap};
use f1_telemetry::packet::final_classification::{
    FinalClassification, PacketFinalClassificationData,
};
use f1_telemetry::packet::generic::{
    Flag, Nationality, ResultStatus, Team, TyreCompound, TyreCompoundVisual, WheelData,
};
use f1_telemetry::packet::lap::{DriverStatus, LapData, PacketLapData, PitStatus, Sector};
use f1_telemetry::packet::lobby_info::{PacketLobbyInfoData, Player, ReadyStatus};
use f1_telemetry::packet::motion::{CarMotionData, PacketMotionData, PlayerCarData};
use f1_telemetry::packet::participants::{
    Driver, PacketParticipantsData, ParticipantData, Telemetry,
};
use f1_telemetry::packet::session::{
    BrakingAssist, DrivingAssists, DynamicRacingLine, DynamicRacingLineType, ForecastAccuracy,
    Formula, GameMode, GearboxAssist, MarshalZone, PacketSessionData, RuleSet, SafetyCar,
    SessionLength, SessionType, TemperatureChange, Track, Weather, WeatherForecast,
    WeatherForecastSample,
};
use f1_telemetry::packet::session_history::{
    LapHistoryData, PacketSessionHistoryData, TyreStintData,
};
use f1_telemetry::packet::Packet;

mod utils;

#[tokio::test]
async fn test_parse_2022_motion_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e60701020100321aca82d6efd8a364291442fb02000013ff397eac43e20ed5428d1bb5c3dc7020c2cc73c43d1888e1412697950067499ab63d012697a65b2f3dde33973fc2982b3e9ac675bf8013183cd39c1ebc4185c6435c3cd7425be9dfc3743e0641707f643cfbe8d54106270600e6791e86f3fd0427391cfabfba7eb63d6263823c08a59e3e803e7bbcdc6a833c8e61b0433d12d5427bd6b7c37e6e1bc2ca88fcbd77bde04120981000c84a39b55c012198fb565bbeb754443fe88a06bd626572bf001fd93bf7192ebcad12c9434432d7425713d9c301c59bbfe2c1aebe7814e74130f728fead7f5480edfd28f7a9b7cebf15b2083f1d223cbe222e8dbd80a08cbc95c9843cefdac843ea58d742f6e8dcc30ae882404e1939be6fffde41d30e2bff217fe280e1fdcf0e9f28febf0465b33e4f407fbd3cc9ed3d40e580bc8afe873caa2e6c43d2c9d042218a80c3009713c2a8f9dcbe7bb27442cfbe58ff256edd917afecfbe53a7ce3f03d7123fb0bd573e9ed108bf00cc52bce40a433c7ae1c443e12dd742efcde3c331826041d6f0833e1f33cb41843e9400b06f549022fe843eba4900c05edabe3d4d5ae73de5a6023f801175bc2a506f3c066382431bd6d142eaff91c33b852ac20b6a5fbfa94e4c421daf62fe2f63ce9c95001daf8289f43f7cb5493f0e0232bda61f2fbf00ed91bb338a95bb0e8fbf4350e7d542c899c4c3ddc5c0c106cf4bbf7675e14133aa52fdf05e09a1a60031aaf610d0bf60945d3f1adaf4bdbd183cbf002728bc73d3a6bb4cb8b443b01bd5421314bbc32bb312c2bdc528be6536d641149881ffb74a4ab5000218988f5e57bffa06bf3fc69e683f2c8e72bf0077c33b1f1680bcd576c7438e2ad742a33adbc3cd34be3f2b6566be4e2bd6412706e7fed77f2c80befd2206179dc7bf51b67a3fc473553e741a453d400e8dbcce99903c4a057743f73dd142be5489c3fcb61ec2c3f969bf51ab6742ceb868fe5a6aa3958a00ceb878c0e63f8c6b263f6278a93c840117bf000c61bb49198abbe616c2433436d64258b9c8c3c3df99c1f9fc0fbf4105f44167ba16fe676b979489ff64baa87eeabffc9e3b3f6aa800beb52f13bf808b37bc28826f3b1e2ec84398eed6425523d3c349a30fc125df91be3f46eb41d8d8b8feda792b86b9fdd4d8d787bcbfe64d533f1a1f94bd1c399fbec0f5a3bc7bd0913c4080c64375c2d642962bd3c395180bc1197762bed3fff241c6db08ffc27a4385d7fdc3db5407c0bf53727c3f6abe9e3d89f392bec06896bc0e768a3c8f8a96439341d3429028a5c35ec83dc2ec1983bf18fb1342729beafd294fd4b035006f9b30397d3f7171babe1f9e113e4c6067bf806c41bc6351d4bac57dc4436b70d6424b15cbc373dc91c16ce203bfa96cf64110be1efeaf6d509204ff0bbe6e21e0bf6e60623f4401f83d66910abf008c68bc79acfc3b16e8a34325bad4422ee9aec331562dc210aa74bf25acf3413b97dbfd7e4985b6dafe35973e172a3cf20f9a3f0bb513bf378b75bf40b09abcb15a133cacf0cf426e12cc42676a04c4b2909a425f55c03f80ca6841c37db502a41770e882fcc27dfb62ec3cae61df3e5a1a47bc685ab13f00afd3bc5b95df3ca3079dc33e02bc42cda719c42052194014870cbd469623c07aacdb00fb600d9fbb027aacc962483faf51a33e8865993a7f0e36bfc063a83c0afeaebc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d256074295140442c3620e422b2c114264c333c08b95aa40867c56c092119840e4b55ac3272802445ec38bc3214beb43956864c03ba85dc09cd261c0e2035ac05981bbba320bf03b92bb63bb2b19013c3be4163e341bfdbb5a0460c0829f23bdcf9fb33dc97b333d0a7c65c08faa9c40d4097840f63f7d3e").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::Motion(m) => m,
        _ => panic!("Invalid packet. Expected Motion, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2022);

    let expected = PacketMotionData {
        header: actual.header.clone(),
        motion_data: vec![
            CarMotionData {
                world_position_x: 344.9861,
                world_position_y: 106.52907,
                world_position_z: -362.21524,
                world_velocity_x: -40.110214,
                world_velocity_y: 0.09592399,
                world_velocity_z: 28.191452,
                world_forward_dir_x: -26842,
                world_forward_dir_y: 149,
                world_forward_dir_z: 18791,
                world_right_dir_x: -18790,
                world_right_dir_y: 317,
                world_right_dir_z: -26842,
                g_force_lateral: 0.042812012,
                g_force_longitudinal: 1.1812704,
                g_force_vertical: 0.16757491,
                yaw: -0.96006167,
                pitch: 0.009281993,
                roll: -0.0096809445,
            },
            CarMotionData {
                world_position_x: 397.04105,
                world_position_y: 107.61789,
                world_position_z: -447.8231,
                world_velocity_x: 8.390247,
                world_velocity_y: 0.013946399,
                world_velocity_z: 26.73876,
                world_forward_dir_x: 9990,
                world_forward_dir_y: 6,
                world_forward_dir_z: 31206,
                world_right_dir_x: -31202,
                world_right_dir_y: -525,
                world_right_dir_z: 9988,
                g_force_lateral: -1.9539863,
                g_force_longitudinal: 0.0891089,
                g_force_vertical: 0.01591653,
                yaw: 0.30985284,
                pitch: -0.015334725,
                roll: 0.016042165,
            },
            CarMotionData {
                world_position_x: 352.76215,
                world_position_y: 106.53562,
                world_position_z: -367.67563,
                world_velocity_x: -38.857903,
                world_velocity_y: -0.12330778,
                world_velocity_z: 28.092512,
                world_forward_dir_x: -26592,
                world_forward_dir_y: 16,
                world_forward_dir_z: 19144,
                world_right_dir_x: -19143,
                world_right_dir_y: 348,
                world_right_dir_z: -26591,
                g_force_lateral: -0.21419899,
                g_force_longitudinal: 0.76691765,
                g_force_vertical: -0.032847315,
                yaw: -0.9468595,
                pitch: 0.00662601,
                roll: -0.010626308,
            },
            CarMotionData {
                world_position_x: 402.1459,
                world_position_y: 107.598175,
                world_position_z: -434.1511,
                world_velocity_x: -1.2169496,
                world_velocity_y: -0.34132296,
                world_velocity_z: 28.884995,
                world_forward_dir_x: -2256,
                world_forward_dir_y: -472,
                world_forward_dir_z: 32685,
                world_right_dir_x: -32684,
                world_right_dir_y: -531,
                world_right_dir_z: -2264,
                g_force_lateral: -1.6149799,
                g_force_longitudinal: 0.5339673,
                g_force_vertical: -0.18372388,
                yaw: -0.06893565,
                pitch: -0.017166376,
                roll: 0.016209403,
            },
            CarMotionData {
                world_position_x: 401.71042,
                world_position_y: 107.67366,
                world_position_z: -441.82,
                world_velocity_x: 4.090825,
                world_velocity_y: -0.18076059,
                world_velocity_z: 27.874723,
                world_forward_dir_x: 3795,
                world_forward_dir_y: -213,
                world_forward_dir_z: 32545,
                world_right_dir_x: -32542,
                world_right_dir_y: -543,
                world_right_dir_z: 3791,
                g_force_lateral: -1.9856147,
                g_force_longitudinal: 0.35038006,
                g_force_vertical: -0.06231719,
                yaw: 0.11610648,
                pitch: -0.015734315,
                roll: 0.016600866,
            },
            CarMotionData {
                world_position_x: 236.18228,
                world_position_y: 104.39418,
                world_position_z: -257.07913,
                world_velocity_x: -36.89746,
                world_velocity_y: -0.43159223,
                world_velocity_z: 61.174297,
                world_forward_dir_x: -16689,
                world_forward_dir_y: -168,
                world_forward_dir_z: 28197,
                world_right_dir_x: -28195,
                world_right_dir_y: -390,
                world_right_dir_z: -16689,
                g_force_lateral: 1.6144813,
                g_force_longitudinal: 0.5735933,
                g_force_vertical: 0.21068454,
                yaw: -0.5344485,
                pitch: -0.01286602,
                roll: 0.011904452,
            },
            CarMotionData {
                world_position_x: 393.76154,
                world_position_y: 107.58961,
                world_position_z: -455.60886,
                world_velocity_x: 14.031785,
                world_velocity_y: 0.2576968,
                world_velocity_z: 25.399961,
                world_forward_dir_x: 16004,
                world_forward_dir_y: 148,
                world_forward_dir_z: 28592,
                world_right_dir_x: -28588,
                world_right_dir_y: -478,
                world_right_dir_z: 16004,
                g_force_lateral: -2.0045,
                g_force_longitudinal: 0.09318994,
                g_force_vertical: 0.112965204,
                yaw: 0.5103591,
                pitch: -0.014957786,
                roll: 0.014606515,
            },
            CarMotionData {
                world_position_x: 260.77362,
                world_position_y: 104.918175,
                world_position_z: -291.99933,
                world_velocity_x: -42.630108,
                world_velocity_y: -0.87271184,
                world_velocity_z: 51.076817,
                world_forward_dir_x: -20707,
                world_forward_dir_y: -414,
                world_forward_dir_z: 25391,
                world_right_dir_x: -25394,
                world_right_dir_y: 149,
                world_right_dir_z: -20707,
                g_force_lateral: 1.9104464,
                g_force_longitudinal: 0.7879255,
                g_force_vertical: -0.04345899,
                yaw: -0.68407667,
                pitch: -0.0044533014,
                roll: -0.004563594,
            },
            CarMotionData {
                world_position_x: 383.1176,
                world_position_y: 106.95178,
                world_position_z: -393.20142,
                world_velocity_x: -24.096613,
                world_velocity_y: -0.7961277,
                world_velocity_z: 28.182354,
                world_forward_dir_x: -21965,
                world_forward_dir_y: -686,
                world_forward_dir_z: 24304,
                world_right_dir_x: -24311,
                world_right_dir_y: 166,
                world_right_dir_z: -21967,
                g_force_lateral: -1.6255176,
                g_force_longitudinal: 0.8655453,
                g_force_vertical: -0.11955662,
                yaw: -0.7347525,
                pitch: -0.010263205,
                roll: -0.0050911247,
            },
            CarMotionData {
                world_position_x: 361.43982,
                world_position_y: 106.55408,
                world_position_z: -374.15683,
                world_velocity_x: -36.67497,
                world_velocity_y: -0.16481681,
                world_velocity_z: 26.77656,
                world_forward_dir_x: -26604,
                world_forward_dir_y: -127,
                world_forward_dir_z: 19127,
                world_right_dir_x: -19126,
                world_right_dir_y: 512,
                world_right_dir_z: -26600,
                g_force_lateral: -0.8412866,
                g_force_longitudinal: 1.4924004,
                g_force_vertical: 0.9086727,
                yaw: -0.9474819,
                pitch: 0.0059651136,
                roll: -0.015635548,
            },
            CarMotionData {
                world_position_x: 398.92838,
                world_position_y: 107.583115,
                world_position_z: -438.4581,
                world_velocity_x: 1.4859864,
                world_velocity_y: -0.2249953,
                world_velocity_z: 26.771145,
                world_forward_dir_x: 1575,
                world_forward_dir_y: -281,
                world_forward_dir_z: 32727,
                world_right_dir_x: -32724,
                world_right_dir_y: -578,
                world_right_dir_z: 1570,
                g_force_lateral: -1.5594815,
                g_force_longitudinal: 0.9793444,
                g_force_vertical: 0.20844942,
                yaw: 0.04812093,
                pitch: -0.017218709,
                roll: 0.017651465,
            },
            CarMotionData {
                world_position_x: 247.02066,
                world_position_y: 104.621025,
                world_position_z: -274.66205,
                world_velocity_x: -39.678696,
                world_velocity_y: -0.9139673,
                world_velocity_z: 57.9173,
                world_forward_dir_x: -18226,
                world_forward_dir_y: -408,
                world_forward_dir_z: 27226,
                world_right_dir_x: -27229,
                world_right_dir_y: 138,
                world_right_dir_z: -18226,
                g_force_lateral: 1.8027487,
                g_force_longitudinal: 0.65007854,
                g_force_vertical: 0.020687286,
                yaw: -0.5898669,
                pitch: -0.0034339428,
                roll: -0.00421444,
            },
            CarMotionData {
                world_position_x: 388.1789,
                world_position_y: 107.105865,
                world_position_z: -401.448,
                world_velocity_x: -19.234259,
                world_velocity_y: -0.5624538,
                world_velocity_z: 30.502565,
                world_forward_dir_x: -17817,
                world_forward_dir_y: -490,
                world_forward_dir_z: 27495,
                world_right_dir_x: -27497,
                world_right_dir_y: -119,
                world_right_dir_z: -17820,
                g_force_lateral: -1.8319902,
                g_force_longitudinal: 0.73289466,
                g_force_vertical: -0.12564245,
                yaw: -0.5749467,
                pitch: -0.011202693,
                roll: 0.0036546085,
            },
            CarMotionData {
                world_position_x: 400.3603,
                world_position_y: 107.466,
                world_position_z: -422.27603,
                world_velocity_x: -8.977365,
                world_velocity_y: -0.28490558,
                world_velocity_z: 29.4093,
                world_forward_dir_x: -10024,
                world_forward_dir_y: -328,
                world_forward_dir_z: 31194,
                world_right_dir_x: -31189,
                world_right_dir_y: -583,
                world_right_dir_z: -10028,
                g_force_lateral: -1.4728955,
                g_force_longitudinal: 0.8254074,
                g_force_vertical: -0.07232495,
                yaw: -0.31098258,
                pitch: -0.020014644,
                roll: 0.017799607,
            },
            CarMotionData {
                world_position_x: 397.00195,
                world_position_y: 107.3798,
                world_position_z: -422.3405,
                world_velocity_x: -8.693501,
                world_velocity_y: -0.22115745,
                world_velocity_z: 30.374914,
                world_forward_dir_x: -9274,
                world_forward_dir_y: -248,
                world_forward_dir_z: 31426,
                world_right_dir_x: -31421,
                world_right_dir_y: -553,
                world_right_dir_z: -9277,
                g_force_lateral: -1.5002236,
                g_force_longitudinal: 0.98611945,
                g_force_vertical: 0.07751162,
                yaw: -0.28701428,
                pitch: -0.018360496,
                roll: 0.016901996,
            },
            CarMotionData {
                world_position_x: 301.0825,
                world_position_y: 105.628075,
                world_position_z: -330.3169,
                world_velocity_x: -47.44567,
                world_velocity_y: -1.0242286,
                world_velocity_z: 36.99521,
                world_forward_dir_x: -25742,
                world_forward_dir_y: -534,
                world_forward_dir_z: 20265,
                world_right_dir_x: -20268,
                world_right_dir_y: 53,
                world_right_dir_z: -25745,
                g_force_lateral: 0.98915386,
                g_force_longitudinal: -0.36414674,
                g_force_vertical: 0.14220475,
                yaw: -0.9038131,
                pitch: -0.011805654,
                roll: -0.0016198572,
            },
            CarMotionData {
                world_position_x: 392.98257,
                world_position_y: 107.21957,
                world_position_z: -406.16635,
                world_velocity_x: -18.232641,
                world_velocity_y: -0.5151737,
                world_velocity_z: 30.803057,
                world_forward_dir_x: -16880,
                world_forward_dir_y: -482,
                world_forward_dir_z: 28079,
                world_right_dir_x: -28080,
                world_right_dir_y: -252,
                world_right_dir_z: -16885,
                g_force_lateral: -1.7510202,
                g_force_longitudinal: 0.8842839,
                g_force_vertical: 0.121096164,
                yaw: -0.5412811,
                pitch: -0.014193535,
                roll: 0.00771099,
            },
            CarMotionData {
                world_position_x: 327.81317,
                world_position_y: 106.36356,
                world_position_z: -349.82172,
                world_velocity_x: -43.33417,
                world_velocity_y: -0.95571995,
                world_velocity_z: 30.459055,
                world_forward_dir_x: -26821,
                world_forward_dir_y: -549,
                world_forward_dir_z: 18814,
                world_right_dir_x: -18811,
                world_right_dir_y: -294,
                world_right_dir_z: -26827,
                g_force_lateral: 0.010381518,
                g_force_longitudinal: 1.2036116,
                g_force_vertical: -0.57698125,
                yaw: -0.9591555,
                pitch: -0.01888287,
                roll: 0.0089937905,
            },
            CarMotionData {
                world_position_x: 103.97006,
                world_position_y: 102.035995,
                world_position_z: -529.66254,
                world_velocity_x: 77.28261,
                world_velocity_y: 1.5026053,
                world_velocity_z: 14.549438,
                world_forward_dir_x: 32195,
                world_forward_dir_y: 693,
                world_forward_dir_z: 6052,
                world_right_dir_x: -6032,
                world_right_dir_y: -894,
                world_right_dir_z: 32194,
                g_force_lateral: 0.028855791,
                g_force_longitudinal: 0.4362921,
                g_force_vertical: -0.012152279,
                yaw: 1.3855715,
                pitch: -0.025840282,
                roll: 0.027292898,
            },
            CarMotionData {
                world_position_x: -314.05966,
                world_position_y: 94.00438,
                world_position_z: -614.6219,
                world_velocity_x: 2.3956375,
                world_velocity_y: -0.034308508,
                world_velocity_z: -2.556047,
                world_forward_dir_x: -21382,
                world_forward_dir_y: 219,
                world_forward_dir_z: 24827,
                world_right_dir_x: -24819,
                world_right_dir_y: 699,
                world_right_dir_z: -21382,
                g_force_lateral: 0.78275734,
                g_force_longitudinal: 0.31898257,
                g_force_vertical: 0.0011703232,
                yaw: -0.7111587,
                pitch: 0.020555377,
                roll: -0.02136137,
            },
            CarMotionData {
                world_position_x: 0.0,
                world_position_y: 0.0,
                world_position_z: 0.0,
                world_velocity_x: 0.0,
                world_velocity_y: 0.0,
                world_velocity_z: 0.0,
                world_forward_dir_x: 0,
                world_forward_dir_y: 0,
                world_forward_dir_z: 0,
                world_right_dir_x: 0,
                world_right_dir_y: 0,
                world_right_dir_z: 0,
                g_force_lateral: 0.0,
                g_force_longitudinal: 0.0,
                g_force_vertical: 0.0,
                yaw: 0.0,
                pitch: 0.0,
                roll: 0.0,
            },
            CarMotionData {
                world_position_x: 0.0,
                world_position_y: 0.0,
                world_position_z: 0.0,
                world_velocity_x: 0.0,
                world_velocity_y: 0.0,
                world_velocity_z: 0.0,
                world_forward_dir_x: 0,
                world_forward_dir_y: 0,
                world_forward_dir_z: 0,
                world_right_dir_x: 0,
                world_right_dir_y: 0,
                world_right_dir_z: 0,
                g_force_lateral: 0.0,
                g_force_longitudinal: 0.0,
                g_force_vertical: 0.0,
                yaw: 0.0,
                pitch: 0.0,
                roll: 0.0,
            },
        ],
        player_car_data: Some(PlayerCarData {
            suspension_position: WheelData {
                rear_left: 33.834785,
                rear_right: 33.0201,
                front_left: 35.596447,
                front_right: 36.293133,
            },
            suspension_velocity: WheelData {
                rear_left: -2.8088007,
                rear_right: 5.3307548,
                front_left: -3.3513503,
                front_right: 4.752145,
            },
            suspension_acceleration: WheelData {
                rear_left: -218.71051,
                rear_right: 520.6274,
                front_left: -279.5263,
                front_right: 470.58694,
            },
            wheel_speed: WheelData {
                rear_left: -3.5688832,
                rear_right: -3.463393,
                front_left: -3.5284796,
                front_right: -3.406487,
            },
            wheel_slip: WheelData {
                rear_left: -0.0014305516,
                rear_right: 0.0073255533,
                front_left: -0.0034749252,
                front_right: 0.007879536,
            },
            local_velocity_x: 0.147355,
            local_velocity_y: -0.00772419,
            local_velocity_z: -3.5002656,
            angular_velocity_x: -0.03994704,
            angular_velocity_y: 0.087707154,
            angular_velocity_z: 0.043819223,
            angular_acceleration_x: -3.5856957,
            angular_acceleration_y: 4.89582,
            angular_acceleration_z: 3.8755999,
            front_wheels_angle: 0.2473143,
        }),
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2022_session_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream,"e60701020101321aca82d6efd8a364291442fb02000013ff011f190520150a0300001c201c500000ff0011b14c743f006347dc3d03fde0303e0178ee813e007027a43e00676fb43e00389ac13e00c0fbd23e008601e43e00ef84f73e000e66033f00e234203f007d3d293f004a8f313f007e01403f0002694d3f005cfd633f0000000000000000000000000000000000000000000000030a00011f021902070a05011f021902070a0a011f0219020700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005a24477a5824477a5824477a5800001400000100000101000003016a04000003").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::Session(s) => s,
        _ => panic!("Invalid packet. Expected Session, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2022);

    let expected = PacketSessionData {
        header: actual.header.clone(),
        weather: Weather::LightCloud,
        track_temperature: 31,
        air_temperature: 25,
        total_laps: 5,
        track_length: 5408,
        session_type: SessionType::Race,
        track: Track::Sakhir,
        formula: Formula::F1Modern,
        session_time_left: 7168,
        session_duration: 7200,
        pit_speed_limit: 80,
        game_paused: false,
        is_spectating: false,
        spectator_car_index: 255,
        sli_pro_native_support: false,
        num_marshal_zones: 17,
        marshal_zones: vec![
            MarshalZone {
                zone_start: 0.9542952,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.107558034,
                zone_flag: Flag::Yellow,
            },
            MarshalZone {
                zone_start: 0.17273326,
                zone_flag: Flag::Green,
            },
            MarshalZone {
                zone_start: 0.2537725,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.32061338,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.35241243,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.37812972,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.41207695,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.44532412,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.48343608,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.513276,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.6258069,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.6610945,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.69359267,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.75002277,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.80238354,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.8905847,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.0,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.0,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.0,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.0,
                zone_flag: Flag::None,
            },
        ],
        safety_car_status: SafetyCar::None,
        network_game: false,
        weather_forecast: Some(WeatherForecast {
            number_of_samples: 3,
            samples: vec![
                WeatherForecastSample {
                    session_type: SessionType::Race,
                    time_offset: 0,
                    weather: Weather::LightCloud,
                    track_temperature: 31,
                    track_temperature_change: TemperatureChange::NoChange,
                    air_temperature: 25,
                    air_temperature_change: TemperatureChange::NoChange,
                    rain_percentage: 7,
                },
                WeatherForecastSample {
                    session_type: SessionType::Race,
                    time_offset: 5,
                    weather: Weather::LightCloud,
                    track_temperature: 31,
                    track_temperature_change: TemperatureChange::NoChange,
                    air_temperature: 25,
                    air_temperature_change: TemperatureChange::NoChange,
                    rain_percentage: 7,
                },
                WeatherForecastSample {
                    session_type: SessionType::Race,
                    time_offset: 10,
                    weather: Weather::LightCloud,
                    track_temperature: 31,
                    track_temperature_change: TemperatureChange::NoChange,
                    air_temperature: 25,
                    air_temperature_change: TemperatureChange::NoChange,
                    rain_percentage: 7,
                },
            ],
            accuracy: ForecastAccuracy::Perfect,
        }),
        ai_difficulty: Some(90),
        season_identifier: Some(1484408612),
        weekend_identifier: Some(1484408612),
        session_identifier: Some(1484408612),
        pit_stop_window_ideal_lap: Some(0),
        pit_stop_window_latest_lap: Some(0),
        pit_stop_rejoin_position: Some(20),
        driving_assists: Some(DrivingAssists {
            steering_assist: false,
            braking_assist: BrakingAssist::Off,
            gearbox_assist: GearboxAssist::Manual,
            pit_assist: false,
            pit_relase_assist: false,
            ers_assist: true,
            drs_assist: true,
            dynamic_racing_line: DynamicRacingLine::Off,
            dynamic_racing_line_type: DynamicRacingLineType::TwoDimensions,
        }),
        game_mode: Some(GameMode::GrandPrix),
        rule_set: Some(RuleSet::Race),
        time_of_day: Some(1130),
        session_length: Some(SessionLength::Short),
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2022_lap_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e60701020102321aca82d6efd8a364291442fb02000013ff00000000f97b0000000000002003d0442003d044000000800601000000000000000009040200000000000000000000f97b0000000000000235c2440235c244000000801101000000000000000013040200000000000000000000f97b000000000000b8d3ce44b8d3ce44000000800701000000000000000005040200000000000000000000f97b0000000000005230c4445230c444000000800e01000000000000000012040200000000000000000000f97b0000000000007d2ec3447d2ec34400000080100100000000000000000f040200000000000000000000f67b00003e7b0000b34ae344b34ae344000000800101000001000000000001040200000000000000000000f97b0000000000003b54c0443b54c044000000801201000000000000000014040200000000000000000000f97b000000000000becfdd44becfdd44000000800301000000000000000006040200000000000000000000f97b00000000000028d8c94428d8c944000000800901000000000000000010040200000000000000000000f97b000000000000097acd44097acd4400000080080100000000000000000a040200000000000000000000f97b000000000000d9bcc344d9bcc344000000800f01000000000000000011040200000000000000000000f97b000000000000089fe044089fe044000000800201000000000000000003040200000000000000000000f97b0000000000009ab6c8449ab6c844000000800a01000000000000000008040200000000000000000000f97b00000000000059bac54459bac544000000800d0100000000000000000e040200000000000000000000f97b0000000000007ff2c5447ff2c544000000800c0100000000000000000d040200000000000000000000f97b00000000000088d9d64488d9d64400000080040100000000000000000c040200000000000000000000f97b000000000000d8e5c744d8e5c744000000800b0100000000000000000b040200000000000000000000f97b000000000000f7abd244f7abd244000000800501000000000000000007040200000000000000000000f97b000000000000b9bb9944b9bb9944000000801301000000000000000004040200000000000000000000f97b0000000000004c4941444c494144000000801401000000000200000002040700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000102").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::Lap(s) => s,
        _ => panic!("Invalid packet. Expected Lap, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2022);

    let expected = PacketLapData {
        header: actual.header.clone(),
        lap_data: vec![
            LapData {
                last_lap_time: 0,
                current_lap_time: 31737,
                sector_1_time: 0,
                sector_2_time: 0,
                best_lap_time: 0,
                best_lap_num: 0,
                best_lap_sector_1_time: 0,
                best_lap_sector_2_time: 0,
                best_lap_sector_3_time: 0,
                best_overall_sector_1_time: 0,
                best_overall_sector_1_lap_num: 0,
                best_overall_sector_2_time: 0,
                best_overall_sector_2_lap_num: 0,
                best_overall_sector_3_time: 0,
                best_overall_sector_3_lap_num: 0,
                lap_distance: 1664.0977,
                total_distance: 1664.0977,
                safety_car_delta: -0.0,
                car_position: 6,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector1,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 9,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 31737,
                sector_1_time: 0,
                sector_2_time: 0,
                best_lap_time: 0,
                best_lap_num: 0,
                best_lap_sector_1_time: 0,
                best_lap_sector_2_time: 0,
                best_lap_sector_3_time: 0,
                best_overall_sector_1_time: 0,
                best_overall_sector_1_lap_num: 0,
                best_overall_sector_2_time: 0,
                best_overall_sector_2_lap_num: 0,
                best_overall_sector_3_time: 0,
                best_overall_sector_3_lap_num: 0,
                lap_distance: 1553.6565,
                total_distance: 1553.6565,
                safety_car_delta: -0.0,
                car_position: 17,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector1,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 19,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 31737,
                sector_1_time: 0,
                sector_2_time: 0,
                best_lap_time: 0,
                best_lap_num: 0,
                best_lap_sector_1_time: 0,
                best_lap_sector_2_time: 0,
                best_lap_sector_3_time: 0,
                best_overall_sector_1_time: 0,
                best_overall_sector_1_lap_num: 0,
                best_overall_sector_2_time: 0,
                best_overall_sector_2_lap_num: 0,
                best_overall_sector_3_time: 0,
                best_overall_sector_3_lap_num: 0,
                lap_distance: 1654.6162,
                total_distance: 1654.6162,
                safety_car_delta: -0.0,
                car_position: 7,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector1,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 5,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 31737,
                sector_1_time: 0,
                sector_2_time: 0,
                best_lap_time: 0,
                best_lap_num: 0,
                best_lap_sector_1_time: 0,
                best_lap_sector_2_time: 0,
                best_lap_sector_3_time: 0,
                best_overall_sector_1_time: 0,
                best_overall_sector_1_lap_num: 0,
                best_overall_sector_2_time: 0,
                best_overall_sector_2_lap_num: 0,
                best_overall_sector_3_time: 0,
                best_overall_sector_3_lap_num: 0,
                lap_distance: 1569.51,
                total_distance: 1569.51,
                safety_car_delta: -0.0,
                car_position: 14,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector1,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 18,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 31737,
                sector_1_time: 0,
                sector_2_time: 0,
                best_lap_time: 0,
                best_lap_num: 0,
                best_lap_sector_1_time: 0,
                best_lap_sector_2_time: 0,
                best_lap_sector_3_time: 0,
                best_overall_sector_1_time: 0,
                best_overall_sector_1_lap_num: 0,
                best_overall_sector_2_time: 0,
                best_overall_sector_2_lap_num: 0,
                best_overall_sector_3_time: 0,
                best_overall_sector_3_lap_num: 0,
                lap_distance: 1561.4528,
                total_distance: 1561.4528,
                safety_car_delta: -0.0,
                car_position: 16,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector1,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 15,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 31734,
                sector_1_time: 31550,
                sector_2_time: 0,
                best_lap_time: 0,
                best_lap_num: 0,
                best_lap_sector_1_time: 0,
                best_lap_sector_2_time: 0,
                best_lap_sector_3_time: 0,
                best_overall_sector_1_time: 0,
                best_overall_sector_1_lap_num: 0,
                best_overall_sector_2_time: 0,
                best_overall_sector_2_lap_num: 0,
                best_overall_sector_3_time: 0,
                best_overall_sector_3_lap_num: 0,
                lap_distance: 1818.3344,
                total_distance: 1818.3344,
                safety_car_delta: -0.0,
                car_position: 1,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector2,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 1,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 31737,
                sector_1_time: 0,
                sector_2_time: 0,
                best_lap_time: 0,
                best_lap_num: 0,
                best_lap_sector_1_time: 0,
                best_lap_sector_2_time: 0,
                best_lap_sector_3_time: 0,
                best_overall_sector_1_time: 0,
                best_overall_sector_1_lap_num: 0,
                best_overall_sector_2_time: 0,
                best_overall_sector_2_lap_num: 0,
                best_overall_sector_3_time: 0,
                best_overall_sector_3_lap_num: 0,
                lap_distance: 1538.6322,
                total_distance: 1538.6322,
                safety_car_delta: -0.0,
                car_position: 18,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector1,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 20,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 31737,
                sector_1_time: 0,
                sector_2_time: 0,
                best_lap_time: 0,
                best_lap_num: 0,
                best_lap_sector_1_time: 0,
                best_lap_sector_2_time: 0,
                best_lap_sector_3_time: 0,
                best_overall_sector_1_time: 0,
                best_overall_sector_1_lap_num: 0,
                best_overall_sector_2_time: 0,
                best_overall_sector_2_lap_num: 0,
                best_overall_sector_3_time: 0,
                best_overall_sector_3_lap_num: 0,
                lap_distance: 1774.492,
                total_distance: 1774.492,
                safety_car_delta: -0.0,
                car_position: 3,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector1,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 6,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 31737,
                sector_1_time: 0,
                sector_2_time: 0,
                best_lap_time: 0,
                best_lap_num: 0,
                best_lap_sector_1_time: 0,
                best_lap_sector_2_time: 0,
                best_lap_sector_3_time: 0,
                best_overall_sector_1_time: 0,
                best_overall_sector_1_lap_num: 0,
                best_overall_sector_2_time: 0,
                best_overall_sector_2_lap_num: 0,
                best_overall_sector_3_time: 0,
                best_overall_sector_3_lap_num: 0,
                lap_distance: 1614.7549,
                total_distance: 1614.7549,
                safety_car_delta: -0.0,
                car_position: 9,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector1,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 16,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 31737,
                sector_1_time: 0,
                sector_2_time: 0,
                best_lap_time: 0,
                best_lap_num: 0,
                best_lap_sector_1_time: 0,
                best_lap_sector_2_time: 0,
                best_lap_sector_3_time: 0,
                best_overall_sector_1_time: 0,
                best_overall_sector_1_lap_num: 0,
                best_overall_sector_2_time: 0,
                best_overall_sector_2_lap_num: 0,
                best_overall_sector_3_time: 0,
                best_overall_sector_3_lap_num: 0,
                lap_distance: 1643.8136,
                total_distance: 1643.8136,
                safety_car_delta: -0.0,
                car_position: 8,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector1,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 10,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 31737,
                sector_1_time: 0,
                sector_2_time: 0,
                best_lap_time: 0,
                best_lap_num: 0,
                best_lap_sector_1_time: 0,
                best_lap_sector_2_time: 0,
                best_lap_sector_3_time: 0,
                best_overall_sector_1_time: 0,
                best_overall_sector_1_lap_num: 0,
                best_overall_sector_2_time: 0,
                best_overall_sector_2_lap_num: 0,
                best_overall_sector_3_time: 0,
                best_overall_sector_3_lap_num: 0,
                lap_distance: 1565.9015,
                total_distance: 1565.9015,
                safety_car_delta: -0.0,
                car_position: 15,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector1,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 17,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 31737,
                sector_1_time: 0,
                sector_2_time: 0,
                best_lap_time: 0,
                best_lap_num: 0,
                best_lap_sector_1_time: 0,
                best_lap_sector_2_time: 0,
                best_lap_sector_3_time: 0,
                best_overall_sector_1_time: 0,
                best_overall_sector_1_lap_num: 0,
                best_overall_sector_2_time: 0,
                best_overall_sector_2_lap_num: 0,
                best_overall_sector_3_time: 0,
                best_overall_sector_3_lap_num: 0,
                lap_distance: 1796.9697,
                total_distance: 1796.9697,
                safety_car_delta: -0.0,
                car_position: 2,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector1,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 3,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 31737,
                sector_1_time: 0,
                sector_2_time: 0,
                best_lap_time: 0,
                best_lap_num: 0,
                best_lap_sector_1_time: 0,
                best_lap_sector_2_time: 0,
                best_lap_sector_3_time: 0,
                best_overall_sector_1_time: 0,
                best_overall_sector_1_lap_num: 0,
                best_overall_sector_2_time: 0,
                best_overall_sector_2_lap_num: 0,
                best_overall_sector_3_time: 0,
                best_overall_sector_3_lap_num: 0,
                lap_distance: 1605.7063,
                total_distance: 1605.7063,
                safety_car_delta: -0.0,
                car_position: 10,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector1,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 8,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 31737,
                sector_1_time: 0,
                sector_2_time: 0,
                best_lap_time: 0,
                best_lap_num: 0,
                best_lap_sector_1_time: 0,
                best_lap_sector_2_time: 0,
                best_lap_sector_3_time: 0,
                best_overall_sector_1_time: 0,
                best_overall_sector_1_lap_num: 0,
                best_overall_sector_2_time: 0,
                best_overall_sector_2_lap_num: 0,
                best_overall_sector_3_time: 0,
                best_overall_sector_3_lap_num: 0,
                lap_distance: 1581.8234,
                total_distance: 1581.8234,
                safety_car_delta: -0.0,
                car_position: 13,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector1,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 14,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 31737,
                sector_1_time: 0,
                sector_2_time: 0,
                best_lap_time: 0,
                best_lap_num: 0,
                best_lap_sector_1_time: 0,
                best_lap_sector_2_time: 0,
                best_lap_sector_3_time: 0,
                best_overall_sector_1_time: 0,
                best_overall_sector_1_lap_num: 0,
                best_overall_sector_2_time: 0,
                best_overall_sector_2_lap_num: 0,
                best_overall_sector_3_time: 0,
                best_overall_sector_3_lap_num: 0,
                lap_distance: 1583.578,
                total_distance: 1583.578,
                safety_car_delta: -0.0,
                car_position: 12,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector1,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 13,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 31737,
                sector_1_time: 0,
                sector_2_time: 0,
                best_lap_time: 0,
                best_lap_num: 0,
                best_lap_sector_1_time: 0,
                best_lap_sector_2_time: 0,
                best_lap_sector_3_time: 0,
                best_overall_sector_1_time: 0,
                best_overall_sector_1_lap_num: 0,
                best_overall_sector_2_time: 0,
                best_overall_sector_2_lap_num: 0,
                best_overall_sector_3_time: 0,
                best_overall_sector_3_lap_num: 0,
                lap_distance: 1718.7979,
                total_distance: 1718.7979,
                safety_car_delta: -0.0,
                car_position: 4,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector1,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 12,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 31737,
                sector_1_time: 0,
                sector_2_time: 0,
                best_lap_time: 0,
                best_lap_num: 0,
                best_lap_sector_1_time: 0,
                best_lap_sector_2_time: 0,
                best_lap_sector_3_time: 0,
                best_overall_sector_1_time: 0,
                best_overall_sector_1_lap_num: 0,
                best_overall_sector_2_time: 0,
                best_overall_sector_2_lap_num: 0,
                best_overall_sector_3_time: 0,
                best_overall_sector_3_lap_num: 0,
                lap_distance: 1599.1826,
                total_distance: 1599.1826,
                safety_car_delta: -0.0,
                car_position: 11,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector1,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 11,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 31737,
                sector_1_time: 0,
                sector_2_time: 0,
                best_lap_time: 0,
                best_lap_num: 0,
                best_lap_sector_1_time: 0,
                best_lap_sector_2_time: 0,
                best_lap_sector_3_time: 0,
                best_overall_sector_1_time: 0,
                best_overall_sector_1_lap_num: 0,
                best_overall_sector_2_time: 0,
                best_overall_sector_2_lap_num: 0,
                best_overall_sector_3_time: 0,
                best_overall_sector_3_lap_num: 0,
                lap_distance: 1685.3739,
                total_distance: 1685.3739,
                safety_car_delta: -0.0,
                car_position: 5,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector1,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 7,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 31737,
                sector_1_time: 0,
                sector_2_time: 0,
                best_lap_time: 0,
                best_lap_num: 0,
                best_lap_sector_1_time: 0,
                best_lap_sector_2_time: 0,
                best_lap_sector_3_time: 0,
                best_overall_sector_1_time: 0,
                best_overall_sector_1_lap_num: 0,
                best_overall_sector_2_time: 0,
                best_overall_sector_2_lap_num: 0,
                best_overall_sector_3_time: 0,
                best_overall_sector_3_lap_num: 0,
                lap_distance: 1229.8663,
                total_distance: 1229.8663,
                safety_car_delta: -0.0,
                car_position: 19,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector1,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 4,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 31737,
                sector_1_time: 0,
                sector_2_time: 0,
                best_lap_time: 0,
                best_lap_num: 0,
                best_lap_sector_1_time: 0,
                best_lap_sector_2_time: 0,
                best_lap_sector_3_time: 0,
                best_overall_sector_1_time: 0,
                best_overall_sector_1_lap_num: 0,
                best_overall_sector_2_time: 0,
                best_overall_sector_2_lap_num: 0,
                best_overall_sector_3_time: 0,
                best_overall_sector_3_lap_num: 0,
                lap_distance: 773.14526,
                total_distance: 773.14526,
                safety_car_delta: -0.0,
                car_position: 20,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector1,
                current_lap_invalid: false,
                penalties: 2,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 2,
                driver_status: DriverStatus::OnTrack,
                result_status: ResultStatus::Retired,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData::default(),
            LapData::default(),
        ],
        time_trial_personal_best_car_idx: Some(1),
        time_trial_rival_car_idx: Some(2),
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2022_event_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(
        &stream,
        "e60701020103321aca82d6efd8a38f3ec8410102000013ff5350545013895a544300000779608e43",
    )
    .await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::Event(s) => s,
        _ => panic!("Invalid packet. Expected Event, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2022);

    let expected = PacketEventData {
        header: actual.header.clone(),
        event: Event::SpeedTrap(SpeedTrap {
            vehicle_idx: 19,
            speed: 212.35365,
            is_overall_fastest_in_session: Some(false),
            is_personal_fastest_in_session: Some(false),
            fastest_vehicle_idx_in_session: Some(7),
            fastest_speed_in_session: Some(284.7537),
        }),
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2022_participants_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e60701020104321aca82d6efd8a364291442fb02000013ff13013bff06000a1c4741534c5900000000000000000000000000000000000000000000000000000000000000000000000000000000000000010113ff0400120d5354524f4c4c000000000000000000000000000000000000000000000000000000000000000000000000000000000000010109ff020021165645525354415050454e0000000000000000000000000000000000000000000000000000000000000000000000000000010102ff0800030352494343494152444f00000000000000000000000000000000000000000000000000000000000000000000000000000001010dff0400051d56455454454c00000000000000000000000000000000000000000000000000000000000000000000000000000000000001010eff02000b3450c38952455a000000000000000000000000000000000000000000000000000000000000000000000000000000000000010136ff0800040a4e4f52524953000000000000000000000000000000000000000000000000000000000000000000000000000000000000010100ff0100374d5341494e5a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000001013eff03001750414c424f4e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000001015eff0600162b5453554e4f4441000000000000000000000000000000000000000000000000000000000000000000000000000000000001013fff0300060d4c4154494649000000000000000000000000000000000000000000000000000000000000000000000000000000000000010132ff00003f0a52555353454c4c0000000000000000000000000000000000000000000000000000000000000000000000000000000000010150ff0900180f4755414e5955000000000000000000000000000000000000000000000000000000000000000000000000000000000000010151ff07002f1d534348554d4143484552000000000000000000000000000000000000000000000000000000000000000000000000000001010fff09004d1b424f54544153000000000000000000000000000000000000000000000000000000000000000000000000000000000000010103ff05000e4d414c4f4e534f000000000000000000000000000000000000000000000000000000000000000000000000000000000000010111ff05001f1c4f434f4e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010bff070014154d41474e555353454e00000000000000000000000000000000000000000000000000000000000000000000000000000001013aff010010354c45434c4552430000000000000000000000000000000000000000000000000000000000000000000000000000000000010007ff00002c0a48414d494c544f4e000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffff0000ff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffff0000ff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::Participants(s) => s,
        _ => panic!("Invalid packet. Expected Participants, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2022);

    let expected = PacketParticipantsData {
        header: actual.header.clone(),
        num_active_cars: 19,
        participants: vec![
            ParticipantData {
                ai_controlled: true,
                driver: Driver::PierreGasly,
                network_id: Some(255),
                team: Team::AlphaTauri,
                my_team: false,
                race_number: 10,
                nationality: Nationality::French,
                name: "GASLY".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::LanceStroll,
                network_id: Some(255),
                team: Team::AstonMartin,
                my_team: false,
                race_number: 18,
                nationality: Nationality::Canadian,
                name: "STROLL".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::MaxVerstappen,
                network_id: Some(255),
                team: Team::RedBullRacing,
                my_team: false,
                race_number: 33,
                nationality: Nationality::Dutch,
                name: "VERSTAPPEN".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::DanielRicciardo,
                network_id: Some(255),
                team: Team::McLaren,
                my_team: false,
                race_number: 3,
                nationality: Nationality::Australian,
                name: "RICCIARDO".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::SebastianVettel,
                network_id: Some(255),
                team: Team::AstonMartin,
                my_team: false,
                race_number: 5,
                nationality: Nationality::German,
                name: "VETTEL".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::SergioPerez,
                network_id: Some(255),
                team: Team::RedBullRacing,
                my_team: false,
                race_number: 11,
                nationality: Nationality::Mexican,
                name: "PREZ".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::LandoNorris,
                network_id: Some(255),
                team: Team::McLaren,
                my_team: false,
                race_number: 4,
                nationality: Nationality::British,
                name: "NORRIS".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::CarlosSainz,
                network_id: Some(255),
                team: Team::Ferrari,
                my_team: false,
                race_number: 55,
                nationality: Nationality::Spanish,
                name: "SAINZ".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::AlexanderAlbon,
                network_id: Some(255),
                team: Team::Williams,
                my_team: false,
                race_number: 23,
                nationality: Nationality::Thai,
                name: "ALBON".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::YukiTsunoda,
                network_id: Some(255),
                team: Team::AlphaTauri,
                my_team: false,
                race_number: 22,
                nationality: Nationality::Japanese,
                name: "TSUNODA".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::NicholasLatifi,
                network_id: Some(255),
                team: Team::Williams,
                my_team: false,
                race_number: 6,
                nationality: Nationality::Canadian,
                name: "LATIFI".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::GeorgeRussell,
                network_id: Some(255),
                team: Team::Mercedes,
                my_team: false,
                race_number: 63,
                nationality: Nationality::British,
                name: "RUSSELL".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::GuanyaZhou,
                network_id: Some(255),
                team: Team::AlfaRomeo,
                my_team: false,
                race_number: 24,
                nationality: Nationality::Chinese,
                name: "GUANYU".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::MickSchumacher,
                network_id: Some(255),
                team: Team::Haas,
                my_team: false,
                race_number: 47,
                nationality: Nationality::German,
                name: "SCHUMACHER".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::ValtteriBottas,
                network_id: Some(255),
                team: Team::AlfaRomeo,
                my_team: false,
                race_number: 77,
                nationality: Nationality::Finnish,
                name: "BOTTAS".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::FernandoAlonso,
                network_id: Some(255),
                team: Team::Alpine,
                my_team: false,
                race_number: 14,
                nationality: Nationality::Spanish,
                name: "ALONSO".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::EstebanOcon,
                network_id: Some(255),
                team: Team::Alpine,
                my_team: false,
                race_number: 31,
                nationality: Nationality::French,
                name: "OCON".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::KevinMagnussen,
                network_id: Some(255),
                team: Team::Haas,
                my_team: false,
                race_number: 20,
                nationality: Nationality::Danish,
                name: "MAGNUSSEN".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::CharlesLeclerc,
                network_id: Some(255),
                team: Team::Ferrari,
                my_team: false,
                race_number: 16,
                nationality: Nationality::Monegasque,
                name: "LECLERC".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: false,
                driver: Driver::LewisHamilton,
                network_id: Some(255),
                team: Team::Mercedes,
                my_team: false,
                race_number: 44,
                nationality: Nationality::British,
                name: "HAMILTON".to_string(),
                telemetry_access: Telemetry::Restricted,
            },
            ParticipantData {
                ai_controlled: false,
                driver: Driver::Player,
                network_id: Some(255),
                team: Team::MyTeam,
                my_team: false,
                race_number: 0,
                nationality: Nationality::Invalid,
                name: "".to_string(),
                telemetry_access: Telemetry::Restricted,
            },
            ParticipantData {
                ai_controlled: false,
                driver: Driver::Player,
                network_id: Some(255),
                team: Team::MyTeam,
                my_team: false,
                race_number: 0,
                nationality: Nationality::Invalid,
                name: "".to_string(),
                telemetry_access: Telemetry::Restricted,
            },
        ],
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2022_car_setups_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e60701020105321aca82d6efd8a364291442fb02000013ff0812503c000040c00000c0bfcecccc3dae47e13e0a010a01030464360000aa410000aa410000ba410000ba4106000030410812503c000040c00000c0bfcecccc3dae47e13e0a010a01030464360000aa410000aa410000ba410000ba4106000030410812503c000040c00000c0bfcecccc3dae47e13e0a010a01030464360000aa410000aa410000ba410000ba4106000030410812503c000040c00000c0bfcecccc3dae47e13e0a010a01030464360000aa410000aa410000ba410000ba4106000030410812503c000040c00000c0bfcecccc3dae47e13e0a010a01030464360000aa410000aa410000ba410000ba4106000030410812503c000040c00000c0bfcecccc3dae47e13e0a010a01030464360000aa410000aa410000ba410000ba4106000030410812503c000040c00000c0bfcecccc3dae47e13e0a010a01030464360000aa410000aa410000ba410000ba4106000030410812503c000040c00000c0bfcecccc3dae47e13e0a010a01030464360000aa410000aa410000ba410000ba4106000030410812503c000040c00000c0bfcecccc3dae47e13e0a010a01030464360000aa410000aa410000ba410000ba4106000030410812503c000040c00000c0bfcecccc3dae47e13e0a010a01030464360000aa410000aa410000ba410000ba4106000030410812503c000040c00000c0bfcecccc3dae47e13e0a010a01030464360000aa410000aa410000ba410000ba4106000030410812503c000040c00000c0bfcecccc3dae47e13e0a010a01030464360000aa410000aa410000ba410000ba4106000030410812503c000040c00000c0bfcecccc3dae47e13e0a010a01030464360000aa410000aa410000ba410000ba4106000030410812503c000040c00000c0bfcecccc3dae47e13e0a010a01030464360000aa410000aa410000ba410000ba4106000030410812503c000040c00000c0bfcecccc3dae47e13e0a010a01030464360000aa410000aa410000ba410000ba4106000030410812503c000040c00000c0bfcecccc3dae47e13e0a010a01030464360000aa410000aa410000ba410000ba4106000030410812503c000040c00000c0bfcecccc3dae47e13e0a010a01030464360000aa410000aa410000ba410000ba4106000030410812503c000040c00000c0bfcecccc3dae47e13e0a010a01030464360000aa410000aa410000ba410000ba4106000030410812503c000040c00000c0bfcecccc3dae47e13e0a010a01030464360000aa410000aa410000ba410000ba4106000030410812503c000040c00000c0bfcecccc3dae47e13e0a010a01030464360000aa410000aa410000ba410000ba4106000030410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::CarSetups(s) => s,
        _ => panic!("Invalid packet. Expected CarSetups, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2022);

    let expected = PacketCarSetupData {
        header: actual.header.clone(),
        car_setups: vec![
            CarSetupData {
                front_wing: 8,
                rear_wing: 18,
                on_throttle: 80,
                off_throttle: 60,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.44,
                front_suspension: 10,
                rear_suspension: 1,
                front_anti_roll_bar: 10,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 4,
                brake_pressure: 100,
                brake_bias: 54,
                tyres_pressure: WheelData {
                    rear_left: 21.25,
                    rear_right: 21.25,
                    front_left: 23.25,
                    front_right: 23.25,
                },
                ballast: 6,
                fuel_load: 11.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 18,
                on_throttle: 80,
                off_throttle: 60,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.44,
                front_suspension: 10,
                rear_suspension: 1,
                front_anti_roll_bar: 10,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 4,
                brake_pressure: 100,
                brake_bias: 54,
                tyres_pressure: WheelData {
                    rear_left: 21.25,
                    rear_right: 21.25,
                    front_left: 23.25,
                    front_right: 23.25,
                },
                ballast: 6,
                fuel_load: 11.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 18,
                on_throttle: 80,
                off_throttle: 60,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.44,
                front_suspension: 10,
                rear_suspension: 1,
                front_anti_roll_bar: 10,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 4,
                brake_pressure: 100,
                brake_bias: 54,
                tyres_pressure: WheelData {
                    rear_left: 21.25,
                    rear_right: 21.25,
                    front_left: 23.25,
                    front_right: 23.25,
                },
                ballast: 6,
                fuel_load: 11.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 18,
                on_throttle: 80,
                off_throttle: 60,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.44,
                front_suspension: 10,
                rear_suspension: 1,
                front_anti_roll_bar: 10,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 4,
                brake_pressure: 100,
                brake_bias: 54,
                tyres_pressure: WheelData {
                    rear_left: 21.25,
                    rear_right: 21.25,
                    front_left: 23.25,
                    front_right: 23.25,
                },
                ballast: 6,
                fuel_load: 11.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 18,
                on_throttle: 80,
                off_throttle: 60,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.44,
                front_suspension: 10,
                rear_suspension: 1,
                front_anti_roll_bar: 10,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 4,
                brake_pressure: 100,
                brake_bias: 54,
                tyres_pressure: WheelData {
                    rear_left: 21.25,
                    rear_right: 21.25,
                    front_left: 23.25,
                    front_right: 23.25,
                },
                ballast: 6,
                fuel_load: 11.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 18,
                on_throttle: 80,
                off_throttle: 60,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.44,
                front_suspension: 10,
                rear_suspension: 1,
                front_anti_roll_bar: 10,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 4,
                brake_pressure: 100,
                brake_bias: 54,
                tyres_pressure: WheelData {
                    rear_left: 21.25,
                    rear_right: 21.25,
                    front_left: 23.25,
                    front_right: 23.25,
                },
                ballast: 6,
                fuel_load: 11.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 18,
                on_throttle: 80,
                off_throttle: 60,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.44,
                front_suspension: 10,
                rear_suspension: 1,
                front_anti_roll_bar: 10,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 4,
                brake_pressure: 100,
                brake_bias: 54,
                tyres_pressure: WheelData {
                    rear_left: 21.25,
                    rear_right: 21.25,
                    front_left: 23.25,
                    front_right: 23.25,
                },
                ballast: 6,
                fuel_load: 11.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 18,
                on_throttle: 80,
                off_throttle: 60,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.44,
                front_suspension: 10,
                rear_suspension: 1,
                front_anti_roll_bar: 10,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 4,
                brake_pressure: 100,
                brake_bias: 54,
                tyres_pressure: WheelData {
                    rear_left: 21.25,
                    rear_right: 21.25,
                    front_left: 23.25,
                    front_right: 23.25,
                },
                ballast: 6,
                fuel_load: 11.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 18,
                on_throttle: 80,
                off_throttle: 60,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.44,
                front_suspension: 10,
                rear_suspension: 1,
                front_anti_roll_bar: 10,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 4,
                brake_pressure: 100,
                brake_bias: 54,
                tyres_pressure: WheelData {
                    rear_left: 21.25,
                    rear_right: 21.25,
                    front_left: 23.25,
                    front_right: 23.25,
                },
                ballast: 6,
                fuel_load: 11.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 18,
                on_throttle: 80,
                off_throttle: 60,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.44,
                front_suspension: 10,
                rear_suspension: 1,
                front_anti_roll_bar: 10,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 4,
                brake_pressure: 100,
                brake_bias: 54,
                tyres_pressure: WheelData {
                    rear_left: 21.25,
                    rear_right: 21.25,
                    front_left: 23.25,
                    front_right: 23.25,
                },
                ballast: 6,
                fuel_load: 11.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 18,
                on_throttle: 80,
                off_throttle: 60,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.44,
                front_suspension: 10,
                rear_suspension: 1,
                front_anti_roll_bar: 10,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 4,
                brake_pressure: 100,
                brake_bias: 54,
                tyres_pressure: WheelData {
                    rear_left: 21.25,
                    rear_right: 21.25,
                    front_left: 23.25,
                    front_right: 23.25,
                },
                ballast: 6,
                fuel_load: 11.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 18,
                on_throttle: 80,
                off_throttle: 60,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.44,
                front_suspension: 10,
                rear_suspension: 1,
                front_anti_roll_bar: 10,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 4,
                brake_pressure: 100,
                brake_bias: 54,
                tyres_pressure: WheelData {
                    rear_left: 21.25,
                    rear_right: 21.25,
                    front_left: 23.25,
                    front_right: 23.25,
                },
                ballast: 6,
                fuel_load: 11.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 18,
                on_throttle: 80,
                off_throttle: 60,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.44,
                front_suspension: 10,
                rear_suspension: 1,
                front_anti_roll_bar: 10,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 4,
                brake_pressure: 100,
                brake_bias: 54,
                tyres_pressure: WheelData {
                    rear_left: 21.25,
                    rear_right: 21.25,
                    front_left: 23.25,
                    front_right: 23.25,
                },
                ballast: 6,
                fuel_load: 11.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 18,
                on_throttle: 80,
                off_throttle: 60,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.44,
                front_suspension: 10,
                rear_suspension: 1,
                front_anti_roll_bar: 10,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 4,
                brake_pressure: 100,
                brake_bias: 54,
                tyres_pressure: WheelData {
                    rear_left: 21.25,
                    rear_right: 21.25,
                    front_left: 23.25,
                    front_right: 23.25,
                },
                ballast: 6,
                fuel_load: 11.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 18,
                on_throttle: 80,
                off_throttle: 60,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.44,
                front_suspension: 10,
                rear_suspension: 1,
                front_anti_roll_bar: 10,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 4,
                brake_pressure: 100,
                brake_bias: 54,
                tyres_pressure: WheelData {
                    rear_left: 21.25,
                    rear_right: 21.25,
                    front_left: 23.25,
                    front_right: 23.25,
                },
                ballast: 6,
                fuel_load: 11.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 18,
                on_throttle: 80,
                off_throttle: 60,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.44,
                front_suspension: 10,
                rear_suspension: 1,
                front_anti_roll_bar: 10,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 4,
                brake_pressure: 100,
                brake_bias: 54,
                tyres_pressure: WheelData {
                    rear_left: 21.25,
                    rear_right: 21.25,
                    front_left: 23.25,
                    front_right: 23.25,
                },
                ballast: 6,
                fuel_load: 11.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 18,
                on_throttle: 80,
                off_throttle: 60,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.44,
                front_suspension: 10,
                rear_suspension: 1,
                front_anti_roll_bar: 10,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 4,
                brake_pressure: 100,
                brake_bias: 54,
                tyres_pressure: WheelData {
                    rear_left: 21.25,
                    rear_right: 21.25,
                    front_left: 23.25,
                    front_right: 23.25,
                },
                ballast: 6,
                fuel_load: 11.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 18,
                on_throttle: 80,
                off_throttle: 60,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.44,
                front_suspension: 10,
                rear_suspension: 1,
                front_anti_roll_bar: 10,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 4,
                brake_pressure: 100,
                brake_bias: 54,
                tyres_pressure: WheelData {
                    rear_left: 21.25,
                    rear_right: 21.25,
                    front_left: 23.25,
                    front_right: 23.25,
                },
                ballast: 6,
                fuel_load: 11.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 18,
                on_throttle: 80,
                off_throttle: 60,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.44,
                front_suspension: 10,
                rear_suspension: 1,
                front_anti_roll_bar: 10,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 4,
                brake_pressure: 100,
                brake_bias: 54,
                tyres_pressure: WheelData {
                    rear_left: 21.25,
                    rear_right: 21.25,
                    front_left: 23.25,
                    front_right: 23.25,
                },
                ballast: 6,
                fuel_load: 11.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 18,
                on_throttle: 80,
                off_throttle: 60,
                front_camber: -3.0,
                rear_camber: -1.5,
                front_toe: 0.10000001,
                rear_toe: 0.44,
                front_suspension: 10,
                rear_suspension: 1,
                front_anti_roll_bar: 10,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 4,
                brake_pressure: 100,
                brake_bias: 54,
                tyres_pressure: WheelData {
                    rear_left: 21.25,
                    rear_right: 21.25,
                    front_left: 23.25,
                    front_right: 23.25,
                },
                ballast: 6,
                fuel_load: 11.0,
            },
            CarSetupData::default(),
            CarSetupData::default(),
        ],
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2022_car_telemetry_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e60701020106321aca82d6efd8a364291442fb02000013ffb0000000803fe25ebc3b000000000004c32b001800004f034e0342033f0363625f5c5c5c5c5c6e000000a4410000a4410000b4410000b4410100010064006ae0443ea34bd73e0000000000029825000000009a039903d003cf035b5c5c595c5c5c5c6e000000a4410000a4410000b4410000b44100000000ac0039b22c3f63c81e3c000000000004822a00000000510350034703460361615a5b5c5c5c5c6e000000a4410000a4410000b4410000b441010001006800b828ac3e513a7f3e00000000000281280000000091038f03c103bf035d60625c5c5c5c5c6e000000a4410000a4410000b4410000b441000000006500f66f8c3ebfcbe33e0000000000024b270000000096039503c903c8035d615e5b5c5c5c5c6e000000a4410000a4410000b4410000b4410000000001010000803fac464cbd000000000006062f00000000de02dd02890287026566605d5c5c5c5c6e000000a4410000a4410000b4410000b441000000006800fe266d3ebfb5db3e000000000003ff1e0000000098039703d403d3035c5c59585c5c5c5c6e000000a4410000a4410000b4410000b44100000000ef000000803fa739a5bd000000000006fc2b001e0000fe02fd02ae02ae0266665c595c5c5c5c6e000000a4410000a4410000b4410000b44100000000850061ea313f6019f73d000000000003cb29000000007903780390038e036361625d5c5c5c5c6e000000a4410000a4410000b4410000b44100000000a300f085713f7aace43c000000000004282900000000580357034d034c0363635a585c5c5c5c6e000000a4410000a4410000b4410000b441000000006000e2a2073f86393d3e0000000000022d2500000000a403a203df03dd035e5d5e5b5c5c5c5c6e000000a4410000a4410000b4410000b44100000000fc000000803ffa857ebd000000000006472e00000000ed02ec029a0298026462605d5c5c5c5c6e000000a4410000a4410000b4410000b4410000000081003493f43e5e84803e0000000000038627000000007f037e039a0398035f635c5c5c5c5c5c6e000000a4410000a4410000b4410000b441000000006e00ff8e083f1fd3323e000000000002312b0008000087038503b403b203606161605c5c5c5c6e000000a4410000a4410000b4410000b441000000007100bb33143f1ab8353e000000000002f72b001d000094039303c003bf03635f635e5c5c5c5c6e000000a4410000a4410000b4410000b44100000000d8000000803fcc4c38bd000000000005662d0047e00723032203f802f6026466605d5c5c5c5c6e000000a4410000a4410000b4410000b441000000008000ed01193fa18c423e000000000003202700000000810380039f039d035e615f5c5c5c5c5c6e000000a4410000a4410000b4410000b44100000000be000000803fac11b6bc000000000005e428000000004703460329032703605f5f5c5c5c5c5c6e000000a4410000a4410000b4410000b441010001001b010000803f59dcacba000000000007372d0042e0033d023b02cd01cb015e655e5b5c5c5c5c6e000000a4410000a4410000b4410000b441000000000c000000803f0100803f000000000003b210000000005e025f02aa02a202696959555c5c5b5c72000000aa410000aa410000ba410000ba4100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffff00").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::CarTelemetry(s) => s,
        _ => panic!("Invalid packet. Expected CarTelemetry, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2022);

    let expected = PacketCarTelemetryData {
        header: actual.header.clone(),
        car_telemetry_data: vec![
            CarTelemetryData {
                speed: 176,
                throttle: 1.0,
                steer: 0.0057486156,
                brake: 0.0,
                clutch: 0,
                gear: 4,
                engine_rpm: 11203,
                drs: false,
                rev_lights_percent: 24,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 847,
                    rear_right: 846,
                    front_left: 834,
                    front_right: 831,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 99,
                    rear_right: 98,
                    front_left: 95,
                    front_right: 92,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 92,
                    rear_right: 92,
                    front_left: 92,
                    front_right: 92,
                },
                engine_temperature: 110,
                tyre_pressures: WheelData {
                    rear_left: 20.5,
                    rear_right: 20.5,
                    front_left: 22.5,
                    front_right: 22.5,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::RumbleStrip,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::RumbleStrip,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 100,
                throttle: 0.19226232,
                steer: 0.42049894,
                brake: 0.0,
                clutch: 0,
                gear: 2,
                engine_rpm: 9624,
                drs: false,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 922,
                    rear_right: 921,
                    front_left: 976,
                    front_right: 975,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 91,
                    rear_right: 92,
                    front_left: 92,
                    front_right: 89,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 92,
                    rear_right: 92,
                    front_left: 92,
                    front_right: 92,
                },
                engine_temperature: 110,
                tyre_pressures: WheelData {
                    rear_left: 20.5,
                    rear_right: 20.5,
                    front_left: 22.5,
                    front_right: 22.5,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 172,
                throttle: 0.67459446,
                steer: 0.009691331,
                brake: 0.0,
                clutch: 0,
                gear: 4,
                engine_rpm: 10882,
                drs: false,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 849,
                    rear_right: 848,
                    front_left: 839,
                    front_right: 838,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 97,
                    rear_right: 97,
                    front_left: 90,
                    front_right: 91,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 92,
                    rear_right: 92,
                    front_left: 92,
                    front_right: 92,
                },
                engine_temperature: 110,
                tyre_pressures: WheelData {
                    rear_left: 20.5,
                    rear_right: 20.5,
                    front_left: 22.5,
                    front_right: 22.5,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::RumbleStrip,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::RumbleStrip,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 104,
                throttle: 0.33624816,
                steer: 0.2492459,
                brake: 0.0,
                clutch: 0,
                gear: 2,
                engine_rpm: 10369,
                drs: false,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 913,
                    rear_right: 911,
                    front_left: 961,
                    front_right: 959,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 93,
                    rear_right: 96,
                    front_left: 98,
                    front_right: 92,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 92,
                    rear_right: 92,
                    front_left: 92,
                    front_right: 92,
                },
                engine_temperature: 110,
                tyre_pressures: WheelData {
                    rear_left: 20.5,
                    rear_right: 20.5,
                    front_left: 22.5,
                    front_right: 22.5,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 101,
                throttle: 0.2742917,
                steer: 0.44491383,
                brake: 0.0,
                clutch: 0,
                gear: 2,
                engine_rpm: 10059,
                drs: false,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 918,
                    rear_right: 917,
                    front_left: 969,
                    front_right: 968,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 93,
                    rear_right: 97,
                    front_left: 94,
                    front_right: 91,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 92,
                    rear_right: 92,
                    front_left: 92,
                    front_right: 92,
                },
                engine_temperature: 110,
                tyre_pressures: WheelData {
                    rear_left: 20.5,
                    rear_right: 20.5,
                    front_left: 22.5,
                    front_right: 22.5,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 257,
                throttle: 1.0,
                steer: -0.049872085,
                brake: 0.0,
                clutch: 0,
                gear: 6,
                engine_rpm: 12038,
                drs: false,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 734,
                    rear_right: 733,
                    front_left: 649,
                    front_right: 647,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 101,
                    rear_right: 102,
                    front_left: 96,
                    front_right: 93,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 92,
                    rear_right: 92,
                    front_left: 92,
                    front_right: 92,
                },
                engine_temperature: 110,
                tyre_pressures: WheelData {
                    rear_left: 20.5,
                    rear_right: 20.5,
                    front_left: 22.5,
                    front_right: 22.5,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 104,
                throttle: 0.23159406,
                steer: 0.429121,
                brake: 0.0,
                clutch: 0,
                gear: 3,
                engine_rpm: 7935,
                drs: false,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 920,
                    rear_right: 919,
                    front_left: 980,
                    front_right: 979,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 92,
                    rear_right: 92,
                    front_left: 89,
                    front_right: 88,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 92,
                    rear_right: 92,
                    front_left: 92,
                    front_right: 92,
                },
                engine_temperature: 110,
                tyre_pressures: WheelData {
                    rear_left: 20.5,
                    rear_right: 20.5,
                    front_left: 22.5,
                    front_right: 22.5,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 239,
                throttle: 1.0,
                steer: -0.08067637,
                brake: 0.0,
                clutch: 0,
                gear: 6,
                engine_rpm: 11260,
                drs: false,
                rev_lights_percent: 30,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 766,
                    rear_right: 765,
                    front_left: 686,
                    front_right: 686,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 102,
                    rear_right: 102,
                    front_left: 92,
                    front_right: 89,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 92,
                    rear_right: 92,
                    front_left: 92,
                    front_right: 92,
                },
                engine_temperature: 110,
                tyre_pressures: WheelData {
                    rear_left: 20.5,
                    rear_right: 20.5,
                    front_left: 22.5,
                    front_right: 22.5,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 133,
                throttle: 0.6949826,
                steer: 0.12065387,
                brake: 0.0,
                clutch: 0,
                gear: 3,
                engine_rpm: 10699,
                drs: false,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 889,
                    rear_right: 888,
                    front_left: 912,
                    front_right: 910,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 99,
                    rear_right: 97,
                    front_left: 98,
                    front_right: 93,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 92,
                    rear_right: 92,
                    front_left: 92,
                    front_right: 92,
                },
                engine_temperature: 110,
                tyre_pressures: WheelData {
                    rear_left: 20.5,
                    rear_right: 20.5,
                    front_left: 22.5,
                    front_right: 22.5,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 163,
                throttle: 0.94345,
                steer: 0.027914274,
                brake: 0.0,
                clutch: 0,
                gear: 4,
                engine_rpm: 10536,
                drs: false,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 856,
                    rear_right: 855,
                    front_left: 845,
                    front_right: 844,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 99,
                    rear_right: 99,
                    front_left: 90,
                    front_right: 88,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 92,
                    rear_right: 92,
                    front_left: 92,
                    front_right: 92,
                },
                engine_temperature: 110,
                tyre_pressures: WheelData {
                    rear_left: 20.5,
                    rear_right: 20.5,
                    front_left: 22.5,
                    front_right: 22.5,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 96,
                throttle: 0.52982914,
                steer: 0.18478975,
                brake: 0.0,
                clutch: 0,
                gear: 2,
                engine_rpm: 9517,
                drs: false,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 932,
                    rear_right: 930,
                    front_left: 991,
                    front_right: 989,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 94,
                    rear_right: 93,
                    front_left: 94,
                    front_right: 91,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 92,
                    rear_right: 92,
                    front_left: 92,
                    front_right: 92,
                },
                engine_temperature: 110,
                tyre_pressures: WheelData {
                    rear_left: 20.5,
                    rear_right: 20.5,
                    front_left: 22.5,
                    front_right: 22.5,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 252,
                throttle: 1.0,
                steer: -0.06213949,
                brake: 0.0,
                clutch: 0,
                gear: 6,
                engine_rpm: 11847,
                drs: false,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 749,
                    rear_right: 748,
                    front_left: 666,
                    front_right: 664,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 100,
                    rear_right: 98,
                    front_left: 96,
                    front_right: 93,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 92,
                    rear_right: 92,
                    front_left: 92,
                    front_right: 92,
                },
                engine_temperature: 110,
                tyre_pressures: WheelData {
                    rear_left: 20.5,
                    rear_right: 20.5,
                    front_left: 22.5,
                    front_right: 22.5,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 129,
                throttle: 0.47768557,
                steer: 0.25100988,
                brake: 0.0,
                clutch: 0,
                gear: 3,
                engine_rpm: 10118,
                drs: false,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 895,
                    rear_right: 894,
                    front_left: 922,
                    front_right: 920,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 95,
                    rear_right: 99,
                    front_left: 92,
                    front_right: 92,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 92,
                    rear_right: 92,
                    front_left: 92,
                    front_right: 92,
                },
                engine_temperature: 110,
                tyre_pressures: WheelData {
                    rear_left: 20.5,
                    rear_right: 20.5,
                    front_left: 22.5,
                    front_right: 22.5,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 110,
                throttle: 0.53343195,
                steer: 0.17463349,
                brake: 0.0,
                clutch: 0,
                gear: 2,
                engine_rpm: 11057,
                drs: false,
                rev_lights_percent: 8,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 903,
                    rear_right: 901,
                    front_left: 948,
                    front_right: 946,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 96,
                    rear_right: 97,
                    front_left: 97,
                    front_right: 96,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 92,
                    rear_right: 92,
                    front_left: 92,
                    front_right: 92,
                },
                engine_temperature: 110,
                tyre_pressures: WheelData {
                    rear_left: 20.5,
                    rear_right: 20.5,
                    front_left: 22.5,
                    front_right: 22.5,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 113,
                throttle: 0.57891434,
                steer: 0.1774601,
                brake: 0.0,
                clutch: 0,
                gear: 2,
                engine_rpm: 11255,
                drs: false,
                rev_lights_percent: 29,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 916,
                    rear_right: 915,
                    front_left: 960,
                    front_right: 959,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 99,
                    rear_right: 95,
                    front_left: 99,
                    front_right: 94,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 92,
                    rear_right: 92,
                    front_left: 92,
                    front_right: 92,
                },
                engine_temperature: 110,
                tyre_pressures: WheelData {
                    rear_left: 20.5,
                    rear_right: 20.5,
                    front_left: 22.5,
                    front_right: 22.5,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 216,
                throttle: 1.0,
                steer: -0.044995114,
                brake: 0.0,
                clutch: 0,
                gear: 5,
                engine_rpm: 11622,
                drs: false,
                rev_lights_percent: 71,
                rev_lights_bit_value: Some(2016),
                brakes_temperature: WheelData {
                    rear_left: 803,
                    rear_right: 802,
                    front_left: 760,
                    front_right: 758,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 100,
                    rear_right: 102,
                    front_left: 96,
                    front_right: 93,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 92,
                    rear_right: 92,
                    front_left: 92,
                    front_right: 92,
                },
                engine_temperature: 110,
                tyre_pressures: WheelData {
                    rear_left: 20.5,
                    rear_right: 20.5,
                    front_left: 22.5,
                    front_right: 22.5,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 128,
                throttle: 0.59768564,
                steer: 0.18998958,
                brake: 0.0,
                clutch: 0,
                gear: 3,
                engine_rpm: 10016,
                drs: false,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 897,
                    rear_right: 896,
                    front_left: 927,
                    front_right: 925,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 94,
                    rear_right: 97,
                    front_left: 95,
                    front_right: 92,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 92,
                    rear_right: 92,
                    front_left: 92,
                    front_right: 92,
                },
                engine_temperature: 110,
                tyre_pressures: WheelData {
                    rear_left: 20.5,
                    rear_right: 20.5,
                    front_left: 22.5,
                    front_right: 22.5,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 190,
                throttle: 1.0,
                steer: -0.022225223,
                brake: 0.0,
                clutch: 0,
                gear: 5,
                engine_rpm: 10468,
                drs: false,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 839,
                    rear_right: 838,
                    front_left: 809,
                    front_right: 807,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 96,
                    rear_right: 95,
                    front_left: 95,
                    front_right: 92,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 92,
                    rear_right: 92,
                    front_left: 92,
                    front_right: 92,
                },
                engine_temperature: 110,
                tyre_pressures: WheelData {
                    rear_left: 20.5,
                    rear_right: 20.5,
                    front_left: 22.5,
                    front_right: 22.5,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::RumbleStrip,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::RumbleStrip,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 283,
                throttle: 1.0,
                steer: -0.0013188227,
                brake: 0.0,
                clutch: 0,
                gear: 7,
                engine_rpm: 11575,
                drs: false,
                rev_lights_percent: 66,
                rev_lights_bit_value: Some(992),
                brakes_temperature: WheelData {
                    rear_left: 573,
                    rear_right: 571,
                    front_left: 461,
                    front_right: 459,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 94,
                    rear_right: 101,
                    front_left: 94,
                    front_right: 91,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 92,
                    rear_right: 92,
                    front_left: 92,
                    front_right: 92,
                },
                engine_temperature: 110,
                tyre_pressures: WheelData {
                    rear_left: 20.5,
                    rear_right: 20.5,
                    front_left: 22.5,
                    front_right: 22.5,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 12,
                throttle: 1.0,
                steer: 1.0000001,
                brake: 0.0,
                clutch: 0,
                gear: 3,
                engine_rpm: 4274,
                drs: false,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 606,
                    rear_right: 607,
                    front_left: 682,
                    front_right: 674,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 105,
                    rear_right: 105,
                    front_left: 89,
                    front_right: 85,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 92,
                    rear_right: 92,
                    front_left: 91,
                    front_right: 92,
                },
                engine_temperature: 114,
                tyre_pressures: WheelData {
                    rear_left: 21.25,
                    rear_right: 21.25,
                    front_left: 23.25,
                    front_right: 23.25,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 0,
                throttle: 0.0,
                steer: 0.0,
                brake: 0.0,
                clutch: 0,
                gear: 0,
                engine_rpm: 0,
                drs: false,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                engine_temperature: 0,
                tyre_pressures: WheelData {
                    rear_left: 0.0,
                    rear_right: 0.0,
                    front_left: 0.0,
                    front_right: 0.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 0,
                throttle: 0.0,
                steer: 0.0,
                brake: 0.0,
                clutch: 0,
                gear: 0,
                engine_rpm: 0,
                drs: false,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                engine_temperature: 0,
                tyre_pressures: WheelData {
                    rear_left: 0.0,
                    rear_right: 0.0,
                    front_left: 0.0,
                    front_right: 0.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
        ],
        button_status: None,
        mfd_panel: MFDPanel::Closed,
        secondary_player_mfd_panel: MFDPanel::Closed,
        suggested_gear: Some(0),
    };

    assert_eq!(actual, expected)
}

#[tokio::test]
async fn test_parse_2022_car_status_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e60701020107321aca82d6efd8a364291442fb02000013ff0001013600c05730410000dc427400b03fc832ab0d090000001210000045b14e4a019ac4f3478467b848c8348849000001013600045037410000dc42e45dcc3fc832ab0d09000000121000002d4f494a011867f34799efb648ff909249000001013600db132d410000dc420c44a13fc832ab0d09000000121000005d54494a011879f9478510bb48aa069349000001013600a4162b410000dc42806a963fc832ab0d09000000121000009f004b4a016cc80848a787b24876f38f49000001013600328f2f410000dc428418aa3fc832ab0d090000001210000062c0554a01ab1cf0472527bb48c209754900000101360094d336410000dc422476d03fc832ab0d0900000012100000de6d2d4a0332ca0b485b019e48bb54c6490000010136004a8138410000dc420c4fd13fc832ab0d09000000121000008223474a010c6bef474310af48deab944900000101360074b231410000dc42f8a0b83fc832ab0d0900000012100000de50354a0361c2f047dd6aa84843bbb649000001013600177831410000dc42ecd7b33fc832ab0d0900000012100000df5d4b4a01b7df0d483371b5488d949049000001013600d3292d410000dc426864a13fc832ab0d0900000012100000078d484a01db0df6477fd2bb48927c95490000010136000a0639410000dc42c443d43fc832ab0d090000001210000044e64b4a0107b116486a55b548ae9e9049000001013600866b30410000dc42bc7bb33fc832ab0d0900000012100000c668314a0348f00148ee549b488777bc49000001013600863335410000dc42b037c43fc832ab0d09000000121000000534504a011fb4114870c4bc481a958849000001013600221538410000dc426075d03fc832ab0d090000001210000023cb4b4a01104b0948c002b748a6938f49000001013600be9736410000dc42c0e0c93fc832ab0d0900000012100000d70a454a01d2691548c063c348d0a5a1490000010136002b3f2e410000dc4250faa73fc832ab0d0900000012100000ed683c4a033d1217481d50ad48fb9fad4900000101360062d230410000dc425499b03fc832ab0d0900000012100000947c484a0198140d48933fb748d2b196490000010136001f8c34410000dc42f830c33fc832ab0d09000000121000004605454a03a60412488698b44811989d49000001013600e73b31410000dc42ccada93fc832ab0d09000000121000015aa1674a03b7e283472f795f48d723f448000101013600854f2d410000dc424c748d3fc832ab0d090000001210000324b76d4a01d1e32e477cd6c54758c26d480000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::CarStatus(s) => s,
        _ => panic!("Invalid packet. Expected CarStatus, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2022);

    let expected = PacketCarStatusData {
        header: actual.header.clone(),
        car_status_data: vec![
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 54,
                pit_limiter: false,
                fuel_in_tank: 11.021423,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.3750138,
                max_rpm: 13000,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                engine_power_ice: None,
                engine_power_mguk: None,
                ers_store_energy: 3386449.3,
                ers_deploy_mode: ERSDeployMode::Medium,
                ers_harvested_this_lap_mguk: 124809.2,
                ers_harvested_this_lap_mguh: 377660.13,
                ers_deployed_this_lap: 1115801.0,
                network_paused: false,
                tyres_wear: None,
                tyres_damage: None,
                front_left_wing_damage: None,
                front_right_wing_damage: None,
                rear_wing_damage: None,
                drs_fault: None,
                engine_damage: None,
                gear_box_damage: None,
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 54,
                pit_limiter: false,
                fuel_in_tank: 11.457035,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.5966153,
                max_rpm: 13000,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                engine_power_ice: None,
                engine_power_mguk: None,
                ers_store_energy: 3298251.3,
                ers_deploy_mode: ERSDeployMode::Medium,
                ers_harvested_this_lap_mguk: 124622.19,
                ers_harvested_this_lap_mguh: 374652.78,
                ers_deployed_this_lap: 1200671.9,
                network_paused: false,
                tyres_wear: None,
                tyres_damage: None,
                front_left_wing_damage: None,
                front_right_wing_damage: None,
                rear_wing_damage: None,
                drs_fault: None,
                engine_damage: None,
                gear_box_damage: None,
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 54,
                pit_limiter: false,
                fuel_in_tank: 10.817348,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.2598891,
                max_rpm: 13000,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                engine_power_ice: None,
                engine_power_mguk: None,
                ers_store_energy: 3298583.3,
                ers_deploy_mode: ERSDeployMode::Medium,
                ers_harvested_this_lap_mguk: 127730.19,
                ers_harvested_this_lap_mguh: 383108.16,
                ers_deployed_this_lap: 1204437.3,
                network_paused: false,
                tyres_wear: None,
                tyres_damage: None,
                front_left_wing_damage: None,
                front_right_wing_damage: None,
                rear_wing_damage: None,
                drs_fault: None,
                engine_damage: None,
                gear_box_damage: None,
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 54,
                pit_limiter: false,
                fuel_in_tank: 10.6930275,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.1751251,
                max_rpm: 13000,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                engine_power_ice: None,
                engine_power_mguk: None,
                ers_store_energy: 3325991.8,
                ers_deploy_mode: ERSDeployMode::Medium,
                ers_harvested_this_lap_mguk: 140065.69,
                ers_harvested_this_lap_mguh: 365629.22,
                ers_deployed_this_lap: 1179246.8,
                network_paused: false,
                tyres_wear: None,
                tyres_damage: None,
                front_left_wing_damage: None,
                front_right_wing_damage: None,
                rear_wing_damage: None,
                drs_fault: None,
                engine_damage: None,
                gear_box_damage: None,
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 54,
                pit_limiter: false,
                fuel_in_tank: 10.97246,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.3288732,
                max_rpm: 13000,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                engine_power_ice: None,
                engine_power_mguk: None,
                ers_store_energy: 3502104.5,
                ers_deploy_mode: ERSDeployMode::Medium,
                ers_harvested_this_lap_mguk: 122937.336,
                ers_harvested_this_lap_mguh: 383289.16,
                ers_deployed_this_lap: 1003676.1,
                network_paused: false,
                tyres_wear: None,
                tyres_damage: None,
                front_left_wing_damage: None,
                front_right_wing_damage: None,
                rear_wing_damage: None,
                drs_fault: None,
                engine_damage: None,
                gear_box_damage: None,
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 54,
                pit_limiter: false,
                fuel_in_tank: 11.426655,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.6286054,
                max_rpm: 13000,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                engine_power_ice: None,
                engine_power_mguk: None,
                ers_store_energy: 2841463.5,
                ers_deploy_mode: ERSDeployMode::Overtake,
                ers_harvested_this_lap_mguk: 143144.78,
                ers_harvested_this_lap_mguh: 323594.84,
                ers_deployed_this_lap: 1624727.4,
                network_paused: false,
                tyres_wear: None,
                tyres_damage: None,
                front_left_wing_damage: None,
                front_right_wing_damage: None,
                rear_wing_damage: None,
                drs_fault: None,
                engine_damage: None,
                gear_box_damage: None,
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 54,
                pit_limiter: false,
                fuel_in_tank: 11.531565,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.6352248,
                max_rpm: 13000,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                engine_power_ice: None,
                engine_power_mguk: None,
                ers_store_energy: 3262688.5,
                ers_deploy_mode: ERSDeployMode::Medium,
                ers_harvested_this_lap_mguk: 122582.09,
                ers_harvested_this_lap_mguh: 358530.1,
                ers_deployed_this_lap: 1217915.8,
                network_paused: false,
                tyres_wear: None,
                tyres_damage: None,
                front_left_wing_damage: None,
                front_right_wing_damage: None,
                rear_wing_damage: None,
                drs_fault: None,
                engine_damage: None,
                gear_box_damage: None,
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 54,
                pit_limiter: false,
                fuel_in_tank: 11.106068,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.4424124,
                max_rpm: 13000,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                engine_power_ice: None,
                engine_power_mguk: None,
                ers_store_energy: 2970679.5,
                ers_deploy_mode: ERSDeployMode::Overtake,
                ers_harvested_this_lap_mguk: 123268.76,
                ers_harvested_this_lap_mguh: 344918.9,
                ers_deployed_this_lap: 1496936.4,
                network_paused: false,
                tyres_wear: None,
                tyres_damage: None,
                front_left_wing_damage: None,
                front_right_wing_damage: None,
                rear_wing_damage: None,
                drs_fault: None,
                engine_damage: None,
                gear_box_damage: None,
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 54,
                pit_limiter: false,
                fuel_in_tank: 11.091819,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.4050269,
                max_rpm: 13000,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                engine_power_ice: None,
                engine_power_mguk: None,
                ers_store_energy: 3331959.8,
                ers_deploy_mode: ERSDeployMode::Medium,
                ers_harvested_this_lap_mguk: 145278.86,
                ers_harvested_this_lap_mguh: 371593.6,
                ers_deployed_this_lap: 1184401.6,
                network_paused: false,
                tyres_wear: None,
                tyres_damage: None,
                front_left_wing_damage: None,
                front_right_wing_damage: None,
                rear_wing_damage: None,
                drs_fault: None,
                engine_damage: None,
                gear_box_damage: None,
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 54,
                pit_limiter: false,
                fuel_in_tank: 10.822711,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.2608767,
                max_rpm: 13000,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                engine_power_ice: None,
                engine_power_mguk: None,
                ers_store_energy: 3285825.8,
                ers_deploy_mode: ERSDeployMode::Medium,
                ers_harvested_this_lap_mguk: 125979.71,
                ers_harvested_this_lap_mguh: 384659.97,
                ers_deployed_this_lap: 1224594.3,
                network_paused: false,
                tyres_wear: None,
                tyres_damage: None,
                front_left_wing_damage: None,
                front_right_wing_damage: None,
                rear_wing_damage: None,
                drs_fault: None,
                engine_damage: None,
                gear_box_damage: None,
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 54,
                pit_limiter: false,
                fuel_in_tank: 11.563974,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.658318,
                max_rpm: 13000,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                engine_power_ice: None,
                engine_power_mguk: None,
                ers_store_energy: 3340689.0,
                ers_deploy_mode: ERSDeployMode::Medium,
                ers_harvested_this_lap_mguk: 154308.11,
                ers_harvested_this_lap_mguh: 371371.3,
                ers_deployed_this_lap: 1184725.8,
                network_paused: false,
                tyres_wear: None,
                tyres_damage: None,
                front_left_wing_damage: None,
                front_right_wing_damage: None,
                rear_wing_damage: None,
                drs_fault: None,
                engine_damage: None,
                gear_box_damage: None,
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 54,
                pit_limiter: false,
                fuel_in_tank: 11.026251,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.4022136,
                max_rpm: 13000,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                engine_power_ice: None,
                engine_power_mguk: None,
                ers_store_energy: 2906673.5,
                ers_deploy_mode: ERSDeployMode::Overtake,
                ers_harvested_this_lap_mguk: 133057.13,
                ers_harvested_this_lap_mguh: 318119.44,
                ers_deployed_this_lap: 1543920.9,
                network_paused: false,
                tyres_wear: None,
                tyres_damage: None,
                front_left_wing_damage: None,
                front_right_wing_damage: None,
                rear_wing_damage: None,
                drs_fault: None,
                engine_damage: None,
                gear_box_damage: None,
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 54,
                pit_limiter: false,
                fuel_in_tank: 11.325079,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.5329494,
                max_rpm: 13000,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                engine_power_ice: None,
                engine_power_mguk: None,
                ers_store_energy: 3411201.3,
                ers_deploy_mode: ERSDeployMode::Medium,
                ers_harvested_this_lap_mguk: 149200.48,
                ers_harvested_this_lap_mguh: 386595.5,
                ers_deployed_this_lap: 1118883.3,
                network_paused: false,
                tyres_wear: None,
                tyres_damage: None,
                front_left_wing_damage: None,
                front_right_wing_damage: None,
                rear_wing_damage: None,
                drs_fault: None,
                engine_damage: None,
                gear_box_damage: None,
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 54,
                pit_limiter: false,
                fuel_in_tank: 11.505159,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.628582,
                max_rpm: 13000,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                engine_power_ice: None,
                engine_power_mguk: None,
                ers_store_energy: 3338952.8,
                ers_deploy_mode: ERSDeployMode::Medium,
                ers_harvested_this_lap_mguk: 140588.25,
                ers_harvested_this_lap_mguh: 374806.0,
                ers_deployed_this_lap: 1176180.8,
                network_paused: false,
                tyres_wear: None,
                tyres_damage: None,
                front_left_wing_damage: None,
                front_right_wing_damage: None,
                rear_wing_damage: None,
                drs_fault: None,
                engine_damage: None,
                gear_box_damage: None,
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 54,
                pit_limiter: false,
                fuel_in_tank: 11.412046,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.5771713,
                max_rpm: 13000,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                engine_power_ice: None,
                engine_power_mguk: None,
                ers_store_energy: 3228341.8,
                ers_deploy_mode: ERSDeployMode::Medium,
                ers_harvested_this_lap_mguk: 152999.28,
                ers_harvested_this_lap_mguh: 400158.0,
                ers_deployed_this_lap: 1324218.0,
                network_paused: false,
                tyres_wear: None,
                tyres_damage: None,
                front_left_wing_damage: None,
                front_right_wing_damage: None,
                rear_wing_damage: None,
                drs_fault: None,
                engine_damage: None,
                gear_box_damage: None,
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 54,
                pit_limiter: false,
                fuel_in_tank: 10.890422,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.3123264,
                max_rpm: 13000,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                engine_power_ice: None,
                engine_power_mguk: None,
                ers_store_energy: 3086907.3,
                ers_deploy_mode: ERSDeployMode::Overtake,
                ers_harvested_this_lap_mguk: 154696.95,
                ers_harvested_this_lap_mguh: 354944.9,
                ers_deployed_this_lap: 1422335.4,
                network_paused: false,
                tyres_wear: None,
                tyres_damage: None,
                front_left_wing_damage: None,
                front_right_wing_damage: None,
                rear_wing_damage: None,
                drs_fault: None,
                engine_damage: None,
                gear_box_damage: None,
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 54,
                pit_limiter: false,
                fuel_in_tank: 11.051363,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.3796792,
                max_rpm: 13000,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                engine_power_ice: None,
                engine_power_mguk: None,
                ers_store_energy: 3284773.0,
                ers_deploy_mode: ERSDeployMode::Medium,
                ers_harvested_this_lap_mguk: 144466.38,
                ers_harvested_this_lap_mguh: 375292.6,
                ers_deployed_this_lap: 1234490.3,
                network_paused: false,
                tyres_wear: None,
                tyres_damage: None,
                front_left_wing_damage: None,
                front_right_wing_damage: None,
                rear_wing_damage: None,
                drs_fault: None,
                engine_damage: None,
                gear_box_damage: None,
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 54,
                pit_limiter: false,
                fuel_in_tank: 11.284209,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.5249319,
                max_rpm: 13000,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                engine_power_ice: None,
                engine_power_mguk: None,
                ers_store_energy: 3227985.5,
                ers_deploy_mode: ERSDeployMode::Overtake,
                ers_harvested_this_lap_mguk: 149522.6,
                ers_harvested_this_lap_mguh: 369860.2,
                ers_deployed_this_lap: 1291010.1,
                network_paused: false,
                tyres_wear: None,
                tyres_damage: None,
                front_left_wing_damage: None,
                front_right_wing_damage: None,
                rear_wing_damage: None,
                drs_fault: None,
                engine_damage: None,
                gear_box_damage: None,
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 54,
                pit_limiter: false,
                fuel_in_tank: 11.077125,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.3256164,
                max_rpm: 13000,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::Green,
                engine_power_ice: None,
                engine_power_mguk: None,
                ers_store_energy: 3795030.5,
                ers_deploy_mode: ERSDeployMode::Overtake,
                ers_harvested_this_lap_mguk: 67525.43,
                ers_harvested_this_lap_mguh: 228836.73,
                ers_deployed_this_lap: 499998.72,
                network_paused: false,
                tyres_wear: None,
                tyres_damage: None,
                front_left_wing_damage: None,
                front_right_wing_damage: None,
                rear_wing_damage: None,
                drs_fault: None,
                engine_damage: None,
                gear_box_damage: None,
            },
            CarStatusData {
                traction_control: TractionControl::Low,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 54,
                pit_limiter: false,
                fuel_in_tank: 10.831914,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 1.1051116,
                max_rpm: 13000,
                idle_rpm: 3499,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C3,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::Yellow,
                engine_power_ice: None,
                engine_power_mguk: None,
                ers_store_energy: 3894729.0,
                ers_deploy_mode: ERSDeployMode::Medium,
                ers_harvested_this_lap_mguk: 44771.816,
                ers_harvested_this_lap_mguh: 101292.97,
                ers_deployed_this_lap: 243465.38,
                network_paused: false,
                tyres_wear: None,
                tyres_damage: None,
                front_left_wing_damage: None,
                front_right_wing_damage: None,
                rear_wing_damage: None,
                drs_fault: None,
                engine_damage: None,
                gear_box_damage: None,
            },
            CarStatusData {
                fuel_mix: FuelMix::Lean,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ..Default::default()
            },
            CarStatusData {
                fuel_mix: FuelMix::Lean,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ..Default::default()
            },
        ],
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2022_final_classification_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e60701020108321aca82d6efd8a3000000000000000013ff14070509060003ab680100000000c0f3e07d4000000112000000000000001000000000000000ff000000000000001205130000030f6b01000000006029c07e4000000112000000000000001000000000000000ff000000000000000405050d00034964010000000080e7597d4000000112000000000000001000000000000000ff00000000000000100512000003e16a0100000000607c9e7e4000000112000000000000001000000000000000ff000000000000000f050f000003f56a010000000040b9817e4000000112000000000000001000000000000000ff000000000000000105011900034f6501000000008044c77c4000000112000000000000001000000000000000ff00000000000000110514000003596901000000000023ae7e4000000112000000000000001000000000000000ff000000000000000305060f000334650100000000006f527d4000000112000000000000001000000000000000ff000000000000000e0510000003196b0100000000401f717e4000000112000000000000001000000000000000ff0000000000000009050a020003166901000000000096f47d4000000112000000000000001000000000000000ff00000000000000130511000003466d0100000000c063c17e4000000112000000000000001000000000000000ff00000000000000020503120003806501000000000016337d4000000112000000000000001000000000000000ff000000000000000b0508000003466b010000000020d91c7e4000000112000000000000001000000000000000ff000000000000000d050e0000039c69010000000060af5b7e4000000112000000000000001000000000000000ff000000000000000c050d0000038168010000000020452f7e4000000112000000000000001000000000000000ff0000000000000005050c0a000377660100000000e029bd7d4000000112000000000000001000000000000000ff000000000000000a050b0100032b67010000000000f3f57d4000000112000000000000001000000000000000ff00000000000000060507080003cf690100000000c036d27d4000000112000000000000001000000000000000ff00000000000000080504040003766401000000004097e57d4000000112000000000000001000000000000000ff0000000000000014000200000400000000000000000000000002010112000000000000001000000000000000ff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::FinalClassification(s) => s,
        _ => panic!("Invalid packet. Expected LobbyInfo, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2022);

    let expected = PacketFinalClassificationData {
        header: actual.header.clone(),
        num_cars: 20,
        final_classifications: vec![
            FinalClassification {
                position: 7,
                num_laps: 5,
                grid_position: 9,
                points: 6,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 92331,
                total_race_time: 478059,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C3,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                tyre_stints_end_lap: vec![255, 0, 0, 0, 0, 0, 0, 0],
            },
            FinalClassification {
                position: 18,
                num_laps: 5,
                grid_position: 19,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 92943,
                total_race_time: 492010,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C3,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                tyre_stints_end_lap: vec![255, 0, 0, 0, 0, 0, 0, 0],
            },
            FinalClassification {
                position: 4,
                num_laps: 5,
                grid_position: 5,
                points: 13,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 91209,
                total_race_time: 469619,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C3,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                tyre_stints_end_lap: vec![255, 0, 0, 0, 0, 0, 0, 0],
            },
            FinalClassification {
                position: 16,
                num_laps: 5,
                grid_position: 18,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 92897,
                total_race_time: 489905,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C3,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                tyre_stints_end_lap: vec![255, 0, 0, 0, 0, 0, 0, 0],
            },
            FinalClassification {
                position: 15,
                num_laps: 5,
                grid_position: 15,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 92917,
                total_race_time: 488107,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C3,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                tyre_stints_end_lap: vec![255, 0, 0, 0, 0, 0, 0, 0],
            },
            FinalClassification {
                position: 1,
                num_laps: 5,
                grid_position: 1,
                points: 25,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 91471,
                total_race_time: 460454,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C3,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                tyre_stints_end_lap: vec![255, 0, 0, 0, 0, 0, 0, 0],
            },
            FinalClassification {
                position: 17,
                num_laps: 5,
                grid_position: 20,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 92505,
                total_race_time: 490883,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C3,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                tyre_stints_end_lap: vec![255, 0, 0, 0, 0, 0, 0, 0],
            },
            FinalClassification {
                position: 3,
                num_laps: 5,
                grid_position: 6,
                points: 15,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 91444,
                total_race_time: 469152,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C3,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                tyre_stints_end_lap: vec![255, 0, 0, 0, 0, 0, 0, 0],
            },
            FinalClassification {
                position: 14,
                num_laps: 5,
                grid_position: 16,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 92953,
                total_race_time: 487070,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C3,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                tyre_stints_end_lap: vec![255, 0, 0, 0, 0, 0, 0, 0],
            },
            FinalClassification {
                position: 9,
                num_laps: 5,
                grid_position: 10,
                points: 2,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 92438,
                total_race_time: 479286,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C3,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                tyre_stints_end_lap: vec![255, 0, 0, 0, 0, 0, 0, 0],
            },
            FinalClassification {
                position: 19,
                num_laps: 5,
                grid_position: 17,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 93510,
                total_race_time: 492086,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C3,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                tyre_stints_end_lap: vec![255, 0, 0, 0, 0, 0, 0, 0],
            },
            FinalClassification {
                position: 2,
                num_laps: 5,
                grid_position: 3,
                points: 18,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 91520,
                total_race_time: 467192,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C3,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                tyre_stints_end_lap: vec![255, 0, 0, 0, 0, 0, 0, 0],
            },
            FinalClassification {
                position: 11,
                num_laps: 5,
                grid_position: 8,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 92998,
                total_race_time: 481803,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C3,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                tyre_stints_end_lap: vec![255, 0, 0, 0, 0, 0, 0, 0],
            },
            FinalClassification {
                position: 13,
                num_laps: 5,
                grid_position: 14,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 92572,
                total_race_time: 485730,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C3,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                tyre_stints_end_lap: vec![255, 0, 0, 0, 0, 0, 0, 0],
            },
            FinalClassification {
                position: 12,
                num_laps: 5,
                grid_position: 13,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 92289,
                total_race_time: 482954,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C3,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                tyre_stints_end_lap: vec![255, 0, 0, 0, 0, 0, 0, 0],
            },
            FinalClassification {
                position: 5,
                num_laps: 5,
                grid_position: 12,
                points: 10,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 91767,
                total_race_time: 475822,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C3,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                tyre_stints_end_lap: vec![255, 0, 0, 0, 0, 0, 0, 0],
            },
            FinalClassification {
                position: 10,
                num_laps: 5,
                grid_position: 11,
                points: 1,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 91947,
                total_race_time: 479371,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C3,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                tyre_stints_end_lap: vec![255, 0, 0, 0, 0, 0, 0, 0],
            },
            FinalClassification {
                position: 6,
                num_laps: 5,
                grid_position: 7,
                points: 8,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 92623,
                total_race_time: 477138,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C3,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                tyre_stints_end_lap: vec![255, 0, 0, 0, 0, 0, 0, 0],
            },
            FinalClassification {
                position: 8,
                num_laps: 5,
                grid_position: 4,
                points: 4,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 91254,
                total_race_time: 478349,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C3,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                tyre_stints_end_lap: vec![255, 0, 0, 0, 0, 0, 0, 0],
            },
            FinalClassification {
                position: 20,
                num_laps: 0,
                grid_position: 2,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::DidNotFinish,
                best_lap_time: 0,
                total_race_time: 0,
                penalties_time: 2,
                num_penalties: 1,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C3,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                tyre_stints_end_lap: vec![255, 0, 0, 0, 0, 0, 0, 0],
            },
            FinalClassification {
                tyre_stints_actual: [TyreCompound::Invalid; 8].to_vec(),
                tyre_stints_visual: [TyreCompoundVisual::Invalid; 8].to_vec(),
                tyre_stints_end_lap: [0; 8].to_vec(),
                ..Default::default()
            },
            FinalClassification {
                tyre_stints_actual: [TyreCompound::Invalid; 8].to_vec(),
                tyre_stints_visual: [TyreCompoundVisual::Invalid; 8].to_vec(),
                tyre_stints_end_lap: [0; 8].to_vec(),
                ..Default::default()
            },
        ],
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2022_lobby_info_packet() {
    let stream = utils::get_stream().await;

    // TODO: Validate with real packet from F1 2022
    utils::send_raw_data(&stream, "e607011201090000000000000000000000000000000000001401680a4172726f6e204241524e4553000000000000000000000000000000000000000000000000000000000000000000000000470001680a4d617274696e2047494c4553000000000000000000000000000000000000000000000000000000000000000000000000460001680a416c6578204d55525241590000000000000000000000000000000000000000000000000000000000000000000000000028000168044c7563617320524f544800000000000000000000000000000000000000000000000000000000000000000000000000005f0001680949676f7220434f52524549410000000000000000000000000000000000000000000000000000000000000000000000004f0001681c536f70686965204c4556415353455552000000000000000000000000000000000000000000000000000000000000000035000168044a6f6e6173205343484946464552000000000000000000000000000000000000000000000000000000000000000000004c0001681c416c61696e20464f52455354000000000000000000000000000000000000000000000000000000000000000000000000500001680d4a6179204c45544f55524e45415500000000000000000000000000000000000000000000000000000000000000000000440001681b4573746f20534141524900000000000000000000000000000000000000000000000000000000000000000000000000001c000168065961736172204154495945480000000000000000000000000000000000000000000000000000000000000000000000002d0001682b4e616f746120495a554d49000000000000000000000000000000000000000000000000000000000000000000000000002a0001681d57696c68656c6d204b4155464d414e4e00000000000000000000000000000000000000000000000000000000000000002f000168154d61726965204c41555253454e0000000000000000000000000000000000000000000000000000000000000000000000410001684d466c6176696f204e49455645530000000000000000000000000000000000000000000000000000000000000000000000240001684350657465722042454c4f55534f5600000000000000000000000000000000000000000000000000000000000000000000570001683f4b6c696d656b204d494348414c534b490000000000000000000000000000000000000000000000000000000000000000200001681053616e746961676f204d4f52454e4f0000000000000000000000000000000000000000000000000000000000000000003c0001680742656e6a616d696e20434f5050454e530000000000000000000000000000000000000000000000000000000000000000360000ff0d506c617965720000000000000000000000000000000000000000000000000000000000000000000000000000000000002a0000ff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::LobbyInfo(s) => s,
        _ => panic!("Invalid packet. Expected LobbyInfo, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2022);

    let expected = PacketLobbyInfoData {
        header: actual.header.clone(),
        num_players: 20,
        players: vec![
            Player {
                ai_controlled: true,
                team: Team::F1CustomTeam,
                nationality: Nationality::British,
                name: "Arron BARNES".to_string(),
                car_number: Some(71),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1CustomTeam,
                nationality: Nationality::British,
                name: "Martin GILES".to_string(),
                car_number: Some(70),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1CustomTeam,
                nationality: Nationality::British,
                name: "Alex MURRAY".to_string(),
                car_number: Some(40),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1CustomTeam,
                nationality: Nationality::Austrian,
                name: "Lucas ROTH".to_string(),
                car_number: Some(95),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1CustomTeam,
                nationality: Nationality::Brazilian,
                name: "Igor CORREIA".to_string(),
                car_number: Some(79),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1CustomTeam,
                nationality: Nationality::French,
                name: "Sophie LEVASSEUR".to_string(),
                car_number: Some(53),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1CustomTeam,
                nationality: Nationality::Austrian,
                name: "Jonas SCHIFFER".to_string(),
                car_number: Some(76),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1CustomTeam,
                nationality: Nationality::French,
                name: "Alain FOREST".to_string(),
                car_number: Some(80),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1CustomTeam,
                nationality: Nationality::Canadian,
                name: "Jay LETOURNEAU".to_string(),
                car_number: Some(68),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1CustomTeam,
                nationality: Nationality::Finnish,
                name: "Esto SAARI".to_string(),
                car_number: Some(28),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1CustomTeam,
                nationality: Nationality::Bahraini,
                name: "Yasar ATIYEH".to_string(),
                car_number: Some(45),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1CustomTeam,
                nationality: Nationality::Japanese,
                name: "Naota IZUMI".to_string(),
                car_number: Some(42),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1CustomTeam,
                nationality: Nationality::German,
                name: "Wilhelm KAUFMANN".to_string(),
                car_number: Some(47),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1CustomTeam,
                nationality: Nationality::Danish,
                name: "Marie LAURSEN".to_string(),
                car_number: Some(65),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1CustomTeam,
                nationality: Nationality::Spanish,
                name: "Flavio NIEVES".to_string(),
                car_number: Some(36),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1CustomTeam,
                nationality: Nationality::Russian,
                name: "Peter BELOUSOV".to_string(),
                car_number: Some(87),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1CustomTeam,
                nationality: Nationality::Polish,
                name: "Klimek MICHALSKI".to_string(),
                car_number: Some(32),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1CustomTeam,
                nationality: Nationality::Colombian,
                name: "Santiago MORENO".to_string(),
                car_number: Some(60),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1CustomTeam,
                nationality: Nationality::Belgian,
                name: "Benjamin COPPENS".to_string(),
                car_number: Some(54),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: false,
                team: Team::MyTeam,
                nationality: Nationality::Canadian,
                name: "Player".to_string(),
                car_number: Some(42),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: false,
                team: Team::MyTeam,
                nationality: Nationality::Invalid,
                name: "".to_string(),
                car_number: Some(0),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: false,
                team: Team::MyTeam,
                nationality: Nationality::Invalid,
                name: "".to_string(),
                car_number: Some(0),
                ready_status: ReadyStatus::NotReady,
            },
        ],
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2022_car_damage_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e6070102010a321aca82d6efd8a364291442fb02000013ffcc43853f6b52723fa457033f313afb3e0100000000000000000000000000000000000000000000000000841c503f073f433fefbec23ec04abb3e00000000000000000000000000000000000000000000000000008fa17c3f65e4633f3e04df3e8fb8dd3e000000000000000000000000000000000000000000000000000004f65e3f162b543f0caaf33e38a7e53e000000000000000000000000000000000000000000000000000026f8583ff55e4f3fa1a9da3e7181d53e000000000000000000000000000000000000000000000000000002918e3fa479883f15cf063f0776013f01010000000000000000000000000000000000000000000000007fb74e3fd276423f73a0a43e5a4fa83e00000000000000000000000000000000000000000000000000009f32893ffbd57e3f7c04f03ecbd6e73e0100000000000000000000000000000000000000000000000000e5c4853fd1fc763f1239093f41baff3e01000000000000000000000000000000000000000000000000002b26843f98686e3ff448ea3e885de53e01000000000000000000000000000000000000000000000000004cb76e3f05de623fbeebf23e33a8e93e000000000000000000000000000000000000000000000000000091cd8a3f4e76813f59290c3f2598043f0101000000000000000000000000000000000000000000000000a615833fb6d8773fbc97fd3ef913f93e0100000000000000000000000000000000000000000000000000e04b6f3f2a125e3f96b9043f28ad043f0000000000000000000000000000000000000000000000000000e6fd833f8f07773fb5e10c3f2237043f01000000000000000009000000000000000000000000000000000f23883ffa01763f7601043f5a36f83e01000000000000000000000000000000000000000000000000004031753fbf36643f1729f03ea8ace83e0000000000000000000000000000000000000000000000000000c59d803fedfb673f1781013f01bef53e0100000000000000000000000000000000000000000000000000a035483f64ce393faea4c63ea804bc3e0000000000000000646400000000000000000000000000000000419625402ee63f40cf27773fdc7ca83f020200010000000064640050001a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::CarDamage(s) => s,
        _ => panic!("Invalid packet. Expected CarDamage, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2022);

    let expected = PacketCarDamageData {
        header: actual.header.clone(),
        car_damage_data: vec![
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.0411315,
                    rear_right: 0.9465701,
                    front_left: 0.51305604,
                    front_right: 0.49067834,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                ers_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                engine_blown: false,
                engine_seized: false,
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 0.8129351,
                    rear_right: 0.7626805,
                    front_left: 0.38036296,
                    front_right: 0.36580467,
                },
                tyres_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                ers_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                engine_blown: false,
                engine_seized: false,
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 0.9868402,
                    rear_right: 0.8902038,
                    front_left: 0.43557924,
                    front_right: 0.4330487,
                },
                tyres_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                ers_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                engine_blown: false,
                engine_seized: false,
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 0.8709414,
                    rear_right: 0.82878244,
                    front_left: 0.47590673,
                    front_right: 0.4485414,
                },
                tyres_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                ers_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                engine_blown: false,
                engine_seized: false,
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 0.84753644,
                    rear_right: 0.8100427,
                    front_left: 0.42707542,
                    front_right: 0.41700318,
                },
                tyres_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                ers_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                engine_blown: false,
                engine_seized: false,
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.1138003,
                    rear_right: 1.0662122,
                    front_left: 0.5265973,
                    front_right: 0.5057072,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 1,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                ers_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                engine_blown: false,
                engine_seized: false,
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 0.8074874,
                    rear_right: 0.75962555,
                    front_left: 0.32153663,
                    front_right: 0.3287304,
                },
                tyres_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                ers_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                engine_blown: false,
                engine_seized: false,
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.0718573,
                    rear_right: 0.9954526,
                    front_left: 0.4687842,
                    front_right: 0.45281062,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                ers_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                engine_blown: false,
                engine_seized: false,
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.0450712,
                    rear_right: 0.9647952,
                    front_left: 0.5360271,
                    front_right: 0.49946788,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                ers_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                engine_blown: false,
                engine_seized: false,
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.0324148,
                    rear_right: 0.9312835,
                    front_left: 0.45758784,
                    front_right: 0.4479792,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                ers_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                engine_blown: false,
                engine_seized: false,
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 0.9324844,
                    rear_right: 0.88620025,
                    front_left: 0.47445482,
                    front_right: 0.45636138,
                },
                tyres_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                ers_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                engine_blown: false,
                engine_seized: false,
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.0843984,
                    rear_right: 1.0114229,
                    front_left: 0.5475059,
                    front_right: 0.51794654,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 1,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                ers_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                engine_blown: false,
                engine_seized: false,
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.0240982,
                    rear_right: 0.9681505,
                    front_left: 0.49529827,
                    front_right: 0.4864805,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                ers_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                engine_blown: false,
                engine_seized: false,
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 0.9347515,
                    rear_right: 0.86746466,
                    front_left: 0.5184568,
                    front_right: 0.51826715,
                },
                tyres_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                ers_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                engine_blown: false,
                engine_seized: false,
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.0311859,
                    rear_right: 0.9649591,
                    front_left: 0.550319,
                    front_right: 0.51646626,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 9,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                ers_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                engine_blown: false,
                engine_seized: false,
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.0635699,
                    rear_right: 0.96096766,
                    front_left: 0.5156473,
                    front_right: 0.48478967,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                ers_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                engine_blown: false,
                engine_seized: false,
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 0.95778275,
                    rear_right: 0.89146036,
                    front_left: 0.4690635,
                    front_right: 0.45444226,
                },
                tyres_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                ers_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                engine_blown: false,
                engine_seized: false,
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.0048147,
                    rear_right: 0.90618783,
                    front_left: 0.505876,
                    front_right: 0.47996524,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                ers_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                engine_blown: false,
                engine_seized: false,
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 0.78206825,
                    rear_right: 0.7258055,
                    front_left: 0.38797516,
                    front_right: 0.36722302,
                },
                tyres_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 100,
                front_right_wing_damage: 100,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                ers_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                engine_blown: false,
                engine_seized: false,
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 2.5872958,
                    rear_right: 2.998424,
                    front_left: 0.9654512,
                    front_right: 1.3163104,
                },
                tyres_damage: WheelData {
                    rear_left: 2,
                    rear_right: 2,
                    front_left: 0,
                    front_right: 1,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 100,
                front_right_wing_damage: 100,
                rear_wing_damage: 0,
                floor_damage: 80,
                diffuser_damage: 0,
                sidepod_damage: 26,
                drs_fault: false,
                ers_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                engine_blown: false,
                engine_seized: false,
            },
            CarDamageData::default(),
            CarDamageData::default(),
        ],
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2022_session_history_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e6070102010b321aca82d6efd8a3000000000000000013ff0006010202010177a301004caec69b63590fab680100ef72219c9a590f0c6a01005473db9cdc590fa66a01009173259dee590f966a010096731a9de4590f000000000000000000000f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ff1210000000000000000000000000000000000000000000").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::SessionHistory(s) => s,
        _ => panic!("Invalid packet. Expected SessionHistory, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2022);

    let expected = PacketSessionHistoryData {
        header: actual.header.clone(),
        car_index: 0,
        number_of_laps: 6,
        number_of_tyre_stints: 1,
        best_lap_time_lap_number: 2,
        best_sector_1_lap_number: 2,
        best_sector_2_lap_number: 1,
        best_sector_3_lap_number: 1,
        lap_history: vec![
            LapHistoryData {
                lap_time: 107383,
                sector_1_time: 44620,
                sector_2_time: 39878,
                sector_3_time: 22883,
                valid_sectors: 15,
            },
            LapHistoryData {
                lap_time: 92331,
                sector_1_time: 29423,
                sector_2_time: 39969,
                sector_3_time: 22938,
                valid_sectors: 15,
            },
            LapHistoryData {
                lap_time: 92684,
                sector_1_time: 29524,
                sector_2_time: 40155,
                sector_3_time: 23004,
                valid_sectors: 15,
            },
            LapHistoryData {
                lap_time: 92838,
                sector_1_time: 29585,
                sector_2_time: 40229,
                sector_3_time: 23022,
                valid_sectors: 15,
            },
            LapHistoryData {
                lap_time: 92822,
                sector_1_time: 29590,
                sector_2_time: 40218,
                sector_3_time: 23012,
                valid_sectors: 15,
            },
            LapHistoryData {
                lap_time: 0,
                sector_1_time: 0,
                sector_2_time: 0,
                sector_3_time: 0,
                valid_sectors: 15,
            },
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
        ],
        tyre_stints: vec![
            TyreStintData {
                end_lap: 255,
                tyre_compound: TyreCompound::C3,
                tyre_compound_visual: TyreCompoundVisual::Soft,
            },
            TyreStintData::default(),
            TyreStintData::default(),
            TyreStintData::default(),
            TyreStintData::default(),
            TyreStintData::default(),
            TyreStintData::default(),
            TyreStintData::default(),
        ],
    };

    assert_eq!(actual, expected);
}
