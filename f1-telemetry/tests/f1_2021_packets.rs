use f1_telemetry::packet::car_damage::{CarDamageData, PacketCarDamageData};
use f1_telemetry::packet::car_setup::{CarSetupData, PacketCarSetupData};
use f1_telemetry::packet::car_status::{
    CarStatusData, ERSDeployMode, FuelMix, PacketCarStatusData, TractionControl, DRS,
};
use f1_telemetry::packet::car_telemetry::{
    CarTelemetryData, MFDPanel, PacketCarTelemetryData, SurfaceType,
};
use f1_telemetry::packet::event::{Event, InfringementType, PacketEventData, Penalty, PenaltyType};
use f1_telemetry::packet::final_classification::{
    FinalClassification, PacketFinalClassificationData,
};
use f1_telemetry::packet::generic::{
    Flag, Nationality, ResultStatus, Team, TyreCompound, TyreCompoundVisual, WheelData,
};
use f1_telemetry::packet::lap::{DriverStatus, LapData, PacketLapData, PitStatus, Sector};
use f1_telemetry::packet::lobby_info::{PacketLobbyInfoData, Player, ReadyStatus};
use f1_telemetry::packet::motion::{CarMotionData, PacketMotionData, PlayerCarData};
use f1_telemetry::packet::participants::{
    Driver, PacketParticipantsData, ParticipantData, Telemetry,
};
use f1_telemetry::packet::session::{
    BrakingAssist, DrivingAssists, DynamicRacingLine, DynamicRacingLineType, ForecastAccuracy,
    Formula, GearboxAssist, MarshalZone, PacketSessionData, SafetyCar, SessionType,
    TemperatureChange, Track, Weather, WeatherForecast, WeatherForecastSample,
};
use f1_telemetry::packet::session_history::{
    LapHistoryData, PacketSessionHistoryData, TyreStintData,
};
use f1_telemetry::packet::Packet;

mod utils;

#[tokio::test]
async fn test_parse_2021_motion_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e507011201002e324e2ac5eb38ad0f6498422006000013ffb48f9d433741af4246ba5b44ea58674130536cbbac2c6e42431ef9ff5d7ca383f7ff431e10791b3df5363a3f831e583bbb6c743e008079b9b19a9c390318a043723faf42fb825f4451317f41281f5bbb285e8242681ef7ff547cac830100681ef0051f3c60744f3f5063b93b479d753e0040e338a9e437b8ec3a9e430d40af425eda5c44116377414c4a95bb97d27d424b1efbff5b7ca58300004b1e34df3b3cd6b45f3f44c14bbb0cb4743e0080573898f92cb7913ea143f73eaf42897b614412838241381484bb010785427f1ef4ff4f7cb18302007f1e30201e3c4846433f5b71423ac259763e00401d391a2886b8c218a243a73eaf42b83b64442ce1834108f287bb13d58642651ef3ff557cab830000651e0c24693c683c3b3feb12f9b9318a753e0040f038b8736eb738cf9b431441af42851357442aaf6c41884965bb80057142831e00004e7cb2830400831e8fa164bd68b2773f07ff3a3beb7c763e00a00d39eea20db9b709a043633faf42c9025f44b82b8041605176bb30b88242711ef7ff527cae830500711efae1fbbbdda34d3ff746d1bae6ec753e0080703970802cb968879d432d40af42b7875a4417437741a04e99bb75537c42731efcff527cae830200731ebd4f15bdce0f633f597859bb54fd753e00c0cd38781a86b801af9f436f3faf4284755f4465e87e4158288ebb087182425c1ef7ff577ca98300005c1e7765393d290a4f3fff7c423af93b753e0000a03820c924b733b3a0433040af42e984624443297441144696bbe9ec7b42261efaff647c9c83ffff261e19e0b1bcb9c5553f3f642bbadc80733e0000f43614fd23386ff59b43e840af4269cd5744e34e6c41f65410bc43117242571ee8ff597ca7830400571e25678fbc2d9ce5bec10218bdab10753e00a0a1398dd30cb986639e43d93faf42e4ca5d4450eb764154858abbd31d8042141efaff697c9783eaff141e5591c43dcf725a3f77d47fbb42ea723e00d822ba557e343a2f12a043213faf42e5c860443a9d80417cd597bb0b4f8442381ef5ff607ca083ffff381e0fb58fbbccd1463f9983c4bb0214743e00803a38cd521a38ae029f43b33faf421d605e44dc537b41f8cb64bb61fc8042481ef9ff5c7ca4830100481e2ae112bd7cd3553f7ac5293b9c94743e0000ed38f41577b8e43c9f43bd3faf4296f85d4456b47b4190927cbb0f9a8042671ef9ff557cab830100671e43bfde3c707d573f20a1783bd596753e0000d8384bb75bb8ffc89b43fe40af425b38574448ac6d41ccd484bbed3272427d1effff4f7cb18301007d1e28393cbd24e8723f2aba35bb914d763e00003e380ee51db84d719e43e03faf42df9a5d4497d77841d82170bbb0058042361efaff607ca0830000361ea175bd3cee7e5a3f907607bbee05743e00009c38a0dbe7b787aa97439a42af42cd4f4f44def0524130151c3c6c2f5c42ce1d01007a7c86830200ce1d70b6263cf041823ffa8318bc0bab703e00808b38c261acb8f3c09c438240af42f4195a4490856e418c701abc9b5b7842d21dffff797c8783d2ffd21d0be3773ed3a86c3fd2fa503c65cb703e008cb2babb29b93a0300ba43733eaf428c718d4437a88c41f84e3cbb7c51a1426f1b1b00057dfb82d8ff6f1b2dfb393e3803923eaacec63b7d375d3e0060b7baf5bda33a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012f75e40779fa040875c3e419b8b52418f45d6406a4a17c00775b940ecfdbbbfbfdfa541a65c544375e514c228d66e43afc4a54289cfa542d42ba5421b37a5423722873b9193893bb0dc033a2266113ae24eeebdcd8492bd2d1ba5427f932bbbab402e3c22013abc79870fbea51288befb571cbf00000080").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::Motion(m) => m,
        _ => panic!("Invalid packet. Expected Motion, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2021);

    let expected = PacketMotionData {
        header: actual.header.clone(),
        motion_data: vec![
            CarMotionData {
                world_position_x: 315.12268,
                world_position_y: 87.62737,
                world_position_z: 878.9105,
                world_velocity_x: 14.459208,
                world_velocity_y: -0.0036060326,
                world_velocity_z: 59.543625,
                world_forward_dir_x: 7747,
                world_forward_dir_y: -7,
                world_forward_dir_z: 31837,
                world_right_dir_x: -31837,
                world_right_dir_y: -9,
                world_right_dir_z: 7747,
                g_force_lateral: 0.03795725,
                g_force_longitudinal: 0.7274011,
                g_force_vertical: 0.003297717,
                yaw: 0.23869602,
                pitch: -0.00023794174,
                roll: 0.00029869893,
            },
            CarMotionData {
                world_position_x: 320.1876,
                world_position_y: 87.62392,
                world_position_z: 894.0466,
                world_velocity_x: 15.94954,
                world_velocity_y: -0.0033435319,
                world_velocity_z: 65.1839,
                world_forward_dir_x: 7784,
                world_forward_dir_y: -9,
                world_forward_dir_z: 31828,
                world_right_dir_x: -31828,
                world_right_dir_y: 1,
                world_right_dir_z: 7784,
                g_force_lateral: 0.009706005,
                g_force_longitudinal: 0.8103695,
                g_force_vertical: 0.005657591,
                yaw: 0.23985778,
                pitch: 0.000108361244,
                roll: -4.3843556e-5,
            },
            CarMotionData {
                world_position_x: 316.46033,
                world_position_y: 87.6251,
                world_position_z: 883.412,
                world_velocity_x: 15.461686,
                world_velocity_y: -0.004555976,
                world_velocity_z: 63.455654,
                world_forward_dir_x: 7755,
                world_forward_dir_y: -5,
                world_forward_dir_z: 31835,
                world_right_dir_x: -31835,
                world_right_dir_y: 0,
                world_right_dir_z: 7755,
                g_force_lateral: 0.01146679,
                g_force_longitudinal: 0.8738531,
                g_force_vertical: -0.0031090537,
                yaw: 0.23896807,
                pitch: 5.1379204e-5,
                roll: -1.0310112e-5,
            },
            CarMotionData {
                world_position_x: 322.4888,
                world_position_y: 87.62298,
                world_position_z: 901.93024,
                world_velocity_x: 16.314,
                world_velocity_y: -0.0040307306,
                world_velocity_z: 66.51368,
                world_forward_dir_x: 7807,
                world_forward_dir_y: -12,
                world_forward_dir_z: 31823,
                world_right_dir_x: -31823,
                world_right_dir_y: 2,
                world_right_dir_z: 7807,
                g_force_lateral: 0.009651229,
                g_force_longitudinal: 0.76279116,
                g_force_vertical: 0.0007417404,
                yaw: 0.24057677,
                pitch: 0.00014996529,
                roll: -6.3970874e-5,
            },
            CarMotionData {
                world_position_x: 324.19342,
                world_position_y: 87.62237,
                world_position_z: 912.9331,
                world_velocity_x: 16.484947,
                world_velocity_y: -0.0041487254,
                world_velocity_z: 67.41616,
                world_forward_dir_x: 7781,
                world_forward_dir_y: -13,
                world_forward_dir_z: 31829,
                world_right_dir_x: -31829,
                world_right_dir_y: 0,
                world_right_dir_z: 7781,
                g_force_lateral: 0.014229786,
                g_force_longitudinal: 0.7313905,
                g_force_vertical: -0.00047507076,
                yaw: 0.23978497,
                pitch: 0.00011456013,
                roll: -1.4212848e-5,
            },
            CarMotionData {
                world_position_x: 311.6189,
                world_position_y: 87.627106,
                world_position_z: 860.305,
                world_velocity_x: 14.792765,
                world_velocity_y: -0.0034986455,
                world_velocity_z: 60.25537,
                world_forward_dir_x: 7811,
                world_forward_dir_y: 0,
                world_forward_dir_z: 31822,
                world_right_dir_x: -31822,
                world_right_dir_y: 4,
                world_right_dir_z: 7811,
                g_force_lateral: -0.055818137,
                g_force_longitudinal: 0.967566,
                g_force_vertical: 0.0028533356,
                yaw: 0.2407109,
                pitch: 0.00013506413,
                roll: -0.00013507504,
            },
            CarMotionData {
                world_position_x: 320.0759,
                world_position_y: 87.6238,
                world_position_z: 892.0435,
                world_velocity_x: 16.021347,
                world_velocity_y: -0.0037585124,
                world_velocity_z: 65.35974,
                world_forward_dir_x: 7793,
                world_forward_dir_y: -9,
                world_forward_dir_z: 31826,
                world_right_dir_x: -31826,
                world_right_dir_y: 5,
                world_right_dir_z: 7793,
                g_force_lateral: -0.0076868506,
                g_force_longitudinal: 0.8032816,
                g_force_vertical: -0.0015966584,
                yaw: 0.24016151,
                pitch: 0.00022935867,
                roll: -0.00016451045,
            },
            CarMotionData {
                world_position_x: 315.05786,
                world_position_y: 87.62534,
                world_position_z: 874.12054,
                world_velocity_x: 15.453879,
                world_velocity_y: -0.0046785623,
                world_velocity_z: 63.0815,
                world_forward_dir_x: 7795,
                world_forward_dir_y: -4,
                world_forward_dir_z: 31826,
                world_right_dir_x: -31826,
                world_right_dir_y: 2,
                world_right_dir_z: 7795,
                g_force_lateral: -0.036452997,
                g_force_longitudinal: 0.8869599,
                g_force_vertical: -0.0033183305,
                yaw: 0.24022418,
                pitch: 9.8109245e-5,
                roll: -6.394548e-5,
            },
            CarMotionData {
                world_position_x: 319.36722,
                world_position_y: 87.62389,
                world_position_z: 893.8362,
                world_velocity_x: 15.931737,
                world_velocity_y: -0.0043383054,
                world_velocity_z: 65.220764,
                world_forward_dir_x: 7772,
                world_forward_dir_y: -9,
                world_forward_dir_z: 31831,
                world_right_dir_x: -31831,
                world_right_dir_y: 0,
                world_right_dir_z: 7772,
                g_force_lateral: 0.04526278,
                g_force_longitudinal: 0.8087488,
                g_force_vertical: 0.00074191386,
                yaw: 0.23948659,
                pitch: 7.6293945e-5,
                roll: -9.82199e-6,
            },
            CarMotionData {
                world_position_x: 321.4,
                world_position_y: 87.62537,
                world_position_z: 906.0767,
                world_velocity_x: 15.260074,
                world_velocity_y: -0.0045859907,
                world_velocity_z: 62.981358,
                world_forward_dir_x: 7718,
                world_forward_dir_y: -6,
                world_forward_dir_z: 31844,
                world_right_dir_x: -31844,
                world_right_dir_y: -1,
                world_right_dir_z: 7718,
                g_force_lateral: -0.021713303,
                g_force_longitudinal: 0.83504826,
                g_force_vertical: -0.000653807,
                yaw: 0.23779625,
                pitch: 7.2717667e-6,
                roll: 3.9097926e-5,
            },
            CarMotionData {
                world_position_x: 311.91745,
                world_position_y: 87.62677,
                world_position_z: 863.20953,
                world_velocity_x: 14.769259,
                world_velocity_y: -0.008809319,
                world_velocity_z: 60.516857,
                world_forward_dir_x: 7767,
                world_forward_dir_y: -24,
                world_forward_dir_z: 31833,
                world_right_dir_x: -31833,
                world_right_dir_y: 4,
                world_right_dir_z: 7767,
                g_force_lateral: -0.017505238,
                g_force_longitudinal: -0.44845715,
                g_force_vertical: -0.037112,
                yaw: 0.2393214,
                pitch: 0.00030827522,
                roll: -0.00013430249,
            },
            CarMotionData {
                world_position_x: 316.77753,
                world_position_y: 87.6247,
                world_position_z: 887.17017,
                world_velocity_x: 15.432449,
                world_velocity_y: -0.0042273197,
                world_velocity_z: 64.05825,
                world_forward_dir_x: 7700,
                world_forward_dir_y: -6,
                world_forward_dir_z: 31849,
                world_right_dir_x: -31849,
                world_right_dir_y: -22,
                world_right_dir_z: 7700,
                g_force_lateral: 0.095980324,
                g_force_longitudinal: 0.85331434,
                g_force_vertical: -0.003903655,
                yaw: 0.23722175,
                pitch: -0.0006211996,
                roll: 0.000688528,
            },
            CarMotionData {
                world_position_x: 320.14206,
                world_position_y: 87.6233,
                world_position_z: 899.139,
                world_velocity_x: 16.07677,
                world_velocity_y: -0.0046336036,
                world_velocity_z: 66.15438,
                world_forward_dir_x: 7736,
                world_forward_dir_y: -11,
                world_forward_dir_z: 31840,
                world_right_dir_x: -31840,
                world_right_dir_y: -1,
                world_right_dir_z: 7736,
                g_force_lateral: -0.0043855975,
                g_force_longitudinal: 0.77663875,
                g_force_vertical: -0.005997133,
                yaw: 0.23835757,
                pitch: 4.4465065e-5,
                roll: 3.6793575e-5,
            },
            CarMotionData {
                world_position_x: 318.02094,
                world_position_y: 87.62441,
                world_position_z: 889.5018,
                world_velocity_x: 15.7079735,
                world_velocity_y: -0.0034911614,
                world_velocity_z: 64.49293,
                world_forward_dir_x: 7752,
                world_forward_dir_y: -7,
                world_forward_dir_z: 31836,
                world_right_dir_x: -31836,
                world_right_dir_y: 1,
                world_right_dir_z: 7752,
                g_force_lateral: -0.035859264,
                g_force_longitudinal: 0.83525825,
                g_force_vertical: 0.0025905059,
                yaw: 0.23884815,
                pitch: 0.00011301041,
                roll: -5.8909834e-5,
            },
            CarMotionData {
                world_position_x: 318.4757,
                world_position_y: 87.62449,
                world_position_z: 887.88416,
                world_velocity_x: 15.731527,
                world_velocity_y: -0.0038539506,
                world_velocity_z: 64.300896,
                world_forward_dir_x: 7783,
                world_forward_dir_y: -7,
                world_forward_dir_z: 31829,
                world_right_dir_x: -31829,
                world_right_dir_y: 1,
                world_right_dir_z: 7783,
                g_force_lateral: 0.02719081,
                g_force_longitudinal: 0.8417578,
                g_force_vertical: 0.0037937835,
                yaw: 0.23983319,
                pitch: 0.000102996826,
                roll: -5.2384374e-5,
            },
            CarMotionData {
                world_position_x: 311.57028,
                world_position_y: 87.62694,
                world_position_z: 860.88055,
                world_velocity_x: 14.854561,
                world_velocity_y: -0.0040536877,
                world_velocity_z: 60.549732,
                world_forward_dir_x: 7805,
                world_forward_dir_y: -1,
                world_forward_dir_z: 31823,
                world_right_dir_x: -31823,
                world_right_dir_y: 1,
                world_right_dir_z: 7805,
                g_force_lateral: -0.045952946,
                g_force_longitudinal: 0.9488547,
                g_force_vertical: -0.002772937,
                yaw: 0.24053027,
                pitch: 4.529953e-5,
                roll: -3.764504e-5,
            },
            CarMotionData {
                world_position_x: 316.88516,
                world_position_y: 87.624756,
                world_position_z: 886.41986,
                world_velocity_x: 15.552634,
                world_velocity_y: -0.0036641266,
                world_velocity_z: 64.01111,
                world_forward_dir_x: 7734,
                world_forward_dir_y: -6,
                world_forward_dir_z: 31840,
                world_right_dir_x: -31840,
                world_right_dir_y: 0,
                world_right_dir_z: 7734,
                g_force_lateral: 0.023127379,
                g_force_longitudinal: 0.8534993,
                g_force_vertical: -0.0020670034,
                yaw: 0.23830387,
                pitch: 7.43866e-5,
                roll: -2.7639617e-5,
            },
            CarMotionData {
                world_position_x: 303.33224,
                world_position_y: 87.63008,
                world_position_z: 829.2469,
                world_velocity_x: 13.183805,
                world_velocity_y: 0.009526536,
                world_velocity_z: 55.04631,
                world_forward_dir_x: 7630,
                world_forward_dir_y: 1,
                world_forward_dir_z: 31866,
                world_right_dir_x: -31866,
                world_right_dir_y: 2,
                world_right_dir_z: 7630,
                g_force_lateral: 0.010175332,
                g_force_longitudinal: 1.0176373,
                g_force_vertical: -0.009308809,
                yaw: 0.23502748,
                pitch: 6.651878e-5,
                roll: -8.219808e-5,
            },
            CarMotionData {
                world_position_x: 313.50742,
                world_position_y: 87.62599,
                world_position_z: 872.4055,
                world_velocity_x: 14.907608,
                world_velocity_y: -0.009426247,
                world_velocity_z: 62.08946,
                world_forward_dir_x: 7634,
                world_forward_dir_y: -1,
                world_forward_dir_z: 31865,
                world_right_dir_x: -31865,
                world_right_dir_y: -46,
                world_right_dir_z: 7634,
                g_force_lateral: 0.24207704,
                g_force_longitudinal: 0.92445105,
                g_force_vertical: 0.012755113,
                yaw: 0.23515089,
                pitch: -0.0013622046,
                roll: 0.0014126817,
            },
            CarMotionData {
                world_position_x: 372.0001,
                world_position_y: 87.62197,
                world_position_z: 1131.5483,
                world_velocity_x: 17.582136,
                world_velocity_y: -0.0028733592,
                world_velocity_z: 80.65915,
                world_forward_dir_x: 7023,
                world_forward_dir_y: 27,
                world_forward_dir_z: 32005,
                world_right_dir_x: -32005,
                world_right_dir_y: -40,
                world_right_dir_z: 7023,
                g_force_lateral: 0.18162222,
                g_force_longitudinal: 0.2851808,
                g_force_vertical: 0.0060671167,
                yaw: 0.21603198,
                pitch: -0.0013990402,
                roll: 0.0012492525,
            },
            CarMotionData {
                world_position_x: 0.0,
                world_position_y: 0.0,
                world_position_z: 0.0,
                world_velocity_x: 0.0,
                world_velocity_y: 0.0,
                world_velocity_z: 0.0,
                world_forward_dir_x: 0,
                world_forward_dir_y: 0,
                world_forward_dir_z: 0,
                world_right_dir_x: 0,
                world_right_dir_y: 0,
                world_right_dir_z: 0,
                g_force_lateral: 0.0,
                g_force_longitudinal: 0.0,
                g_force_vertical: 0.0,
                yaw: 0.0,
                pitch: 0.0,
                roll: 0.0,
            },
            CarMotionData {
                world_position_x: 0.0,
                world_position_y: 0.0,
                world_position_z: 0.0,
                world_velocity_x: 0.0,
                world_velocity_y: 0.0,
                world_velocity_z: 0.0,
                world_forward_dir_x: 0,
                world_forward_dir_y: 0,
                world_forward_dir_z: 0,
                world_right_dir_x: 0,
                world_right_dir_y: 0,
                world_right_dir_z: 0,
                g_force_lateral: 0.0,
                g_force_longitudinal: 0.0,
                g_force_vertical: 0.0,
                yaw: 0.0,
                pitch: 0.0,
                roll: 0.0,
            },
        ],
        player_car_data: Some(PlayerCarData {
            suspension_position: WheelData {
                rear_left: 3.48383,
                rear_right: 5.019466,
                front_left: 11.89759,
                front_right: 13.159083,
            },
            suspension_velocity: WheelData {
                rear_left: 6.695991,
                rear_right: -2.3639169,
                front_left: 5.7955356,
                front_right: -1.4686866,
            },
            suspension_acceleration: WheelData {
                rear_left: 20.734251,
                rear_right: 212.36191,
                front_left: -37.22408,
                front_right: 238.83655,
            },
            wheel_speed: WheelData {
                rear_left: 82.88415,
                rear_right: 82.90534,
                front_left: 82.5856,
                front_right: 82.60763,
            },
            wheel_slip: WheelData {
                rear_left: 0.004123952,
                rear_right: 0.0041984995,
                front_left: 0.00050301384,
                front_right: 0.000554653,
            },
            local_velocity_x: -0.116361395,
            local_velocity_y: -0.07154236,
            local_velocity_z: 82.55308,
            angular_velocity_x: -0.0026180444,
            angular_velocity_y: 0.010635535,
            angular_velocity_z: -0.011352809,
            angular_acceleration_x: -0.14016522,
            angular_acceleration_y: -0.26576725,
            angular_acceleration_z: -0.6107175,
            front_wheels_angle: 0.0,
        }),
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2021_session_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e507011201012e324e2ac5eb38ad10e997421b06000013ff001d14c813110906000000f000500000ff000f000000000081aeba3d00756a0b3e00f3c5473e0041d8723e00699d8b3e00a5d2a23e00cd64c63e0086dddf3e00b77dfb3e009f55153f00fd7e263f00d8923c3f00fbd35b3f003ce06b3f000000000000000000000000000000000000000000000000000000000000000000060900001d021402020905001d02140202090a001d021402020a00001d021402040a05001d021402040a0a001d0214020400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001f3028fbaf3028fbaf3028fbaf000000000003010100000101").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::Session(s) => s,
        _ => panic!("Invalid packet. Expected Session, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2021);

    let expected = PacketSessionData {
        header: actual.header.clone(),
        weather: Weather::Clear,
        track_temperature: 29,
        air_temperature: 20,
        total_laps: 200,
        track_length: 4371,
        session_type: SessionType::OneShotQualifying,
        track: Track::Montreal,
        formula: Formula::F1Modern,
        session_time_left: 0,
        session_duration: 240,
        pit_speed_limit: 80,
        game_paused: false,
        is_spectating: false,
        spectator_car_index: 255,
        sli_pro_native_support: false,
        num_marshal_zones: 15,
        marshal_zones: vec![
            MarshalZone {
                zone_start: 0.0,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.09115315,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.13614829,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.19509105,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.23715307,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.27268532,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.31801334,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.3874878,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.43723696,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.4911935,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.5833377,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.6503752,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.73661566,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.8587033,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.9213903,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.0,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.0,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.0,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.0,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.0,
                zone_flag: Flag::None,
            },
            MarshalZone {
                zone_start: 0.0,
                zone_flag: Flag::None,
            },
        ],
        safety_car_status: SafetyCar::None,
        network_game: false,
        weather_forecast: Some(WeatherForecast {
            number_of_samples: 6,
            samples: vec![
                WeatherForecastSample {
                    session_type: SessionType::OneShotQualifying,
                    time_offset: 0,
                    weather: Weather::Clear,
                    track_temperature: 29,
                    track_temperature_change: TemperatureChange::NoChange,
                    air_temperature: 20,
                    air_temperature_change: TemperatureChange::NoChange,
                    rain_percentage: 2,
                },
                WeatherForecastSample {
                    session_type: SessionType::OneShotQualifying,
                    time_offset: 5,
                    weather: Weather::Clear,
                    track_temperature: 29,
                    track_temperature_change: TemperatureChange::NoChange,
                    air_temperature: 20,
                    air_temperature_change: TemperatureChange::NoChange,
                    rain_percentage: 2,
                },
                WeatherForecastSample {
                    session_type: SessionType::OneShotQualifying,
                    time_offset: 10,
                    weather: Weather::Clear,
                    track_temperature: 29,
                    track_temperature_change: TemperatureChange::NoChange,
                    air_temperature: 20,
                    air_temperature_change: TemperatureChange::NoChange,
                    rain_percentage: 2,
                },
                WeatherForecastSample {
                    session_type: SessionType::Race,
                    time_offset: 0,
                    weather: Weather::Clear,
                    track_temperature: 29,
                    track_temperature_change: TemperatureChange::NoChange,
                    air_temperature: 20,
                    air_temperature_change: TemperatureChange::NoChange,
                    rain_percentage: 4,
                },
                WeatherForecastSample {
                    session_type: SessionType::Race,
                    time_offset: 5,
                    weather: Weather::Clear,
                    track_temperature: 29,
                    track_temperature_change: TemperatureChange::NoChange,
                    air_temperature: 20,
                    air_temperature_change: TemperatureChange::NoChange,
                    rain_percentage: 4,
                },
                WeatherForecastSample {
                    session_type: SessionType::Race,
                    time_offset: 10,
                    weather: Weather::Clear,
                    track_temperature: 29,
                    track_temperature_change: TemperatureChange::NoChange,
                    air_temperature: 20,
                    air_temperature_change: TemperatureChange::NoChange,
                    rain_percentage: 4,
                },
            ],
            accuracy: ForecastAccuracy::Perfect,
        }),
        ai_difficulty: Some(31),
        season_identifier: Some(2952472624),
        weekend_identifier: Some(2952472624),
        session_identifier: Some(2952472624),
        pit_stop_window_ideal_lap: Some(0),
        pit_stop_window_latest_lap: Some(0),
        pit_stop_rejoin_position: Some(0),
        driving_assists: Some(DrivingAssists {
            steering_assist: false,
            braking_assist: BrakingAssist::Off,
            gearbox_assist: GearboxAssist::Automatic,
            pit_assist: true,
            pit_relase_assist: true,
            ers_assist: false,
            drs_assist: false,
            dynamic_racing_line: DynamicRacingLine::CornersOnly,
            dynamic_racing_line_type: DynamicRacingLineType::ThreeDimensions,
        }),
        game_mode: None,
        rule_set: None,
        time_of_day: None,
        session_length: None,
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2021_lap_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e507011201022e324e2ac5eb38ad0f6498422006000013ff000000006e2001009856ea5e527f8045527f8045000000800e010000020000000000000102000000000000000000006e2001009456c15e20fe804520fe80450000008006010000020000000000000102000000000000000000006e200100d456335fbfa48045bfa48045000000800d010000020000000000000102000000000000000000006e2001002156e05ea23f8145a23f81450000008004010000020000000000000102000000000000000000006e200100f455d35e8b9881458b9881450000008002010000020000000000000102000000000000000000006e2001005357825fefcf7f45efcf7f450000008013010000020000000000000102000000000000000000006e2001006556af5e45ee804545ee80450000008008010000020000000000000102000000000000000000006e2001007456165fbc598045bc598045000000800f010000020000000000000102000000000000000000006e2001005f568f5e1dfb80451dfb80450000008007010000020000000000000102000000000000000000006e200100c7554a5e3a5e81453a5e81450000008003010000020000000000000102000000000000000000006e2001000457415f61fe7f4561fe7f450000008011010000020000000000000102000000000000000000006e2001008d56d55eabc28045abc28045000000800b010000020000000000000102000000000000000000006e2001006d56945ee0258145e02581450000008005010000020000000000000102000000000000000000006e2001005a560a5ff8d68045f8d680450000008009010000020000000000000102000000000000000000006e200100a256f95e12cb804512cb8045000000800a010000020000000000000102000000000000000000006e2001002357705fc9d87f45c9d87f450000008012010000020000000000000102000000000000000000006e2001006456bb5efbbc8045fbbc8045000000800c010000020000000000000102000000000000000000006e200100fe572a60b7ce7d45b7ce7d450000008014010000020000000000000102000000000000000000006e2001001557465fc4498045c44980450000008010010000020000000000000102000000000000000000006e2001003e52095bae968845ae96884500000080010100000200000000000001020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::Lap(s) => s,
        _ => panic!("Invalid packet. Expected Lap, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2021);

    let expected = PacketLapData {
        header: actual.header.clone(),
        lap_data: vec![
            LapData {
                last_lap_time: 0,
                current_lap_time: 73838,
                sector_1_time: 22168,
                sector_2_time: 24298,
                lap_distance: 4111.915,
                total_distance: 4111.915,
                safety_car_delta: -0.0,
                car_position: 14,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector3,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 0,
                driver_status: DriverStatus::FlyingLap,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 73838,
                sector_1_time: 22164,
                sector_2_time: 24257,
                lap_distance: 4127.7656,
                total_distance: 4127.7656,
                safety_car_delta: -0.0,
                car_position: 6,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector3,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 0,
                driver_status: DriverStatus::FlyingLap,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 73838,
                sector_1_time: 22228,
                sector_2_time: 24371,
                lap_distance: 4116.5933,
                total_distance: 4116.5933,
                safety_car_delta: -0.0,
                car_position: 13,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector3,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 0,
                driver_status: DriverStatus::FlyingLap,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 73838,
                sector_1_time: 22049,
                sector_2_time: 24288,
                lap_distance: 4135.954,
                total_distance: 4135.954,
                safety_car_delta: -0.0,
                car_position: 4,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector3,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 0,
                driver_status: DriverStatus::FlyingLap,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 73838,
                sector_1_time: 22004,
                sector_2_time: 24275,
                lap_distance: 4147.068,
                total_distance: 4147.068,
                safety_car_delta: -0.0,
                car_position: 2,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector3,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 0,
                driver_status: DriverStatus::FlyingLap,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 73838,
                sector_1_time: 22355,
                sector_2_time: 24450,
                lap_distance: 4092.9958,
                total_distance: 4092.9958,
                safety_car_delta: -0.0,
                car_position: 19,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector3,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 0,
                driver_status: DriverStatus::FlyingLap,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 73838,
                sector_1_time: 22117,
                sector_2_time: 24239,
                lap_distance: 4125.7837,
                total_distance: 4125.7837,
                safety_car_delta: -0.0,
                car_position: 8,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector3,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 0,
                driver_status: DriverStatus::FlyingLap,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 73838,
                sector_1_time: 22132,
                sector_2_time: 24342,
                lap_distance: 4107.217,
                total_distance: 4107.217,
                safety_car_delta: -0.0,
                car_position: 15,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector3,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 0,
                driver_status: DriverStatus::FlyingLap,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 73838,
                sector_1_time: 22111,
                sector_2_time: 24207,
                lap_distance: 4127.389,
                total_distance: 4127.389,
                safety_car_delta: -0.0,
                car_position: 7,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector3,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 0,
                driver_status: DriverStatus::FlyingLap,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 73838,
                sector_1_time: 21959,
                sector_2_time: 24138,
                lap_distance: 4139.7783,
                total_distance: 4139.7783,
                safety_car_delta: -0.0,
                car_position: 3,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector3,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 0,
                driver_status: DriverStatus::FlyingLap,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 73838,
                sector_1_time: 22276,
                sector_2_time: 24385,
                lap_distance: 4095.8987,
                total_distance: 4095.8987,
                safety_car_delta: -0.0,
                car_position: 17,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector3,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 0,
                driver_status: DriverStatus::FlyingLap,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 73838,
                sector_1_time: 22157,
                sector_2_time: 24277,
                lap_distance: 4120.3335,
                total_distance: 4120.3335,
                safety_car_delta: -0.0,
                car_position: 11,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector3,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 0,
                driver_status: DriverStatus::FlyingLap,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 73838,
                sector_1_time: 22125,
                sector_2_time: 24212,
                lap_distance: 4132.7344,
                total_distance: 4132.7344,
                safety_car_delta: -0.0,
                car_position: 5,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector3,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 0,
                driver_status: DriverStatus::FlyingLap,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 73838,
                sector_1_time: 22106,
                sector_2_time: 24330,
                lap_distance: 4122.871,
                total_distance: 4122.871,
                safety_car_delta: -0.0,
                car_position: 9,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector3,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 0,
                driver_status: DriverStatus::FlyingLap,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 73838,
                sector_1_time: 22178,
                sector_2_time: 24313,
                lap_distance: 4121.384,
                total_distance: 4121.384,
                safety_car_delta: -0.0,
                car_position: 10,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector3,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 0,
                driver_status: DriverStatus::FlyingLap,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 73838,
                sector_1_time: 22307,
                sector_2_time: 24432,
                lap_distance: 4093.549,
                total_distance: 4093.549,
                safety_car_delta: -0.0,
                car_position: 18,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector3,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 0,
                driver_status: DriverStatus::FlyingLap,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 73838,
                sector_1_time: 22116,
                sector_2_time: 24251,
                lap_distance: 4119.6226,
                total_distance: 4119.6226,
                safety_car_delta: -0.0,
                car_position: 12,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector3,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 0,
                driver_status: DriverStatus::FlyingLap,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 73838,
                sector_1_time: 22526,
                sector_2_time: 24618,
                lap_distance: 4060.9197,
                total_distance: 4060.9197,
                safety_car_delta: -0.0,
                car_position: 20,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector3,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 0,
                driver_status: DriverStatus::FlyingLap,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 73838,
                sector_1_time: 22293,
                sector_2_time: 24390,
                lap_distance: 4105.2207,
                total_distance: 4105.2207,
                safety_car_delta: -0.0,
                car_position: 16,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector3,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 0,
                driver_status: DriverStatus::FlyingLap,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData {
                last_lap_time: 0,
                current_lap_time: 73838,
                sector_1_time: 21054,
                sector_2_time: 23305,
                lap_distance: 4370.835,
                total_distance: 4370.835,
                safety_car_delta: -0.0,
                car_position: 1,
                current_lap_num: 1,
                pit_status: PitStatus::None,
                number_pit_stops: 0,
                sector: Sector::Sector3,
                current_lap_invalid: false,
                penalties: 0,
                total_warnings: 0,
                number_unserved_drive_through: 0,
                number_unserved_stop_go: 0,
                grid_position: 0,
                driver_status: DriverStatus::FlyingLap,
                result_status: ResultStatus::Active,
                pit_lane_timer_active: false,
                pit_lane_time_in_lane: 0,
                pit_stop_time: 0,
                pit_stop_should_serve_penalty: false,
                ..Default::default()
            },
            LapData::default(),
            LapData::default(),
        ],
        time_trial_personal_best_car_idx: None,
        time_trial_rival_car_idx: None,
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2021_event_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(
        &stream,
        "e507011201032e324e2ac5eb38ad9ba596420906000013ff50454e41102913ffff01ff00",
    )
    .await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::Event(s) => s,
        _ => panic!("Invalid packet. Expected Event, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2021);

    let expected = PacketEventData {
        header: actual.header.clone(),
        event: Event::Penalty(Penalty {
            vehicle_idx: 19,
            penalty_type: PenaltyType::Retired,
            infringement_type: InfringementType::RetiredTerminallyDamaged,
            other_vehicle_idx: 255,
            time: 255,
            lap_num: 1,
            places_gained: 255,
        }),
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2021_participants_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e507011201042e324e2ac5eb38ad72cd9242e705000013ff140151ff07002f1d534348554d41434845520000000000000000000000000000000000000000000000000000000000000000000000000000010106ff0900071b52c384494b4bc3964e454e0000000000000000000000000000000000000000000000000000000000000000000000000001014aff0900632947494f56494e415a5a49000000000000000000000000000000000000000000000000000000000000000000000000000001013bff06000a1c4741534c5900000000000000000000000000000000000000000000000000000000000000000000000000000000000000010136ff0800040a4e4f5252495300000000000000000000000000000000000000000000000000000000000000000000000000000000000001013fff0300060d4c4154494649000000000000000000000000000000000000000000000000000000000000000000000000000000000000010103ff05000e4d414c4f4e534f000000000000000000000000000000000000000000000000000000000000000000000000000000000000010102ff0800030352494343494152444f00000000000000000000000000000000000000000000000000000000000000000000000000000001013aff010010354c45434c4552430000000000000000000000000000000000000000000000000000000000000000000000000000000000010107ff00002c0a48414d494c544f4e0000000000000000000000000000000000000000000000000000000000000000000000000000000001015eff0600162b5453554e4f44410000000000000000000000000000000000000000000000000000000000000000000000000000000000010132ff03003f0a52555353454c4c000000000000000000000000000000000000000000000000000000000000000000000000000000000001010fff00004d1b424f54544153000000000000000000000000000000000000000000000000000000000000000000000000000000000000010100ff0100374d5341494e5a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010eff02000b34504552455a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000010113ff0400120d5354524f4c4c00000000000000000000000000000000000000000000000000000000000000000000000000000000000001010dff0400051d56455454454c00000000000000000000000000000000000000000000000000000000000000000000000000000000000001014fff070009004d415a4550494e0000000000000000000000000000000000000000000000000000000000000000000000000000000000010111ff05001f1c4f434f4e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010009ff020021165645525354415050454e00000000000000000000000000000000000000000000000000000000000000000000000000000000ffffff0000ff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffff0000ff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::Participants(s) => s,
        _ => panic!("Invalid packet. Expected Participants, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2021);

    let expected = PacketParticipantsData {
        header: actual.header.clone(),
        num_active_cars: 20,
        participants: vec![
            ParticipantData {
                ai_controlled: true,
                driver: Driver::MickSchumacher,
                network_id: Some(255),
                team: Team::Haas,
                my_team: false,
                race_number: 47,
                nationality: Nationality::German,
                name: "SCHUMACHER".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::KimiRaikkonen,
                network_id: Some(255),
                team: Team::AlfaRomeo,
                my_team: false,
                race_number: 7,
                nationality: Nationality::Finnish,
                name: "RÄIKKÖNEN".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::AntonioGiovinazzi,
                network_id: Some(255),
                team: Team::AlfaRomeo,
                my_team: false,
                race_number: 99,
                nationality: Nationality::Italian,
                name: "GIOVINAZZI".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::PierreGasly,
                network_id: Some(255),
                team: Team::AlphaTauri,
                my_team: false,
                race_number: 10,
                nationality: Nationality::French,
                name: "GASLY".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::LandoNorris,
                network_id: Some(255),
                team: Team::McLaren,
                my_team: false,
                race_number: 4,
                nationality: Nationality::British,
                name: "NORRIS".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::NicholasLatifi,
                network_id: Some(255),
                team: Team::Williams,
                my_team: false,
                race_number: 6,
                nationality: Nationality::Canadian,
                name: "LATIFI".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::FernandoAlonso,
                network_id: Some(255),
                team: Team::Alpine,
                my_team: false,
                race_number: 14,
                nationality: Nationality::Spanish,
                name: "ALONSO".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::DanielRicciardo,
                network_id: Some(255),
                team: Team::McLaren,
                my_team: false,
                race_number: 3,
                nationality: Nationality::Australian,
                name: "RICCIARDO".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::CharlesLeclerc,
                network_id: Some(255),
                team: Team::Ferrari,
                my_team: false,
                race_number: 16,
                nationality: Nationality::Monegasque,
                name: "LECLERC".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::LewisHamilton,
                network_id: Some(255),
                team: Team::Mercedes,
                my_team: false,
                race_number: 44,
                nationality: Nationality::British,
                name: "HAMILTON".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::YukiTsunoda,
                network_id: Some(255),
                team: Team::AlphaTauri,
                my_team: false,
                race_number: 22,
                nationality: Nationality::Japanese,
                name: "TSUNODA".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::GeorgeRussell,
                network_id: Some(255),
                team: Team::Williams,
                my_team: false,
                race_number: 63,
                nationality: Nationality::British,
                name: "RUSSELL".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::ValtteriBottas,
                network_id: Some(255),
                team: Team::Mercedes,
                my_team: false,
                race_number: 77,
                nationality: Nationality::Finnish,
                name: "BOTTAS".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::CarlosSainz,
                network_id: Some(255),
                team: Team::Ferrari,
                my_team: false,
                race_number: 55,
                nationality: Nationality::Spanish,
                name: "SAINZ".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::SergioPerez,
                network_id: Some(255),
                team: Team::RedBullRacing,
                my_team: false,
                race_number: 11,
                nationality: Nationality::Mexican,
                name: "PEREZ".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::LanceStroll,
                network_id: Some(255),
                team: Team::AstonMartin,
                my_team: false,
                race_number: 18,
                nationality: Nationality::Canadian,
                name: "STROLL".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::SebastianVettel,
                network_id: Some(255),
                team: Team::AstonMartin,
                my_team: false,
                race_number: 5,
                nationality: Nationality::German,
                name: "VETTEL".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::NikitaMazepin,
                network_id: Some(255),
                team: Team::Haas,
                my_team: false,
                race_number: 9,
                nationality: Nationality::Invalid,
                name: "MAZEPIN".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: true,
                driver: Driver::EstebanOcon,
                network_id: Some(255),
                team: Team::Alpine,
                my_team: false,
                race_number: 31,
                nationality: Nationality::French,
                name: "OCON".to_string(),
                telemetry_access: Telemetry::Public,
            },
            ParticipantData {
                ai_controlled: false,
                driver: Driver::MaxVerstappen,
                network_id: Some(255),
                team: Team::RedBullRacing,
                my_team: false,
                race_number: 33,
                nationality: Nationality::Dutch,
                name: "VERSTAPPEN".to_string(),
                telemetry_access: Telemetry::Restricted,
            },
            ParticipantData {
                ai_controlled: false,
                driver: Driver::Player,
                network_id: Some(255),
                team: Team::MyTeam,
                my_team: false,
                race_number: 0,
                nationality: Nationality::Invalid,
                name: "".to_string(),
                telemetry_access: Telemetry::Restricted,
            },
            ParticipantData {
                ai_controlled: false,
                driver: Driver::Player,
                network_id: Some(255),
                team: Team::MyTeam,
                my_team: false,
                race_number: 0,
                nationality: Nationality::Invalid,
                name: "".to_string(),
                telemetry_access: Telemetry::Restricted,
            },
        ],
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2021_car_setups_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e507011201052e324e2ac5eb38ad10e997421b06000013ff08084b4b000040c09a9999bfec51b83d86ebd13e0802080103075f3acdccb841cdccb8419a99b1419a99b141060000c04008084b4b000040c09a9999bfec51b83d86ebd13e0802080103075f3acdccb841cdccb8419a99b1419a99b141060000c04008084b4b000040c09a9999bfec51b83d86ebd13e0802080103075f3acdccb841cdccb8419a99b1419a99b141060000c04008084b4b000040c09a9999bfec51b83d86ebd13e0802080103075f3acdccb841cdccb8419a99b1419a99b141060000c04008084b4b000040c09a9999bfec51b83d86ebd13e0802080103075f3acdccb841cdccb8419a99b1419a99b141060000c04008084b4b000040c09a9999bfec51b83d86ebd13e0802080103075f3acdccb841cdccb8419a99b1419a99b141060000c04008084b4b000040c09a9999bfec51b83d86ebd13e0802080103075f3acdccb841cdccb8419a99b1419a99b141060000c04008084b4b000040c09a9999bfec51b83d86ebd13e0802080103075f3acdccb841cdccb8419a99b1419a99b141060000c04008084b4b000040c09a9999bfec51b83d86ebd13e0802080103075f3acdccb841cdccb8419a99b1419a99b141060000c04008084b4b000040c09a9999bfec51b83d86ebd13e0802080103075f3acdccb841cdccb8419a99b1419a99b141060000c04008084b4b000040c09a9999bfec51b83d86ebd13e0802080103075f3acdccb841cdccb8419a99b1419a99b141060000c04008084b4b000040c09a9999bfec51b83d86ebd13e0802080103075f3acdccb841cdccb8419a99b1419a99b141060000c04008084b4b000040c09a9999bfec51b83d86ebd13e0802080103075f3acdccb841cdccb8419a99b1419a99b141060000c04008084b4b000040c09a9999bfec51b83d86ebd13e0802080103075f3acdccb841cdccb8419a99b1419a99b141060000c04008084b4b000040c09a9999bfec51b83d86ebd13e0802080103075f3acdccb841cdccb8419a99b1419a99b141060000c04008084b4b000040c09a9999bfec51b83d86ebd13e0802080103075f3acdccb841cdccb8419a99b1419a99b141060000c04008084b4b000040c09a9999bfec51b83d86ebd13e0802080103075f3acdccb841cdccb8419a99b1419a99b141060000c04008084b4b000040c09a9999bfec51b83d86ebd13e0802080103075f3acdccb841cdccb8419a99b1419a99b141060000c04008084b4b000040c09a9999bfec51b83d86ebd13e0802080103075f3acdccb841cdccb8419a99b1419a99b141060000c04008084b4b000040c09a9999bfec51b83d86ebd13e0802080103075f3acdccb841cdccb8419a99b1419a99b141060000c0400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::CarSetups(s) => s,
        _ => panic!("Invalid packet. Expected CarSetups, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2021);

    let expected = PacketCarSetupData {
        header: actual.header.clone(),
        car_setups: vec![
            CarSetupData {
                front_wing: 8,
                rear_wing: 8,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.2,
                front_toe: 0.09,
                rear_toe: 0.41000003,
                front_suspension: 8,
                rear_suspension: 2,
                front_anti_roll_bar: 8,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 7,
                brake_pressure: 95,
                brake_bias: 58,
                tyres_pressure: WheelData {
                    rear_left: 23.1,
                    rear_right: 23.1,
                    front_left: 22.2,
                    front_right: 22.2,
                },
                ballast: 6,
                fuel_load: 6.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 8,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.2,
                front_toe: 0.09,
                rear_toe: 0.41000003,
                front_suspension: 8,
                rear_suspension: 2,
                front_anti_roll_bar: 8,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 7,
                brake_pressure: 95,
                brake_bias: 58,
                tyres_pressure: WheelData {
                    rear_left: 23.1,
                    rear_right: 23.1,
                    front_left: 22.2,
                    front_right: 22.2,
                },
                ballast: 6,
                fuel_load: 6.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 8,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.2,
                front_toe: 0.09,
                rear_toe: 0.41000003,
                front_suspension: 8,
                rear_suspension: 2,
                front_anti_roll_bar: 8,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 7,
                brake_pressure: 95,
                brake_bias: 58,
                tyres_pressure: WheelData {
                    rear_left: 23.1,
                    rear_right: 23.1,
                    front_left: 22.2,
                    front_right: 22.2,
                },
                ballast: 6,
                fuel_load: 6.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 8,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.2,
                front_toe: 0.09,
                rear_toe: 0.41000003,
                front_suspension: 8,
                rear_suspension: 2,
                front_anti_roll_bar: 8,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 7,
                brake_pressure: 95,
                brake_bias: 58,
                tyres_pressure: WheelData {
                    rear_left: 23.1,
                    rear_right: 23.1,
                    front_left: 22.2,
                    front_right: 22.2,
                },
                ballast: 6,
                fuel_load: 6.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 8,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.2,
                front_toe: 0.09,
                rear_toe: 0.41000003,
                front_suspension: 8,
                rear_suspension: 2,
                front_anti_roll_bar: 8,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 7,
                brake_pressure: 95,
                brake_bias: 58,
                tyres_pressure: WheelData {
                    rear_left: 23.1,
                    rear_right: 23.1,
                    front_left: 22.2,
                    front_right: 22.2,
                },
                ballast: 6,
                fuel_load: 6.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 8,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.2,
                front_toe: 0.09,
                rear_toe: 0.41000003,
                front_suspension: 8,
                rear_suspension: 2,
                front_anti_roll_bar: 8,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 7,
                brake_pressure: 95,
                brake_bias: 58,
                tyres_pressure: WheelData {
                    rear_left: 23.1,
                    rear_right: 23.1,
                    front_left: 22.2,
                    front_right: 22.2,
                },
                ballast: 6,
                fuel_load: 6.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 8,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.2,
                front_toe: 0.09,
                rear_toe: 0.41000003,
                front_suspension: 8,
                rear_suspension: 2,
                front_anti_roll_bar: 8,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 7,
                brake_pressure: 95,
                brake_bias: 58,
                tyres_pressure: WheelData {
                    rear_left: 23.1,
                    rear_right: 23.1,
                    front_left: 22.2,
                    front_right: 22.2,
                },
                ballast: 6,
                fuel_load: 6.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 8,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.2,
                front_toe: 0.09,
                rear_toe: 0.41000003,
                front_suspension: 8,
                rear_suspension: 2,
                front_anti_roll_bar: 8,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 7,
                brake_pressure: 95,
                brake_bias: 58,
                tyres_pressure: WheelData {
                    rear_left: 23.1,
                    rear_right: 23.1,
                    front_left: 22.2,
                    front_right: 22.2,
                },
                ballast: 6,
                fuel_load: 6.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 8,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.2,
                front_toe: 0.09,
                rear_toe: 0.41000003,
                front_suspension: 8,
                rear_suspension: 2,
                front_anti_roll_bar: 8,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 7,
                brake_pressure: 95,
                brake_bias: 58,
                tyres_pressure: WheelData {
                    rear_left: 23.1,
                    rear_right: 23.1,
                    front_left: 22.2,
                    front_right: 22.2,
                },
                ballast: 6,
                fuel_load: 6.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 8,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.2,
                front_toe: 0.09,
                rear_toe: 0.41000003,
                front_suspension: 8,
                rear_suspension: 2,
                front_anti_roll_bar: 8,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 7,
                brake_pressure: 95,
                brake_bias: 58,
                tyres_pressure: WheelData {
                    rear_left: 23.1,
                    rear_right: 23.1,
                    front_left: 22.2,
                    front_right: 22.2,
                },
                ballast: 6,
                fuel_load: 6.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 8,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.2,
                front_toe: 0.09,
                rear_toe: 0.41000003,
                front_suspension: 8,
                rear_suspension: 2,
                front_anti_roll_bar: 8,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 7,
                brake_pressure: 95,
                brake_bias: 58,
                tyres_pressure: WheelData {
                    rear_left: 23.1,
                    rear_right: 23.1,
                    front_left: 22.2,
                    front_right: 22.2,
                },
                ballast: 6,
                fuel_load: 6.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 8,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.2,
                front_toe: 0.09,
                rear_toe: 0.41000003,
                front_suspension: 8,
                rear_suspension: 2,
                front_anti_roll_bar: 8,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 7,
                brake_pressure: 95,
                brake_bias: 58,
                tyres_pressure: WheelData {
                    rear_left: 23.1,
                    rear_right: 23.1,
                    front_left: 22.2,
                    front_right: 22.2,
                },
                ballast: 6,
                fuel_load: 6.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 8,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.2,
                front_toe: 0.09,
                rear_toe: 0.41000003,
                front_suspension: 8,
                rear_suspension: 2,
                front_anti_roll_bar: 8,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 7,
                brake_pressure: 95,
                brake_bias: 58,
                tyres_pressure: WheelData {
                    rear_left: 23.1,
                    rear_right: 23.1,
                    front_left: 22.2,
                    front_right: 22.2,
                },
                ballast: 6,
                fuel_load: 6.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 8,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.2,
                front_toe: 0.09,
                rear_toe: 0.41000003,
                front_suspension: 8,
                rear_suspension: 2,
                front_anti_roll_bar: 8,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 7,
                brake_pressure: 95,
                brake_bias: 58,
                tyres_pressure: WheelData {
                    rear_left: 23.1,
                    rear_right: 23.1,
                    front_left: 22.2,
                    front_right: 22.2,
                },
                ballast: 6,
                fuel_load: 6.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 8,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.2,
                front_toe: 0.09,
                rear_toe: 0.41000003,
                front_suspension: 8,
                rear_suspension: 2,
                front_anti_roll_bar: 8,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 7,
                brake_pressure: 95,
                brake_bias: 58,
                tyres_pressure: WheelData {
                    rear_left: 23.1,
                    rear_right: 23.1,
                    front_left: 22.2,
                    front_right: 22.2,
                },
                ballast: 6,
                fuel_load: 6.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 8,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.2,
                front_toe: 0.09,
                rear_toe: 0.41000003,
                front_suspension: 8,
                rear_suspension: 2,
                front_anti_roll_bar: 8,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 7,
                brake_pressure: 95,
                brake_bias: 58,
                tyres_pressure: WheelData {
                    rear_left: 23.1,
                    rear_right: 23.1,
                    front_left: 22.2,
                    front_right: 22.2,
                },
                ballast: 6,
                fuel_load: 6.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 8,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.2,
                front_toe: 0.09,
                rear_toe: 0.41000003,
                front_suspension: 8,
                rear_suspension: 2,
                front_anti_roll_bar: 8,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 7,
                brake_pressure: 95,
                brake_bias: 58,
                tyres_pressure: WheelData {
                    rear_left: 23.1,
                    rear_right: 23.1,
                    front_left: 22.2,
                    front_right: 22.2,
                },
                ballast: 6,
                fuel_load: 6.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 8,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.2,
                front_toe: 0.09,
                rear_toe: 0.41000003,
                front_suspension: 8,
                rear_suspension: 2,
                front_anti_roll_bar: 8,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 7,
                brake_pressure: 95,
                brake_bias: 58,
                tyres_pressure: WheelData {
                    rear_left: 23.1,
                    rear_right: 23.1,
                    front_left: 22.2,
                    front_right: 22.2,
                },
                ballast: 6,
                fuel_load: 6.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 8,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.2,
                front_toe: 0.09,
                rear_toe: 0.41000003,
                front_suspension: 8,
                rear_suspension: 2,
                front_anti_roll_bar: 8,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 7,
                brake_pressure: 95,
                brake_bias: 58,
                tyres_pressure: WheelData {
                    rear_left: 23.1,
                    rear_right: 23.1,
                    front_left: 22.2,
                    front_right: 22.2,
                },
                ballast: 6,
                fuel_load: 6.0,
            },
            CarSetupData {
                front_wing: 8,
                rear_wing: 8,
                on_throttle: 75,
                off_throttle: 75,
                front_camber: -3.0,
                rear_camber: -1.2,
                front_toe: 0.09,
                rear_toe: 0.41000003,
                front_suspension: 8,
                rear_suspension: 2,
                front_anti_roll_bar: 8,
                rear_anti_roll_bar: 1,
                front_suspension_height: 3,
                rear_suspension_height: 7,
                brake_pressure: 95,
                brake_bias: 58,
                tyres_pressure: WheelData {
                    rear_left: 23.1,
                    rear_right: 23.1,
                    front_left: 22.2,
                    front_right: 22.2,
                },
                ballast: 6,
                fuel_load: 6.0,
            },
            CarSetupData::default(),
            CarSetupData::default(),
        ],
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2021_car_telemetry_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e507011201062e324e2ac5eb38ad0f6498422006000013ffdc00d2a8543f59dcac3a0000000000055d2d0146e107e302e202d102cf0251534f525756575559000000ac410000ac410000b8410000b84100000000f1000000803f00000000000000000006462b010b0700d402d302be02bc0252544f525756575659000000ac410000ac410000b8410000b84100000000eb000000803f00000000000000000006212a01000100df02de02cc02ca0252544f525756575559000000ac410000ac410000b8410000b84100000000f6000000803f59dcac3a000000000006272c01240300cd02cb02b502b202535450525756575659000000ac410000ac410000b8410000b84100000000f9000000803f00000080000000000006be2c0134f000c202c002a802a50252544f515756575659000000ac410000ac410000b8410000b84100000000df000000803f59dcac3a000000000005002e0158e37ff202f102e502e302515450525655575559000000ac410000ac410000b8410000b84100000000f2000000803f59dcacba000000000006652b010e0100d302d202bf02bc0253544f525756575659000000ac410000ac410000b8410000b84100000000e9000000803f59dcac3a000000000006e52901001000e602e402d502d302525450525655575559000000ac410000ac410000b8410000b84100000000f1000000803f59dcacba0000000000064b2b010b0100d202d102bd02bb0252544f525656575659000000ac410000ac410000b8410000b84100000000e900e3ca763f00000080000000000006ca2901000000c902c802b102af0251534f515656575659000000ac410000ac410000b8410000b84100000000e0000000803f59dcac3a000000000006f32d0157e31fef02ee02e202df02515450525656575559000000ac410000ac410000b8410000b84100000000ed000000803f000000800000000000067f2a01000300d802d602c402c20252544f525655575559000000ac410000ac410000b8410000b84100000000f5000000803f00000080000000000006e52b011c0f00ce02cc02b702b502535450525656575659000000ac410000ac410000b8410000b84100000000ee000000803f00000080000000000006cf2a01000100d702d502c302c00252544f525656575659000000ac410000ac410000b8410000b84100000000ee000000803f00000000000000000006b12a01000040d702d602c402c102525450525756575659000000ac410000ac410000b8410000b84100000000e0000000803f00000000000000000005382e015fff7ff402f302e702e402525450535656575559000000ac410000ac410000b8410000b84100000000ed000000803f000000000000000000067c2a01000100dc02db02c802c60252544f525655575559000000ac410000ac410000b8410000b84100000000cb00835b673f59dcac3a000000000005fa290100010010030f030c030a03515451545655565559000000ac410000ac410000b8410000b84100000000e5000000803fd355a1bc000000000006332901001f00e802e702d802d502525450525656575559000000ac410000ac410000b8410000b8410000000029010000803f000000000000000000087b280100000049024902f701f70156574d4e5e5c5a5869003fcdb9412390b84140cdb041959aaf4100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffff00").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::CarTelemetry(s) => s,
        _ => panic!("Invalid packet. Expected CarTelemetry, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2021);

    let expected = PacketCarTelemetryData {
        header: actual.header.clone(),
        car_telemetry_data: vec![
            CarTelemetryData {
                speed: 220,
                throttle: 0.830701,
                steer: 0.0013188227,
                brake: 0.0,
                clutch: 0,
                gear: 5,
                engine_rpm: 11613,
                drs: true,
                rev_lights_percent: 70,
                rev_lights_bit_value: Some(2017),
                brakes_temperature: WheelData {
                    rear_left: 739,
                    rear_right: 738,
                    front_left: 721,
                    front_right: 719,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 81,
                    rear_right: 83,
                    front_left: 79,
                    front_right: 82,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 87,
                    rear_right: 86,
                    front_left: 87,
                    front_right: 85,
                },
                engine_temperature: 89,
                tyre_pressures: WheelData {
                    rear_left: 21.5,
                    rear_right: 21.5,
                    front_left: 23.0,
                    front_right: 23.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 241,
                throttle: 1.0,
                steer: 0.0,
                brake: 0.0,
                clutch: 0,
                gear: 6,
                engine_rpm: 11078,
                drs: true,
                rev_lights_percent: 11,
                rev_lights_bit_value: Some(7),
                brakes_temperature: WheelData {
                    rear_left: 724,
                    rear_right: 723,
                    front_left: 702,
                    front_right: 700,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 82,
                    rear_right: 84,
                    front_left: 79,
                    front_right: 82,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 87,
                    rear_right: 86,
                    front_left: 87,
                    front_right: 86,
                },
                engine_temperature: 89,
                tyre_pressures: WheelData {
                    rear_left: 21.5,
                    rear_right: 21.5,
                    front_left: 23.0,
                    front_right: 23.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 235,
                throttle: 1.0,
                steer: 0.0,
                brake: 0.0,
                clutch: 0,
                gear: 6,
                engine_rpm: 10785,
                drs: true,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(1),
                brakes_temperature: WheelData {
                    rear_left: 735,
                    rear_right: 734,
                    front_left: 716,
                    front_right: 714,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 82,
                    rear_right: 84,
                    front_left: 79,
                    front_right: 82,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 87,
                    rear_right: 86,
                    front_left: 87,
                    front_right: 85,
                },
                engine_temperature: 89,
                tyre_pressures: WheelData {
                    rear_left: 21.5,
                    rear_right: 21.5,
                    front_left: 23.0,
                    front_right: 23.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 246,
                throttle: 1.0,
                steer: 0.0013188227,
                brake: 0.0,
                clutch: 0,
                gear: 6,
                engine_rpm: 11303,
                drs: true,
                rev_lights_percent: 36,
                rev_lights_bit_value: Some(3),
                brakes_temperature: WheelData {
                    rear_left: 717,
                    rear_right: 715,
                    front_left: 693,
                    front_right: 690,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 83,
                    rear_right: 84,
                    front_left: 80,
                    front_right: 82,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 87,
                    rear_right: 86,
                    front_left: 87,
                    front_right: 86,
                },
                engine_temperature: 89,
                tyre_pressures: WheelData {
                    rear_left: 21.5,
                    rear_right: 21.5,
                    front_left: 23.0,
                    front_right: 23.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 249,
                throttle: 1.0,
                steer: -0.0,
                brake: 0.0,
                clutch: 0,
                gear: 6,
                engine_rpm: 11454,
                drs: true,
                rev_lights_percent: 52,
                rev_lights_bit_value: Some(240),
                brakes_temperature: WheelData {
                    rear_left: 706,
                    rear_right: 704,
                    front_left: 680,
                    front_right: 677,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 82,
                    rear_right: 84,
                    front_left: 79,
                    front_right: 81,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 87,
                    rear_right: 86,
                    front_left: 87,
                    front_right: 86,
                },
                engine_temperature: 89,
                tyre_pressures: WheelData {
                    rear_left: 21.5,
                    rear_right: 21.5,
                    front_left: 23.0,
                    front_right: 23.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 223,
                throttle: 1.0,
                steer: 0.0013188227,
                brake: 0.0,
                clutch: 0,
                gear: 5,
                engine_rpm: 11776,
                drs: true,
                rev_lights_percent: 88,
                rev_lights_bit_value: Some(32739),
                brakes_temperature: WheelData {
                    rear_left: 754,
                    rear_right: 753,
                    front_left: 741,
                    front_right: 739,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 81,
                    rear_right: 84,
                    front_left: 80,
                    front_right: 82,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 86,
                    rear_right: 85,
                    front_left: 87,
                    front_right: 85,
                },
                engine_temperature: 89,
                tyre_pressures: WheelData {
                    rear_left: 21.5,
                    rear_right: 21.5,
                    front_left: 23.0,
                    front_right: 23.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 242,
                throttle: 1.0,
                steer: -0.0013188227,
                brake: 0.0,
                clutch: 0,
                gear: 6,
                engine_rpm: 11109,
                drs: true,
                rev_lights_percent: 14,
                rev_lights_bit_value: Some(1),
                brakes_temperature: WheelData {
                    rear_left: 723,
                    rear_right: 722,
                    front_left: 703,
                    front_right: 700,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 83,
                    rear_right: 84,
                    front_left: 79,
                    front_right: 82,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 87,
                    rear_right: 86,
                    front_left: 87,
                    front_right: 86,
                },
                engine_temperature: 89,
                tyre_pressures: WheelData {
                    rear_left: 21.5,
                    rear_right: 21.5,
                    front_left: 23.0,
                    front_right: 23.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 233,
                throttle: 1.0,
                steer: 0.0013188227,
                brake: 0.0,
                clutch: 0,
                gear: 6,
                engine_rpm: 10725,
                drs: true,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(16),
                brakes_temperature: WheelData {
                    rear_left: 742,
                    rear_right: 740,
                    front_left: 725,
                    front_right: 723,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 82,
                    rear_right: 84,
                    front_left: 80,
                    front_right: 82,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 86,
                    rear_right: 85,
                    front_left: 87,
                    front_right: 85,
                },
                engine_temperature: 89,
                tyre_pressures: WheelData {
                    rear_left: 21.5,
                    rear_right: 21.5,
                    front_left: 23.0,
                    front_right: 23.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 241,
                throttle: 1.0,
                steer: -0.0013188227,
                brake: 0.0,
                clutch: 0,
                gear: 6,
                engine_rpm: 11083,
                drs: true,
                rev_lights_percent: 11,
                rev_lights_bit_value: Some(1),
                brakes_temperature: WheelData {
                    rear_left: 722,
                    rear_right: 721,
                    front_left: 701,
                    front_right: 699,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 82,
                    rear_right: 84,
                    front_left: 79,
                    front_right: 82,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 86,
                    rear_right: 86,
                    front_left: 87,
                    front_right: 86,
                },
                engine_temperature: 89,
                tyre_pressures: WheelData {
                    rear_left: 21.5,
                    rear_right: 21.5,
                    front_left: 23.0,
                    front_right: 23.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 233,
                throttle: 0.9640333,
                steer: -0.0,
                brake: 0.0,
                clutch: 0,
                gear: 6,
                engine_rpm: 10698,
                drs: true,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 713,
                    rear_right: 712,
                    front_left: 689,
                    front_right: 687,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 81,
                    rear_right: 83,
                    front_left: 79,
                    front_right: 81,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 86,
                    rear_right: 86,
                    front_left: 87,
                    front_right: 86,
                },
                engine_temperature: 89,
                tyre_pressures: WheelData {
                    rear_left: 21.5,
                    rear_right: 21.5,
                    front_left: 23.0,
                    front_right: 23.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 224,
                throttle: 1.0,
                steer: 0.0013188227,
                brake: 0.0,
                clutch: 0,
                gear: 6,
                engine_rpm: 11763,
                drs: true,
                rev_lights_percent: 87,
                rev_lights_bit_value: Some(8163),
                brakes_temperature: WheelData {
                    rear_left: 751,
                    rear_right: 750,
                    front_left: 738,
                    front_right: 735,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 81,
                    rear_right: 84,
                    front_left: 80,
                    front_right: 82,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 86,
                    rear_right: 86,
                    front_left: 87,
                    front_right: 85,
                },
                engine_temperature: 89,
                tyre_pressures: WheelData {
                    rear_left: 21.5,
                    rear_right: 21.5,
                    front_left: 23.0,
                    front_right: 23.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 237,
                throttle: 1.0,
                steer: -0.0,
                brake: 0.0,
                clutch: 0,
                gear: 6,
                engine_rpm: 10879,
                drs: true,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(3),
                brakes_temperature: WheelData {
                    rear_left: 728,
                    rear_right: 726,
                    front_left: 708,
                    front_right: 706,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 82,
                    rear_right: 84,
                    front_left: 79,
                    front_right: 82,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 86,
                    rear_right: 85,
                    front_left: 87,
                    front_right: 85,
                },
                engine_temperature: 89,
                tyre_pressures: WheelData {
                    rear_left: 21.5,
                    rear_right: 21.5,
                    front_left: 23.0,
                    front_right: 23.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 245,
                throttle: 1.0,
                steer: -0.0,
                brake: 0.0,
                clutch: 0,
                gear: 6,
                engine_rpm: 11237,
                drs: true,
                rev_lights_percent: 28,
                rev_lights_bit_value: Some(15),
                brakes_temperature: WheelData {
                    rear_left: 718,
                    rear_right: 716,
                    front_left: 695,
                    front_right: 693,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 83,
                    rear_right: 84,
                    front_left: 80,
                    front_right: 82,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 86,
                    rear_right: 86,
                    front_left: 87,
                    front_right: 86,
                },
                engine_temperature: 89,
                tyre_pressures: WheelData {
                    rear_left: 21.5,
                    rear_right: 21.5,
                    front_left: 23.0,
                    front_right: 23.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 238,
                throttle: 1.0,
                steer: -0.0,
                brake: 0.0,
                clutch: 0,
                gear: 6,
                engine_rpm: 10959,
                drs: true,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(1),
                brakes_temperature: WheelData {
                    rear_left: 727,
                    rear_right: 725,
                    front_left: 707,
                    front_right: 704,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 82,
                    rear_right: 84,
                    front_left: 79,
                    front_right: 82,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 86,
                    rear_right: 86,
                    front_left: 87,
                    front_right: 86,
                },
                engine_temperature: 89,
                tyre_pressures: WheelData {
                    rear_left: 21.5,
                    rear_right: 21.5,
                    front_left: 23.0,
                    front_right: 23.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 238,
                throttle: 1.0,
                steer: 0.0,
                brake: 0.0,
                clutch: 0,
                gear: 6,
                engine_rpm: 10929,
                drs: true,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(16384),
                brakes_temperature: WheelData {
                    rear_left: 727,
                    rear_right: 726,
                    front_left: 708,
                    front_right: 705,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 82,
                    rear_right: 84,
                    front_left: 80,
                    front_right: 82,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 87,
                    rear_right: 86,
                    front_left: 87,
                    front_right: 86,
                },
                engine_temperature: 89,
                tyre_pressures: WheelData {
                    rear_left: 21.5,
                    rear_right: 21.5,
                    front_left: 23.0,
                    front_right: 23.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 224,
                throttle: 1.0,
                steer: 0.0,
                brake: 0.0,
                clutch: 0,
                gear: 5,
                engine_rpm: 11832,
                drs: true,
                rev_lights_percent: 95,
                rev_lights_bit_value: Some(32767),
                brakes_temperature: WheelData {
                    rear_left: 756,
                    rear_right: 755,
                    front_left: 743,
                    front_right: 740,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 82,
                    rear_right: 84,
                    front_left: 80,
                    front_right: 83,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 86,
                    rear_right: 86,
                    front_left: 87,
                    front_right: 85,
                },
                engine_temperature: 89,
                tyre_pressures: WheelData {
                    rear_left: 21.5,
                    rear_right: 21.5,
                    front_left: 23.0,
                    front_right: 23.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 237,
                throttle: 1.0,
                steer: 0.0,
                brake: 0.0,
                clutch: 0,
                gear: 6,
                engine_rpm: 10876,
                drs: true,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(1),
                brakes_temperature: WheelData {
                    rear_left: 732,
                    rear_right: 731,
                    front_left: 712,
                    front_right: 710,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 82,
                    rear_right: 84,
                    front_left: 79,
                    front_right: 82,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 86,
                    rear_right: 85,
                    front_left: 87,
                    front_right: 85,
                },
                engine_temperature: 89,
                tyre_pressures: WheelData {
                    rear_left: 21.5,
                    rear_right: 21.5,
                    front_left: 23.0,
                    front_right: 23.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 203,
                throttle: 0.9037401,
                steer: 0.0013188227,
                brake: 0.0,
                clutch: 0,
                gear: 5,
                engine_rpm: 10746,
                drs: true,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(1),
                brakes_temperature: WheelData {
                    rear_left: 784,
                    rear_right: 783,
                    front_left: 780,
                    front_right: 778,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 81,
                    rear_right: 84,
                    front_left: 81,
                    front_right: 84,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 86,
                    rear_right: 85,
                    front_left: 86,
                    front_right: 85,
                },
                engine_temperature: 89,
                tyre_pressures: WheelData {
                    rear_left: 21.5,
                    rear_right: 21.5,
                    front_left: 23.0,
                    front_right: 23.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 229,
                throttle: 1.0,
                steer: -0.019694244,
                brake: 0.0,
                clutch: 0,
                gear: 6,
                engine_rpm: 10547,
                drs: true,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(31),
                brakes_temperature: WheelData {
                    rear_left: 744,
                    rear_right: 743,
                    front_left: 728,
                    front_right: 725,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 82,
                    rear_right: 84,
                    front_left: 80,
                    front_right: 82,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 86,
                    rear_right: 86,
                    front_left: 87,
                    front_right: 85,
                },
                engine_temperature: 89,
                tyre_pressures: WheelData {
                    rear_left: 21.5,
                    rear_right: 21.5,
                    front_left: 23.0,
                    front_right: 23.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 297,
                throttle: 1.0,
                steer: 0.0,
                brake: 0.0,
                clutch: 0,
                gear: 8,
                engine_rpm: 10363,
                drs: true,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 585,
                    rear_right: 585,
                    front_left: 503,
                    front_right: 503,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 86,
                    rear_right: 87,
                    front_left: 77,
                    front_right: 78,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 94,
                    rear_right: 92,
                    front_left: 90,
                    front_right: 88,
                },
                engine_temperature: 105,
                tyre_pressures: WheelData {
                    rear_left: 23.225218,
                    rear_right: 23.07038,
                    front_left: 22.10022,
                    front_right: 21.95048,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 0,
                throttle: 0.0,
                steer: 0.0,
                brake: 0.0,
                clutch: 0,
                gear: 0,
                engine_rpm: 0,
                drs: false,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                engine_temperature: 0,
                tyre_pressures: WheelData {
                    rear_left: 0.0,
                    rear_right: 0.0,
                    front_left: 0.0,
                    front_right: 0.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
            CarTelemetryData {
                speed: 0,
                throttle: 0.0,
                steer: 0.0,
                brake: 0.0,
                clutch: 0,
                gear: 0,
                engine_rpm: 0,
                drs: false,
                rev_lights_percent: 0,
                rev_lights_bit_value: Some(0),
                brakes_temperature: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                tyres_surface_temperature: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                tyres_inner_temperature: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                engine_temperature: 0,
                tyre_pressures: WheelData {
                    rear_left: 0.0,
                    rear_right: 0.0,
                    front_left: 0.0,
                    front_right: 0.0,
                },
                surface_types: WheelData {
                    rear_left: SurfaceType::Tarmac,
                    rear_right: SurfaceType::Tarmac,
                    front_left: SurfaceType::Tarmac,
                    front_right: SurfaceType::Tarmac,
                },
            },
        ],
        button_status: None,
        mfd_panel: MFDPanel::Closed,
        secondary_player_mfd_panel: MFDPanel::Closed,
        suggested_gear: Some(0),
    };

    assert_eq!(actual, expected)
}

#[tokio::test]
async fn test_parse_2021_car_status_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e507011201072e324e2ac5eb38ad0f6498422006000013ff0001013c00b51494400000dc4224ca4540c832cc1009000000101000008c7c4b4a02425396494e04b74931383b4a000001013c004ea493400000dc42b0304540c832cc10090000001010000042a9434a0219d4954990f3af496c4e3e4a000001013c0048d593400000dc428d734540c832cc100900000010100000bb4e464a02847496496827b049a38d3c4a000001013c00780693400000dc4237594440c832cc1009000000101000001b44444a02268b98492517bd492eed3e4a000001013c00b8ca92400000dc42a5074440c832cc1009000000101000004ee5424a02636b984984fdba496f24404a000001013c00e24494400000dc42e80b4640c832cc1009000000101000003dfe484a02fd41964912cbb04932913a4a000001013c00b83993400000dc422e9f4440c832cc1009000000101000003271454a02e35e9849ef96bd495d6f3d4a000001013c009b9593400000dc429f1c4540c832cc1009000000101000009e0f494a0255db98492443be49ddd43b4a000001013c00f28693400000dc429c084540c832cc1009000000101000005ad3454a02ff2a9849cb82b24955973e4a000001013c00c99993400000dc4254224540c832cc1009000000101000005df2484a021fc09849ef22b7499c8d3e4a000001013c00abe193400000dc4276844540c832cc10090000001010000076774a4a0272e39849e672bf495699394a000001013c007b5493400000dc42b7c34440c832cc100900000010100000d9f3444a0233a5984990b7b8493f953c4a000001013c00448593400000dc4251064540c832cc100900000010100000db66444a02af6f98491a21af49f0ef3e4a000001013c00fd5593400000dc42c6c54440c832cc1009000000101000001d90454a021a9e9849b147bb49f8c23c4a000001013c00d68393400000dc425d044540c832cc100900000010100000156c464a0289659849c656be49add73c4a000001013c000b4c94400000dc42af154640c832cc1009000000101000004d374b4a02b34f9649e52fb649c6a1394a000001013c00385e93400000dc4202d14440c832cc1009000000101000005a88464a02e3ff9849f83fbe491cfd3c4a000001013c00051695400000dc426b294740c832cc10090000001010000055374f4a02bbf19249d200b949b4e0344a000001013c00fb1094400000dc420dc54540c832cc100900000010100000d2b8474a02ef3e964928f9b04911f73a4a000101013a0061028c400000dc4237c53a40c832cc100900000010100000345f094a022eb0a2490b4782490946664a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::CarStatus(s) => s,
        _ => panic!("Invalid packet. Expected CarStatus, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2021);

    let expected = PacketCarStatusData {
        header: actual.header.clone(),
        car_status_data: vec![
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 4.6275277,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 3.0904627,
                max_rpm: 13000,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C5,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3333923.0,
                ers_deploy_mode: ERSDeployMode::Hotlap,
                ers_harvested_this_lap_mguk: 1231464.3,
                ers_harvested_this_lap_mguh: 1499273.8,
                ers_deployed_this_lap: 3067404.3,
                network_paused: false,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 4.6138067,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 3.0810966,
                max_rpm: 13000,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C5,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3205712.5,
                ers_deploy_mode: ERSDeployMode::Hotlap,
                ers_harvested_this_lap_mguk: 1227395.1,
                ers_harvested_this_lap_mguh: 1441394.0,
                ers_deployed_this_lap: 3117979.0,
                network_paused: false,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 4.6197853,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 3.0851777,
                max_rpm: 13000,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C5,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3249070.8,
                ers_deploy_mode: ERSDeployMode::Hotlap,
                ers_harvested_this_lap_mguk: 1232528.5,
                ers_harvested_this_lap_mguh: 1443053.0,
                ers_deployed_this_lap: 3089256.8,
                network_paused: false,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 4.5945396,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 3.0679452,
                max_rpm: 13000,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C5,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3215622.8,
                ers_deploy_mode: ERSDeployMode::Hotlap,
                ers_harvested_this_lap_mguk: 1249636.8,
                ers_harvested_this_lap_mguh: 1549028.6,
                ers_deployed_this_lap: 3128139.5,
                network_paused: false,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 4.587246,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 3.0629666,
                max_rpm: 13000,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C5,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3193171.5,
                ers_deploy_mode: ERSDeployMode::Hotlap,
                ers_harvested_this_lap_mguk: 1248620.4,
                ers_harvested_this_lap_mguh: 1531824.5,
                ers_deployed_this_lap: 3148059.8,
                network_paused: false,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 4.6334085,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 3.0944767,
                max_rpm: 13000,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C5,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3293071.3,
                ers_deploy_mode: ERSDeployMode::Hotlap,
                ers_harvested_this_lap_mguk: 1230911.6,
                ers_harvested_this_lap_mguh: 1448290.3,
                ers_deployed_this_lap: 3056716.5,
                network_paused: false,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 4.6007957,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 3.0722156,
                max_rpm: 13000,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C5,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3234892.5,
                ers_deploy_mode: ERSDeployMode::Hotlap,
                ers_harvested_this_lap_mguk: 1248220.4,
                ers_harvested_this_lap_mguh: 1553117.9,
                ers_deployed_this_lap: 3103703.3,
                network_paused: false,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 4.6120124,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 3.079872,
                max_rpm: 13000,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C5,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3294183.5,
                ers_deploy_mode: ERSDeployMode::Hotlap,
                ers_harvested_this_lap_mguk: 1252202.6,
                ers_harvested_this_lap_mguh: 1558628.5,
                ers_deployed_this_lap: 3077431.3,
                network_paused: false,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 4.610223,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 3.0786505,
                max_rpm: 13000,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C5,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3241174.5,
                ers_deploy_mode: ERSDeployMode::Hotlap,
                ers_harvested_this_lap_mguk: 1246559.9,
                ers_harvested_this_lap_mguh: 1462361.4,
                ers_deployed_this_lap: 3122645.3,
                network_paused: false,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 4.6125226,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 3.0802202,
                max_rpm: 13000,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C5,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3292311.3,
                ers_deploy_mode: ERSDeployMode::Hotlap,
                ers_harvested_this_lap_mguk: 1251331.9,
                ers_harvested_this_lap_mguh: 1500253.9,
                ers_deployed_this_lap: 3122023.0,
                network_paused: false,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 4.6212974,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 3.0862098,
                max_rpm: 13000,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C5,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3317213.5,
                ers_deploy_mode: ERSDeployMode::Hotlap,
                ers_harvested_this_lap_mguk: 1252462.3,
                ers_harvested_this_lap_mguh: 1568348.8,
                ers_deployed_this_lap: 3040853.5,
                network_paused: false,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 4.6040626,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 3.0744455,
                max_rpm: 13000,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C5,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3226870.3,
                ers_deploy_mode: ERSDeployMode::Hotlap,
                ers_harvested_this_lap_mguk: 1250470.4,
                ers_harvested_this_lap_mguh: 1513202.0,
                ers_deployed_this_lap: 3089743.8,
                network_paused: false,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 4.610018,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 3.0785105,
                max_rpm: 13000,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C5,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3217846.8,
                ers_deploy_mode: ERSDeployMode::Hotlap,
                ers_harvested_this_lap_mguk: 1248757.9,
                ers_harvested_this_lap_mguh: 1434659.3,
                ers_deployed_this_lap: 3128316.0,
                network_paused: false,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 4.6042466,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 3.0745711,
                max_rpm: 13000,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C5,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3236871.3,
                ers_deploy_mode: ERSDeployMode::Hotlap,
                ers_harvested_this_lap_mguk: 1250243.3,
                ers_harvested_this_lap_mguh: 1534198.1,
                ers_deployed_this_lap: 3092670.0,
                network_paused: false,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 4.6098433,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 3.0783913,
                max_rpm: 13000,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C5,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3250949.3,
                ers_deploy_mode: ERSDeployMode::Hotlap,
                ers_harvested_this_lap_mguk: 1248433.1,
                ers_harvested_this_lap_mguh: 1559256.8,
                ers_deployed_this_lap: 3093995.3,
                network_paused: false,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 4.6342826,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 3.0950735,
                max_rpm: 13000,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C5,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3329491.3,
                ers_deploy_mode: ERSDeployMode::Hotlap,
                ers_harvested_this_lap_mguk: 1231350.4,
                ers_harvested_this_lap_mguh: 1492476.6,
                ers_deployed_this_lap: 3041393.5,
                network_paused: false,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 4.6052513,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 3.0752568,
                max_rpm: 13000,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C5,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3252758.5,
                ers_deploy_mode: ERSDeployMode::Hotlap,
                ers_harvested_this_lap_mguk: 1253372.4,
                ers_harvested_this_lap_mguh: 1558527.0,
                ers_deployed_this_lap: 3096391.0,
                network_paused: false,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 4.658938,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 3.111903,
                max_rpm: 13000,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C5,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3395029.3,
                ers_deploy_mode: ERSDeployMode::Hotlap,
                ers_harvested_this_lap_mguk: 1203767.4,
                ers_harvested_this_lap_mguh: 1515546.3,
                ers_deployed_this_lap: 2963501.0,
                network_paused: false,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 60,
                pit_limiter: false,
                fuel_in_tank: 4.627073,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 3.090152,
                max_rpm: 13000,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C5,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 3272244.5,
                ers_deploy_mode: ERSDeployMode::Hotlap,
                ers_harvested_this_lap_mguk: 1230813.9,
                ers_harvested_this_lap_mguh: 1449765.0,
                ers_deployed_this_lap: 3063236.3,
                network_paused: false,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Low,
                anti_lock_brakes: true,
                fuel_mix: FuelMix::Standard,
                front_brake_bias: 58,
                pit_limiter: false,
                fuel_in_tank: 4.3752904,
                fuel_capacity: 110.0,
                fuel_remaining_laps: 2.918287,
                max_rpm: 13000,
                idle_rpm: 4300,
                max_gears: 9,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::C5,
                visual_tyre_compound: TyreCompoundVisual::Soft,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 2250701.0,
                ers_deploy_mode: ERSDeployMode::Hotlap,
                ers_harvested_this_lap_mguk: 1332741.8,
                ers_harvested_this_lap_mguh: 1067233.4,
                ers_deployed_this_lap: 3772802.3,
                network_paused: false,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: false,
                fuel_mix: FuelMix::Lean,
                front_brake_bias: 0,
                pit_limiter: false,
                fuel_in_tank: 0.0,
                fuel_capacity: 0.0,
                fuel_remaining_laps: 0.0,
                max_rpm: 0,
                idle_rpm: 0,
                max_gears: 0,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::Invalid,
                visual_tyre_compound: TyreCompoundVisual::Invalid,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 0.0,
                ers_deploy_mode: ERSDeployMode::None,
                ers_harvested_this_lap_mguk: 0.0,
                ers_harvested_this_lap_mguh: 0.0,
                ers_deployed_this_lap: 0.0,
                network_paused: false,
                ..Default::default()
            },
            CarStatusData {
                traction_control: TractionControl::Off,
                anti_lock_brakes: false,
                fuel_mix: FuelMix::Lean,
                front_brake_bias: 0,
                pit_limiter: false,
                fuel_in_tank: 0.0,
                fuel_capacity: 0.0,
                fuel_remaining_laps: 0.0,
                max_rpm: 0,
                idle_rpm: 0,
                max_gears: 0,
                drs_status: DRS::NotAllowed,
                drs_activation_distance: Some(0),
                actual_tyre_compound: TyreCompound::Invalid,
                visual_tyre_compound: TyreCompoundVisual::Invalid,
                tyre_age_laps: Some(0),
                vehicle_fia_flag: Flag::None,
                ers_store_energy: 0.0,
                ers_deploy_mode: ERSDeployMode::None,
                ers_harvested_this_lap_mguk: 0.0,
                ers_harvested_this_lap_mguh: 0.0,
                ers_deployed_this_lap: 0.0,
                network_paused: false,
                ..Default::default()
            },
        ],
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2021_final_classification_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e507011201082e324e2ac5eb38ad000000000000000013ff140e0101000003f02d0100000000a0f152534000000110000000000000001000000000000000070101000003f82c0100000000c019435340000001100000000000000010000000000000000d0101000003a62d010000000080444e5340000001100000000000000010000000000000000401010000037a2c010000000060023b534000000110000000000000001000000000000000020101000003d12b0100000000603830534000000110000000000000001000000000000000130101000003262f010000000020d3665340000001100000000000000010000000000000000801010000030e2d0100000000207d445340000001100000000000000010000000000000000f0101000003352e0100000000406257534000000110000000000000001000000000000000060101000003f52c0100000000a0e2425340000001100000000000000010000000000000000301010000033d2c0100000000001d37534000000110000000000000001000000000000000110101000003ed2e0100000000a026635340000001100000000000000010000000000000000b0101000003632d0100000000c0f349534000000110000000000000001000000000000000050101000003ac2c010000000000443e5340000001100000000000000010000000000000000901010000033e2d0100000000008e475340000001100000000000000010000000000000000a0101000003512d010000000020d4485340000001100000000000000010000000000000001201010000030f2f01000000004053655340000001100000000000000010000000000000000c0101000003712d0100000000a0de4a5340000001100000000000000010000000000000001401010000034f31010000000040368a534000000110000000000000001000000000000000100101000003512e0100000000c0325953400000011000000000000000100000000000000001010000000375200100000000801c765240000001100000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::FinalClassification(s) => s,
        _ => panic!("Invalid packet. Expected LobbyInfo, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2021);

    let expected = PacketFinalClassificationData {
        header: actual.header.clone(),
        num_cars: 20,
        final_classifications: vec![
            FinalClassification {
                position: 14,
                num_laps: 1,
                grid_position: 1,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 77296,
                total_race_time: 77295,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C5,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                ..Default::default()
            },
            FinalClassification {
                position: 7,
                num_laps: 1,
                grid_position: 1,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 77048,
                total_race_time: 77048,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C5,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                ..Default::default()
            },
            FinalClassification {
                position: 13,
                num_laps: 1,
                grid_position: 1,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 77222,
                total_race_time: 77222,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C5,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                ..Default::default()
            },
            FinalClassification {
                position: 4,
                num_laps: 1,
                grid_position: 1,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 76922,
                total_race_time: 76922,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C5,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                ..Default::default()
            },
            FinalClassification {
                position: 2,
                num_laps: 1,
                grid_position: 1,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 76753,
                total_race_time: 76753,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C5,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                ..Default::default()
            },
            FinalClassification {
                position: 19,
                num_laps: 1,
                grid_position: 1,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 77606,
                total_race_time: 77606,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C5,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                ..Default::default()
            },
            FinalClassification {
                position: 8,
                num_laps: 1,
                grid_position: 1,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 77070,
                total_race_time: 77070,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C5,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                ..Default::default()
            },
            FinalClassification {
                position: 15,
                num_laps: 1,
                grid_position: 1,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 77365,
                total_race_time: 77365,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C5,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                ..Default::default()
            },
            FinalClassification {
                position: 6,
                num_laps: 1,
                grid_position: 1,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 77045,
                total_race_time: 77045,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C5,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                ..Default::default()
            },
            FinalClassification {
                position: 3,
                num_laps: 1,
                grid_position: 1,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 76861,
                total_race_time: 76861,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C5,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                ..Default::default()
            },
            FinalClassification {
                position: 17,
                num_laps: 1,
                grid_position: 1,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 77549,
                total_race_time: 77549,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C5,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                ..Default::default()
            },
            FinalClassification {
                position: 11,
                num_laps: 1,
                grid_position: 1,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 77155,
                total_race_time: 77155,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C5,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                ..Default::default()
            },
            FinalClassification {
                position: 5,
                num_laps: 1,
                grid_position: 1,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 76972,
                total_race_time: 76972,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C5,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                ..Default::default()
            },
            FinalClassification {
                position: 9,
                num_laps: 1,
                grid_position: 1,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 77118,
                total_race_time: 77118,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C5,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                ..Default::default()
            },
            FinalClassification {
                position: 10,
                num_laps: 1,
                grid_position: 1,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 77137,
                total_race_time: 77137,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C5,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                ..Default::default()
            },
            FinalClassification {
                position: 18,
                num_laps: 1,
                grid_position: 1,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 77583,
                total_race_time: 77583,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C5,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                ..Default::default()
            },
            FinalClassification {
                position: 12,
                num_laps: 1,
                grid_position: 1,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 77169,
                total_race_time: 77169,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C5,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                ..Default::default()
            },
            FinalClassification {
                position: 20,
                num_laps: 1,
                grid_position: 1,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 78159,
                total_race_time: 78159,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C5,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                ..Default::default()
            },
            FinalClassification {
                position: 16,
                num_laps: 1,
                grid_position: 1,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 77393,
                total_race_time: 77393,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C5,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                ..Default::default()
            },
            FinalClassification {
                position: 1,
                num_laps: 1,
                grid_position: 0,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Finished,
                best_lap_time: 73845,
                total_race_time: 73845,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 1,
                tyre_stints_actual: vec![
                    TyreCompound::C5,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Soft,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                ..Default::default()
            },
            FinalClassification {
                position: 0,
                num_laps: 0,
                grid_position: 0,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Invalid,
                best_lap_time: 0,
                total_race_time: 0,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 0,
                tyre_stints_actual: vec![
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                ..Default::default()
            },
            FinalClassification {
                position: 0,
                num_laps: 0,
                grid_position: 0,
                points: 0,
                num_pit_stops: 0,
                result_status: ResultStatus::Invalid,
                best_lap_time: 0,
                total_race_time: 0,
                penalties_time: 0,
                num_penalties: 0,
                num_tyre_stints: 0,
                tyre_stints_actual: vec![
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                    TyreCompound::Invalid,
                ],
                tyre_stints_visual: vec![
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                    TyreCompoundVisual::Invalid,
                ],
                ..Default::default()
            },
        ],
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2021_lobby_info_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e507011201090000000000000000000000000000000000001401290a4172726f6e204241524e4553000000000000000000000000000000000000000000000000000000000000000000000000470001290a4d617274696e2047494c4553000000000000000000000000000000000000000000000000000000000000000000000000460001290a416c6578204d55525241590000000000000000000000000000000000000000000000000000000000000000000000000028000129044c7563617320524f544800000000000000000000000000000000000000000000000000000000000000000000000000005f0001290949676f7220434f52524549410000000000000000000000000000000000000000000000000000000000000000000000004f0001291c536f70686965204c4556415353455552000000000000000000000000000000000000000000000000000000000000000035000129044a6f6e6173205343484946464552000000000000000000000000000000000000000000000000000000000000000000004c0001291c416c61696e20464f52455354000000000000000000000000000000000000000000000000000000000000000000000000500001290d4a6179204c45544f55524e45415500000000000000000000000000000000000000000000000000000000000000000000440001291b4573746f20534141524900000000000000000000000000000000000000000000000000000000000000000000000000001c000129065961736172204154495945480000000000000000000000000000000000000000000000000000000000000000000000002d0001292b4e616f746120495a554d49000000000000000000000000000000000000000000000000000000000000000000000000002a0001291d57696c68656c6d204b4155464d414e4e00000000000000000000000000000000000000000000000000000000000000002f000129154d61726965204c41555253454e0000000000000000000000000000000000000000000000000000000000000000000000410001294d466c6176696f204e49455645530000000000000000000000000000000000000000000000000000000000000000000000240001294350657465722042454c4f55534f5600000000000000000000000000000000000000000000000000000000000000000000570001293f4b6c696d656b204d494348414c534b490000000000000000000000000000000000000000000000000000000000000000200001291053616e746961676f204d4f52454e4f0000000000000000000000000000000000000000000000000000000000000000003c0001290742656e6a616d696e20434f5050454e530000000000000000000000000000000000000000000000000000000000000000360000ff0d506c617965720000000000000000000000000000000000000000000000000000000000000000000000000000000000002a0000ff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::LobbyInfo(s) => s,
        _ => panic!("Invalid packet. Expected LobbyInfo, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2021);

    let expected = PacketLobbyInfoData {
        header: actual.header.clone(),
        num_players: 20,
        players: vec![
            Player {
                ai_controlled: true,
                team: Team::F1GenericCar,
                nationality: Nationality::British,
                name: "Arron BARNES".to_string(),
                car_number: Some(71),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1GenericCar,
                nationality: Nationality::British,
                name: "Martin GILES".to_string(),
                car_number: Some(70),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1GenericCar,
                nationality: Nationality::British,
                name: "Alex MURRAY".to_string(),
                car_number: Some(40),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1GenericCar,
                nationality: Nationality::Austrian,
                name: "Lucas ROTH".to_string(),
                car_number: Some(95),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1GenericCar,
                nationality: Nationality::Brazilian,
                name: "Igor CORREIA".to_string(),
                car_number: Some(79),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1GenericCar,
                nationality: Nationality::French,
                name: "Sophie LEVASSEUR".to_string(),
                car_number: Some(53),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1GenericCar,
                nationality: Nationality::Austrian,
                name: "Jonas SCHIFFER".to_string(),
                car_number: Some(76),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1GenericCar,
                nationality: Nationality::French,
                name: "Alain FOREST".to_string(),
                car_number: Some(80),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1GenericCar,
                nationality: Nationality::Canadian,
                name: "Jay LETOURNEAU".to_string(),
                car_number: Some(68),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1GenericCar,
                nationality: Nationality::Finnish,
                name: "Esto SAARI".to_string(),
                car_number: Some(28),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1GenericCar,
                nationality: Nationality::Bahraini,
                name: "Yasar ATIYEH".to_string(),
                car_number: Some(45),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1GenericCar,
                nationality: Nationality::Japanese,
                name: "Naota IZUMI".to_string(),
                car_number: Some(42),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1GenericCar,
                nationality: Nationality::German,
                name: "Wilhelm KAUFMANN".to_string(),
                car_number: Some(47),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1GenericCar,
                nationality: Nationality::Danish,
                name: "Marie LAURSEN".to_string(),
                car_number: Some(65),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1GenericCar,
                nationality: Nationality::Spanish,
                name: "Flavio NIEVES".to_string(),
                car_number: Some(36),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1GenericCar,
                nationality: Nationality::Russian,
                name: "Peter BELOUSOV".to_string(),
                car_number: Some(87),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1GenericCar,
                nationality: Nationality::Polish,
                name: "Klimek MICHALSKI".to_string(),
                car_number: Some(32),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1GenericCar,
                nationality: Nationality::Colombian,
                name: "Santiago MORENO".to_string(),
                car_number: Some(60),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: true,
                team: Team::F1GenericCar,
                nationality: Nationality::Belgian,
                name: "Benjamin COPPENS".to_string(),
                car_number: Some(54),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: false,
                team: Team::MyTeam,
                nationality: Nationality::Canadian,
                name: "Player".to_string(),
                car_number: Some(42),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: false,
                team: Team::MyTeam,
                nationality: Nationality::Invalid,
                name: "".to_string(),
                car_number: Some(0),
                ready_status: ReadyStatus::NotReady,
            },
            Player {
                ai_controlled: false,
                team: Team::MyTeam,
                nationality: Nationality::Invalid,
                name: "".to_string(),
                car_number: Some(0),
                ready_status: ReadyStatus::NotReady,
            },
        ],
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2021_car_damage_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e5070112010a2e324e2ac5eb38ad10e997421b06000013ffb206e13f0c9bc53f68a0843fbb6a823f010101010000000000000000000000000000000000000093c6d13f9eaaba3fb0437f3fb5a27a3f010100000000000000000000000000000000000000000027abd13f4e18b83f4fd7753f6c16733f01010000000000000000000000000000000000000000004264de3f8259c33fe3e3823f503e803f0101010100000000000000000000000000000000000000909ddb3fa77bc13f54e1833f65ba803f01010101000000000000000000000000000000000000000d06d63f8dd5bd3fd8167f3fcddb7b3f01010000000000000000000000000000000000000000000ce3dc3fa780c23f2e9b823f6101823f01010101000000000000000000000000000000000000007cdfd23f6bbcb83f528d7b3fdf037a3f01010000000000000000000000000000000000000000000f0fd53fe093bc3fb023823f5c13813f01010101000000000000000000000000000000000000009099d33f391dbb3f9de5823f4841803f01010101000000000000000000000000000000000000007e52d63f24a9bc3fe0f87b3f734e7b3f0101000000000000000000000000000000000000000000e672dc3f492ac23fae08843f4609833f01010101000000000000000000000000000000000000004952d13fcd89b83f5da2803fd2d27d3f010101000000000000000000000000000000000000000001a4d53fe02abd3fae8d823fc1627f3f01010100000000000000000000000000000000000000006fb8d13fee6ab83f9eec793f5c4e753f0101000000000000000000000000000000000000000000833eca3f033bb13f37ec703f0d6a6e3f010100000000000000000000000000000000000000000089bbcd3f8aa4b53f9248783fdb5d733f01010000000000000000000000000000000000000000001116d33f3e31b93fba1e7a3fc674793f0101000000000000000000000000000000000000000000c620d33fae7dba3fe6487e3f80a07a3f0101000000000000000000000000000000000000000000ea6b044021f5e63f7df8ee3f8635d53f0201010100000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::CarDamage(s) => s,
        _ => panic!("Invalid packet. Expected CarDamage, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2021);

    let expected = PacketCarDamageData {
        header: actual.header.clone(),
        car_damage_data: vec![
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.7580168,
                    rear_right: 1.5437942,
                    front_left: 1.0361452,
                    front_right: 1.0188822,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 1,
                    front_left: 1,
                    front_right: 1,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                ..Default::default()
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.6388725,
                    rear_right: 1.4583318,
                    front_left: 0.9971266,
                    front_right: 0.9790452,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 1,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                ..Default::default()
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.6380357,
                    rear_right: 1.4382417,
                    front_left: 0.9603166,
                    front_right: 0.9495609,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 1,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                ..Default::default()
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.7374346,
                    rear_right: 1.5261691,
                    front_left: 1.0225796,
                    front_right: 1.0019016,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 1,
                    front_left: 1,
                    front_right: 1,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                ..Default::default()
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.7157459,
                    rear_right: 1.5115861,
                    front_left: 1.030314,
                    front_right: 1.0056883,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 1,
                    front_left: 1,
                    front_right: 1,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                ..Default::default()
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.6720597,
                    rear_right: 1.4830796,
                    front_left: 0.9964423,
                    front_right: 0.98382264,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 1,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                ..Default::default()
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.7256789,
                    rear_right: 1.5195512,
                    front_left: 1.0203607,
                    front_right: 1.0156671,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 1,
                    front_left: 1,
                    front_right: 1,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                ..Default::default()
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.6474452,
                    rear_right: 1.4432501,
                    front_left: 0.9826251,
                    front_right: 0.97662157,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 1,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                ..Default::default()
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.664522,
                    rear_right: 1.4732628,
                    front_left: 1.0167141,
                    front_right: 1.0084033,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 1,
                    front_left: 1,
                    front_right: 1,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                ..Default::default()
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.6531239,
                    rear_right: 1.4618293,
                    front_left: 1.0226322,
                    front_right: 1.0019922,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 1,
                    front_left: 1,
                    front_right: 1,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                ..Default::default()
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.6743925,
                    rear_right: 1.4739118,
                    front_left: 0.9842663,
                    front_right: 0.9816658,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 1,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                ..Default::default()
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.7222564,
                    rear_right: 1.5169154,
                    front_left: 1.0315149,
                    front_right: 1.0237205,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 1,
                    front_left: 1,
                    front_right: 1,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                ..Default::default()
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.6353236,
                    rear_right: 1.4417053,
                    front_left: 1.0049549,
                    front_right: 0.9914981,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 1,
                    front_left: 1,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                ..Default::default()
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.6690675,
                    rear_right: 1.477871,
                    front_left: 1.0199487,
                    front_right: 0.9976006,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 1,
                    front_left: 1,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                ..Default::default()
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.638441,
                    rear_right: 1.4407632,
                    front_left: 0.97626674,
                    front_right: 0.9582269,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 1,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                ..Default::default()
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.5800327,
                    rear_right: 1.3846134,
                    front_left: 0.94110435,
                    front_right: 0.9313057,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 1,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                ..Default::default()
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.6072856,
                    rear_right: 1.4190838,
                    front_left: 0.96985734,
                    front_right: 0.9506509,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 1,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                ..Default::default()
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.6491109,
                    rear_right: 1.4468153,
                    front_left: 0.97703135,
                    front_right: 0.9744381,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 1,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                ..Default::default()
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 1.6494377,
                    rear_right: 1.4569604,
                    front_left: 0.99329984,
                    front_right: 0.97901154,
                },
                tyres_damage: WheelData {
                    rear_left: 1,
                    rear_right: 1,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                ..Default::default()
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 2.0690866,
                    rear_right: 1.8043557,
                    front_left: 1.8669583,
                    front_right: 1.6656959,
                },
                tyres_damage: WheelData {
                    rear_left: 2,
                    rear_right: 1,
                    front_left: 1,
                    front_right: 1,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 16,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                ..Default::default()
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 0.0,
                    rear_right: 0.0,
                    front_left: 0.0,
                    front_right: 0.0,
                },
                tyres_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                ..Default::default()
            },
            CarDamageData {
                tyres_wear: WheelData {
                    rear_left: 0.0,
                    rear_right: 0.0,
                    front_left: 0.0,
                    front_right: 0.0,
                },
                tyres_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                brakes_damage: WheelData {
                    rear_left: 0,
                    rear_right: 0,
                    front_left: 0,
                    front_right: 0,
                },
                front_left_wing_damage: 0,
                front_right_wing_damage: 0,
                rear_wing_damage: 0,
                floor_damage: 0,
                diffuser_damage: 0,
                sidepod_damage: 0,
                drs_fault: false,
                gear_box_damage: 0,
                engine_damage: 0,
                engine_mguh_wear: 0,
                engine_es_wear: 0,
                engine_ce_wear: 0,
                engine_ice_wear: 0,
                engine_mguk_wear: 0,
                engine_tc_wear: 0,
                ..Default::default()
            },
        ],
    };

    assert_eq!(actual, expected);
}

#[tokio::test]
async fn test_parse_2021_session_history_packet() {
    let stream = utils::get_stream().await;

    utils::send_raw_data(&stream, "e5070112010b2e324e2ac5eb38ad000000000000000013ff13020101010101752001003e52095b2d730f000000000000000000000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ff1010000000000000000000000000000000000000000000").await;

    let p = stream.next().await.unwrap();

    let actual = match p {
        Packet::SessionHistory(s) => s,
        _ => panic!("Invalid packet. Expected SessionHistory, got {:?}", &p),
    };

    assert_eq!(actual.header.packet_format, 2021);

    let expected = PacketSessionHistoryData {
        header: actual.header.clone(),
        car_index: 19,
        number_of_laps: 2,
        number_of_tyre_stints: 1,
        best_lap_time_lap_number: 1,
        best_sector_1_lap_number: 1,
        best_sector_2_lap_number: 1,
        best_sector_3_lap_number: 1,
        lap_history: vec![
            LapHistoryData {
                lap_time: 73845,
                sector_1_time: 21054,
                sector_2_time: 23305,
                sector_3_time: 29485,
                valid_sectors: 15,
            },
            LapHistoryData {
                lap_time: 0,
                sector_1_time: 0,
                sector_2_time: 0,
                sector_3_time: 0,
                valid_sectors: 15,
            },
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
            LapHistoryData::default(),
        ],
        tyre_stints: vec![
            TyreStintData {
                end_lap: 255,
                tyre_compound: TyreCompound::C5,
                tyre_compound_visual: TyreCompoundVisual::Soft,
            },
            TyreStintData::default(),
            TyreStintData::default(),
            TyreStintData::default(),
            TyreStintData::default(),
            TyreStintData::default(),
            TyreStintData::default(),
            TyreStintData::default(),
        ],
    };

    assert_eq!(actual, expected);
}
